<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAS R&D Hub (Dark Mode)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #020617; /* slate-950 */
            color: #cbd5e1; /* slate-300 */
        }

        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }

        /* Chart Container - Responsive & Constrained */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Interactive Elements */
        .interactive-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .interactive-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.15); /* Sky blue glow */
            border-color: #38bdf8;
        }

        .bit-box {
            transition: all 0.2s;
        }
        .bit-box:hover {
            transform: scale(1.15);
            z-index: 10;
            box-shadow: 0 0 10px currentColor;
        }

        /* Navigation State */
        .nav-item.active {
            background-color: rgba(14, 165, 233, 0.15); /* sky-500/15 */
            color: #38bdf8; /* sky-400 */
            border-left: 3px solid #38bdf8;
        }

        /* Input/Select Dark Styles */
        select option {
            background-color: #1e293b;
            color: #e2e8f0;
        }
    </style>
    <!-- Chosen Palette: Deep Space Engineer (Slate 950 Base, Sky/Indigo Accents) -->
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <!-- Mobile Header -->
    <div class="md:hidden bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center sticky top-0 z-50">
        <h1 class="font-bold text-lg text-slate-100"><i class="fa-solid fa-code mr-2"></i>UAS R&D Hub</h1>
        <button id="mobile-menu-btn" class="text-slate-400 focus:outline-none text-2xl">â˜°</button>
    </div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="hidden md:flex flex-col w-64 bg-slate-900 border-r border-slate-800 h-screen sticky top-0 z-40">
        <div class="p-6 border-b border-slate-800">
            <h1 class="text-2xl font-bold text-slate-100 tracking-tight mono-font">
                UAS<span class="text-sky-500">_Dev</span>
            </h1>
            <p class="text-xs text-slate-500 mt-1">Interactive Firmware Guide</p>
        </div>
        <div class="flex-1 py-4 space-y-1 overflow-y-auto">
            <a href="#" onclick="navTo('section-intro')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors active">ç³»çµ±æ¦‚è§€ (System)</a>
            <a href="#" onclick="navTo('section-hardware')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors">ç¡¬é«”æ ¸å¿ƒ (Hardware)</a>
            <a href="#" onclick="navTo('section-protocols')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors">é€šè¨Šå”å®š (DShot)</a>
            <a href="#" onclick="navTo('section-pid')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors">é£›è¡Œæ§åˆ¶ (PID)</a>
            <a href="#" onclick="navTo('section-software')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors">è»Ÿé«”æ£§ (Stack)</a>
            <a href="#" onclick="navTo('section-maint')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors">æ•…éšœè¨ºæ–· (Debug)</a>
        </div>
        <div class="p-4 bg-slate-950 border-t border-slate-800">
            <div class="text-xs text-slate-500 flex items-center">
                <span class="w-2 h-2 rounded-full bg-green-500 mr-2"></span>
                System Operational
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 p-4 md:p-10 overflow-x-hidden">
        
        <!-- Section 1: Introduction & Types -->
        <section id="section-intro" class="mb-16 animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">ç„¡äººæ©Ÿç³»çµ±é–‹ç™¼åŸºç¤</h2>
                <p class="text-slate-400 max-w-3xl leading-relaxed">
                    UAS (Unmanned Aircraft System) æ•´åˆäº†è¼‰å…·ã€åœ°é¢ç«™èˆ‡æ•¸æ“šéˆè·¯ã€‚
                    èº«ç‚ºé–‹ç™¼è€…ï¼Œäº†è§£ä¸åŒæ§‹å‹çš„ç‰©ç†é™åˆ¶æ˜¯é¸æ“‡ MCU èˆ‡æ„Ÿæ¸¬å™¨æ–¹æ¡ˆçš„ç¬¬ä¸€æ­¥ã€‚
                </p>
            </header>

            <div class="grid lg:grid-cols-2 gap-8 items-start">
                <!-- Vehicle Cards -->
                <div class="grid gap-4">
                    <div class="bg-slate-900 p-5 rounded-xl border border-slate-800 shadow-lg hover:border-sky-500/50 transition cursor-default group">
                        <div class="flex items-center mb-2">
                            <span class="text-2xl mr-3 grayscale group-hover:grayscale-0 transition">ğŸš</span>
                            <h3 class="font-bold text-slate-200 group-hover:text-sky-400 transition">å¤šæ—‹ç¿¼ (Multicopter)</h3>
                        </div>
                        <p class="text-sm text-slate-500">çµæ§‹ç°¡å–®ã€VTOL èƒ½åŠ›ã€‚é©åˆç©ºæ‹èˆ‡æª¢æ¸¬ã€‚çºŒèˆªåŠ›å—é™æ–¼é›»æ± èƒ½é‡å¯†åº¦ã€‚</p>
                    </div>
                    <div class="bg-slate-900 p-5 rounded-xl border border-slate-800 shadow-lg hover:border-emerald-500/50 transition cursor-default group">
                        <div class="flex items-center mb-2">
                            <span class="text-2xl mr-3 grayscale group-hover:grayscale-0 transition">âœˆï¸</span>
                            <h3 class="font-bold text-slate-200 group-hover:text-emerald-400 transition">å›ºå®šç¿¼ (Fixed-wing)</h3>
                        </div>
                        <p class="text-sm text-slate-500">é«˜å‡é˜»æ¯”ï¼Œé©åˆé•·è·é›¢å·¡èˆªã€‚èµ·é™éœ€è·‘é“æˆ–å½ˆå°„æ¶ï¼Œç„¡æ³•æ‡¸åœã€‚</p>
                    </div>
                    <div class="bg-slate-900 p-5 rounded-xl border border-slate-800 shadow-lg hover:border-amber-500/50 transition cursor-default group">
                        <div class="flex items-center mb-2">
                            <span class="text-2xl mr-3 grayscale group-hover:grayscale-0 transition">ğŸš€</span>
                            <h3 class="font-bold text-slate-200 group-hover:text-amber-400 transition">å‚ç›´èµ·é™ (VTOL)</h3>
                        </div>
                        <p class="text-sm text-slate-500">æ··åˆå‹•åŠ› (Hybrid)ã€‚çµåˆæ—‹ç¿¼èµ·é™èˆ‡å®šç¿¼å·¡èˆªï¼Œæ§åˆ¶é‚è¼¯æœ€ç‚ºè¤‡é›œã€‚</p>
                    </div>
                </div>

                <!-- Comparison Chart -->
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg relative">
                    <h3 class="font-bold text-slate-300 mb-4 text-center">è¼‰å…·æ€§èƒ½æ¬Šè¡¡ (Trade-off Analysis)</h3>
                    <div class="chart-container">
                        <canvas id="vehicleChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Hardware Anatomy -->
        <section id="section-hardware" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">ç¡¬é«”æ ¸å¿ƒæ¶æ§‹ (Biomimetic View)</h2>
                <p class="text-slate-400 max-w-3xl leading-relaxed">
                    å°‡ç¡¬é«”æ¨¡çµ„å°æ‡‰è‡³ç”Ÿç‰©ç³»çµ±ï¼Œæœ‰åŠ©æ–¼ç†è§£å„å€‹ Subsystem çš„ç›¸ä¾æ€§ã€‚
                    <span class="text-sky-400">é»æ“Šå¡ç‰‡</span> æŸ¥çœ‹è©³ç´°è¦æ ¼ï¼ˆMCU, Sensors, ESCï¼‰ã€‚
                </p>
            </header>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4" id="anatomy-grid">
                <!-- Generated by JS -->
            </div>
            
            <div id="anatomy-detail" class="mt-6 bg-slate-800/50 border border-slate-700 p-6 rounded-xl shadow-lg hidden backdrop-blur-sm">
                <div class="flex items-start">
                    <div class="text-4xl mr-4" id="detail-icon"></div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <h3 class="text-xl font-bold text-sky-400 mb-2" id="detail-title"></h3>
                            <span class="text-xs bg-slate-700 text-slate-300 px-2 py-1 rounded mono-font" id="detail-id-badge">ID: 0x01</span>
                        </div>
                        <p class="text-slate-300 leading-relaxed mb-4" id="detail-desc"></p>
                        <div class="bg-slate-900 p-4 rounded border border-slate-800">
                            <h4 class="text-xs text-slate-500 uppercase font-bold mb-2">Technical Specs</h4>
                            <ul class="space-y-2 text-sm text-emerald-400 mono-font" id="detail-specs"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Protocols (DShot) -->
        <section id="section-protocols" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">æ•¸ä½é€šè¨Šå”å®š (DShot)</h2>
                <p class="text-slate-400 max-w-3xl leading-relaxed">
                    DShot æ˜¯å…¨æ•¸ä½åŒ–çš„ ESC å”å®šï¼Œè§£æ±ºäº† PWM è¨Šè™ŸæŠ–å‹•å•é¡Œã€‚
                    ä¸‹æ–¹é¡¯ç¤º 16-bit å°åŒ…çµæ§‹ï¼Œè«‹å°‡æ»‘é¼ ç§»è‡³ <span class="text-emerald-400 mono-font">Bit Fields</span> æŸ¥çœ‹å®šç¾©ã€‚
                </p>
            </header>

            <div class="bg-slate-900 p-8 rounded-xl shadow-lg border border-slate-800">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-lg text-slate-200 mono-font">DShot 16-bit Frame</h3>
                    <span class="px-3 py-1 bg-sky-900/30 text-sky-400 border border-sky-800 rounded-full text-xs font-bold mono-font">Protocol Viewer</span>
                </div>

                <!-- Bit Visualizer -->
                <div class="flex flex-wrap justify-center gap-1 mb-8 font-mono text-sm select-none">
                    <!-- Throttle: 11 bits (0-10) -->
                    <div class="flex gap-1" id="bits-throttle"></div>
                    <!-- Separator -->
                    <div class="w-4 flex items-center justify-center text-slate-700">|</div>
                    <!-- Telemetry: 1 bit -->
                    <div class="flex gap-1" id="bits-telemetry"></div>
                    <!-- Separator -->
                    <div class="w-4 flex items-center justify-center text-slate-700">|</div>
                    <!-- CRC: 4 bits -->
                    <div class="flex gap-1" id="bits-crc"></div>
                </div>

                <!-- Info Box -->
                <div class="bg-slate-950 border-l-4 border-sky-500 p-6 rounded-r shadow-inner min-h-[100px] transition-all" id="dshot-info-box">
                    <h4 class="font-bold text-sky-400 mb-1 mono-font" id="dshot-info-title">HOVER OVER BITS</h4>
                    <p class="text-slate-400 text-sm" id="dshot-info-desc">æ¢ç´¢ Throttle (11-bit)ã€Telemetry (1-bit) èˆ‡ CRC (4-bit) çš„åˆ†ä½ˆã€‚</p>
                </div>

                <div class="mt-8 grid md:grid-cols-2 gap-6">
                    <div class="bg-slate-800/50 border border-slate-700 p-4 rounded-lg">
                        <h4 class="font-bold text-slate-200 mb-2">Digital Advantages</h4>
                        <ul class="list-disc list-inside text-sm text-slate-400 space-y-1">
                            <li>ç„¡é ˆè¡Œç¨‹æ ¡æº– (No Calibration)</li>
                            <li>æ•¸ä½ CRC æ ¡é©— (Error Check)</li>
                            <li>é«˜è§£æåº¦ (2048 steps)</li>
                        </ul>
                    </div>
                    <div class="bg-slate-800/50 border border-slate-700 p-4 rounded-lg">
                        <h4 class="font-bold text-slate-200 mb-2">Bi-directional DShot</h4>
                        <p class="text-sm text-slate-400">
                            é€éå–®ç·šå›å‚³ <strong class="text-emerald-400">eRPM</strong> æ•¸æ“šï¼Œè®“é£›æ§èƒ½å•Ÿç”¨ <span class="mono-font text-xs bg-slate-700 px-1 rounded">RPM Notch Filter</span>ï¼Œç²¾ç¢ºæ¿¾é™¤é¦¬é”éœ‡å‹•å™ªéŸ³ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: PID Control -->
        <section id="section-pid" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">é£›è¡Œæ§åˆ¶é‚è¼¯ (PID Loop)</h2>
                <p class="text-slate-400 max-w-3xl leading-relaxed">
                    PID æ§åˆ¶å™¨æ˜¯ç©©å®šé£›è¡Œçš„æ ¸å¿ƒç®—æ³•ã€‚
                    ä½¿ç”¨ä¸‹æ–¹æ¨¡æ“¬å™¨åˆ‡æ›ä¸åŒçš„ PID åƒæ•¸è¨­å®šæª” (Tuning Profiles)ï¼Œè§€å¯Ÿ Step Response æ›²ç·šã€‚
                </p>
            </header>

            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-sm">
                <div class="flex flex-wrap gap-4 mb-6 justify-center">
                    <button onclick="updatePidChart('balanced')" class="pid-btn px-4 py-2 bg-emerald-900/30 text-emerald-400 border border-emerald-800 rounded-lg hover:bg-emerald-900/50 font-bold transition focus:ring-2 focus:ring-emerald-500">
                        âœ… Perfect Tune
                    </button>
                    <button onclick="updatePidChart('highP')" class="pid-btn px-4 py-2 bg-rose-900/30 text-rose-400 border border-rose-800 rounded-lg hover:bg-rose-900/50 font-bold transition focus:ring-2 focus:ring-rose-500">
                        âš ï¸ High P (Oscillation)
                    </button>
                    <button onclick="updatePidChart('lowP')" class="pid-btn px-4 py-2 bg-amber-900/30 text-amber-400 border border-amber-800 rounded-lg hover:bg-amber-900/50 font-bold transition focus:ring-2 focus:ring-amber-500">
                        ğŸ¢ Low P (Sluggish)
                    </button>
                </div>

                <div class="grid lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="chart-container">
                            <canvas id="pidChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-slate-950 p-5 rounded-lg border border-slate-800">
                        <h4 class="font-bold text-slate-200 mb-3 border-b border-slate-800 pb-2">PID Terms</h4>
                        <div class="space-y-4">
                            <div>
                                <span class="mono-font text-xs bg-sky-900/50 text-sky-300 border border-sky-700 px-2 py-1 rounded">P (Proportional)</span>
                                <p class="text-xs text-slate-500 mt-1">ç•¶å‰èª¤å·®ã€‚æ±ºå®šä¿®æ­£åŠ›åº¦ã€‚éé«˜å°è‡´é«˜é »éœ‡ç›ªã€‚</p>
                            </div>
                            <div>
                                <span class="mono-font text-xs bg-indigo-900/50 text-indigo-300 border border-indigo-700 px-2 py-1 rounded">I (Integral)</span>
                                <p class="text-xs text-slate-500 mt-1">ç´¯ç©èª¤å·®ã€‚æ¶ˆé™¤ç©©æ…‹èª¤å·®èˆ‡å¤–éƒ¨æŒçºŒå¹²æ“¾ (å¦‚é¢¨)ã€‚</p>
                            </div>
                            <div>
                                <span class="mono-font text-xs bg-purple-900/50 text-purple-300 border border-purple-700 px-2 py-1 rounded">D (Derivative)</span>
                                <p class="text-xs text-slate-500 mt-1">æœªä¾†é æ¸¬ã€‚ä½œç‚ºé˜»å°¼ (Damping) æŠ‘åˆ¶ P çš„éè¡ã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Software Stack -->
        <section id="section-software" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">è»Ÿé«”é–‹ç™¼èˆ‡æ¨¡æ“¬ (Stack & SITL)</h2>
                <p class="text-slate-400 max-w-3xl leading-relaxed">
                    PX4 èˆ‡ ArduPilot æ˜¯å…©å¤§ä¸»æµé–‹æºé£›è¡Œæ£§ã€‚é¸æ“‡åˆé©çš„ Ecosystem æ±ºå®šäº†é–‹ç™¼æ•ˆç‡èˆ‡ç”¢å“æˆæ¬Šã€‚
                </p>
            </header>

            <div class="bg-slate-900 rounded-xl shadow-sm border border-slate-800 overflow-hidden">
                <div class="flex border-b border-slate-800 bg-slate-950">
                    <button onclick="switchStack('px4')" class="flex-1 py-4 text-center font-bold text-slate-500 hover:text-sky-400 hover:bg-slate-900 transition border-r border-slate-800" id="tab-px4">PX4 Autopilot</button>
                    <button onclick="switchStack('ardupilot')" class="flex-1 py-4 text-center font-bold text-slate-500 hover:text-rose-400 hover:bg-slate-900 transition" id="tab-ardupilot">ArduPilot</button>
                </div>
                <div class="p-8 min-h-[300px]">
                    <div id="content-px4" class="stack-content animate-fade-in">
                        <div class="flex items-center mb-4">
                            <div class="w-3 h-3 bg-sky-500 rounded-full mr-3 shadow-[0_0_10px_#0ea5e9]"></div>
                            <div>
                                <h3 class="text-xl font-bold text-slate-100">PX4 Autopilot</h3>
                                <span class="text-xs font-mono bg-slate-800 text-sky-400 border border-slate-700 px-2 py-1 rounded">BSD License</span>
                            </div>
                        </div>
                        <ul class="space-y-4 text-slate-400">
                            <li class="flex items-start"><span class="text-sky-500 mr-2">âœ</span><span><strong>æ¶æ§‹ (Architecture):</strong> æ¨¡çµ„åŒ–å¾®æ ¸å¿ƒ (Micro-kernel)ã€‚é©åˆå­¸è¡“ç ”ç©¶èˆ‡é«˜åº¦å®¢è£½åŒ–ã€‚</span></li>
                            <li class="flex items-start"><span class="text-sky-500 mr-2">âœ</span><span><strong>æ•´åˆ (Integration):</strong> åŸç”Ÿæ”¯æ´ ROS 2 / DDSï¼ŒAIoT æ‡‰ç”¨é¦–é¸ã€‚</span></li>
                            <li class="flex items-start"><span class="text-sky-500 mr-2">âœ</span><span><strong>SDK:</strong> MAVSDK (C++, Python, Swift)ã€‚</span></li>
                        </ul>
                    </div>
                    <div id="content-ardupilot" class="stack-content hidden animate-fade-in">
                        <div class="flex items-center mb-4">
                            <div class="w-3 h-3 bg-rose-500 rounded-full mr-3 shadow-[0_0_10px_#f43f5e]"></div>
                            <div>
                                <h3 class="text-xl font-bold text-slate-100">ArduPilot</h3>
                                <span class="text-xs font-mono bg-slate-800 text-rose-400 border border-slate-700 px-2 py-1 rounded">GPL v3 License</span>
                            </div>
                        </div>
                        <ul class="space-y-4 text-slate-400">
                            <li class="flex items-start"><span class="text-rose-500 mr-2">âœ</span><span><strong>ç©©å®šæ€§ (Stability):</strong> æ­·å²æ‚ ä¹…ï¼ŒåŠŸèƒ½æ¥µå…¶è±å¯Œï¼Œæ”¯æ´æ½›è‰‡ã€è»Šã€èˆ¹ç­‰è¼‰å…·ã€‚</span></li>
                            <li class="flex items-start"><span class="text-rose-500 mr-2">âœ</span><span><strong>è…³æœ¬ (Scripting):</strong> æ”¯æ´ Lua Scripts é€²è¡Œé‚Šç·£é‚è¼¯æ§åˆ¶ã€‚</span></li>
                            <li class="flex items-start"><span class="text-rose-500 mr-2">âœ</span><span><strong>SDK:</strong> DroneKit (Python)ã€‚</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mt-8 grid md:grid-cols-2 gap-6">
                <div class="bg-slate-900 border border-slate-800 p-6 rounded-xl">
                    <h4 class="font-bold text-slate-200 mb-2 mono-font"><i class="fa-solid fa-laptop-code mr-2"></i>SITL Simulation</h4>
                    <p class="text-slate-400 text-sm mb-4">Software-in-the-Loop å…è¨±åœ¨ PC ä¸Šç›´æ¥ç·¨è­¯éŸŒé«”ä¸¦æ¨¡æ“¬ç‰©ç†è¡Œç‚ºã€‚</p>
                    <div class="flex gap-2 flex-wrap">
                        <span class="px-2 py-1 bg-slate-800 rounded text-xs border border-slate-700 text-slate-300 mono-font">Gazebo</span>
                        <span class="px-2 py-1 bg-slate-800 rounded text-xs border border-slate-700 text-slate-300 mono-font">AirSim (AI)</span>
                        <span class="px-2 py-1 bg-slate-800 rounded text-xs border border-slate-700 text-slate-300 mono-font">JMAVSim</span>
                    </div>
                </div>
                <div class="bg-indigo-900/20 border border-indigo-500/30 p-6 rounded-xl">
                    <h4 class="font-bold text-indigo-300 mb-2 mono-font">MAVLink Protocol</h4>
                    <p class="text-indigo-200/70 text-sm"> Header-only C library. åœ°é¢ç«™èˆ‡ç„¡äººæ©Ÿé€šè¨Šçš„æ¨™æº–èªè¨€ã€‚v2.0 æ”¯æ´ Packet Signingã€‚</p>
                </div>
            </div>
        </section>

        <!-- Section 6: Maintenance -->
        <section id="section-maint" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">æ•…éšœè¨ºæ–· (Diagnostics)</h2>
                <p class="text-slate-400 max-w-3xl leading-relaxed">
                    é¸æ“‡è§€å¯Ÿåˆ°çš„ç•°å¸¸ç—‡ç‹€ (Symptoms)ï¼Œç³»çµ±å°‡æä¾›é™¤éŒ¯å»ºè­°ã€‚
                </p>
            </header>

            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-sm">
                <label class="block text-sm font-bold text-sky-400 mb-2 mono-font">SYMPTOM_SELECT:</label>
                <select id="diagnostic-select" onchange="showDiagnosis()" class="w-full p-3 bg-slate-800 border border-slate-700 rounded-lg mb-6 focus:ring-2 focus:ring-sky-500 outline-none text-slate-200">
                    <option value="">-- Select Error Condition --</option>
                    <option value="desync">Motor Desync (High Throttle Stutter)</option>
                    <option value="mag">Compass Variance / Toilet Bowl Effect</option>
                    <option value="reverse">Motor Direction Reversed</option>
                    <option value="failsafe">RC Lost / RX Failsafe Triggered</option>
                </select>

                <div id="diagnostic-result" class="hidden p-6 bg-slate-950 border-l-4 border-emerald-500 rounded-r transition-all">
                    <h4 class="font-bold text-lg text-emerald-400 mb-2" id="diag-title"></h4>
                    <p class="text-slate-400 mb-4" id="diag-desc"></p>
                    <div class="bg-slate-900 p-4 rounded border border-slate-800">
                        <strong class="text-slate-200 block mb-1 text-xs uppercase tracking-wider">Recommended Action</strong>
                        <p class="text-sky-400 font-medium mono-font" id="diag-action"></p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Dark Mode Chart Configuration ---
        Chart.defaults.color = '#94a3b8'; // slate-400 text
        Chart.defaults.borderColor = '#334155'; // slate-700 grid lines
        
        // --- Data & State Management ---
        
        const anatomyData = [
            {
                id: 'brain',
                icon: 'ğŸ§ ',
                title: 'Flight Controller',
                role: 'MCU / Brain',
                desc: 'è² è²¬æ„Ÿæ¸¬å™¨èåˆ (EKF) èˆ‡ PID è¿´è·¯é‹ç®—ã€‚',
                specs: ['STM32 F405/F722/H743', 'SPI IMU (Gyro/Acc)', 'Internal Bus']
            },
            {
                id: 'senses',
                icon: 'ğŸ‘ï¸',
                title: 'Sensors',
                role: 'Perception',
                desc: 'æä¾›å§¿æ…‹ (Attitude) èˆ‡ä½ç½® (Position) è³‡è¨Šã€‚',
                specs: ['IMU (6-DOF)', 'Magnetometer (I2C)', 'Barometer (SPI/I2C)']
            },
            {
                id: 'muscle',
                icon: 'ğŸ’ª',
                title: 'Propulsion',
                role: 'Actuators',
                desc: 'å°‡é›»èƒ½è½‰æ›ç‚ºæ©Ÿæ¢°æ¨åŠ›ã€‚',
                specs: ['BLDC Motors', 'ESC (MOSFET Bridge)', 'KV Rating']
            },
            {
                id: 'heart',
                icon: 'ğŸ”‹',
                title: 'Power System',
                role: 'Energy',
                desc: 'æä¾›ç©©å®šé›»å£“èˆ‡å¤§é›»æµæ”¾é›»ã€‚',
                specs: ['LiPo/Li-Ion', 'PDB', 'BEC (5V/9V/12V)']
            }
        ];

        const pidProfiles = {
            balanced: {
                label: 'Perfect Tune',
                data: [0, 20, 80, 105, 95, 102, 99, 100, 100, 100, 100, 100],
                color: 'rgb(52, 211, 153)', // emerald-400
                desc: 'Fast rise time, minimal overshoot. Stable.'
            },
            highP: {
                label: 'High P (Oscillation)',
                data: [0, 40, 120, 70, 130, 80, 115, 90, 105, 95, 102, 99],
                color: 'rgb(244, 63, 94)', // rose-500
                desc: 'Aggressive reaction causing high frequency oscillations.'
            },
            lowP: {
                label: 'Low P (Sluggish)',
                data: [0, 5, 15, 30, 50, 65, 75, 85, 90, 95, 98, 99],
                color: 'rgb(251, 191, 36)', // amber-400
                desc: 'Slow response, significant error over time.'
            }
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initVehicleChart();
            initAnatomyGrid();
            initDShotBits();
            initPidChart();
            
            // Mobile Menu Toggle
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('hidden');
                sidebar.classList.toggle('fixed');
                sidebar.classList.toggle('inset-0');
            });
        });

        // --- Navigation Logic ---
        function navTo(sectionId) {
            document.querySelectorAll('section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active', 'bg-sky-500/10', 'text-sky-400', 'border-l-4', 'border-sky-400');
                item.classList.add('text-slate-400', 'border-transparent');
            });
            
            const activeLink = Array.from(document.querySelectorAll('.nav-item')).find(l => l.getAttribute('onclick').includes(sectionId));
            if(activeLink) {
                activeLink.classList.add('active', 'bg-sky-500/10', 'text-sky-400', 'border-l-4', 'border-sky-400');
                activeLink.classList.remove('text-slate-400', 'border-transparent');
            }
            window.scrollTo(0, 0);
            
            if(window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('hidden');
                document.getElementById('sidebar').classList.remove('fixed', 'inset-0');
            }
        }

        // --- Chart 1: Vehicle Comparison ---
        function initVehicleChart() {
            const ctx = document.getElementById('vehicleChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['æ‡¸åœèƒ½åŠ›', 'å·¡èˆªæ•ˆç‡', 'èˆªç¨‹è·é›¢', 'èµ·é™ä¾¿åˆ©æ€§'],
                    datasets: [
                        {
                            label: 'å¤šæ—‹ç¿¼',
                            data: [10, 3, 3, 10],
                            backgroundColor: 'rgba(56, 189, 248, 0.5)', // sky
                            borderColor: '#38bdf8',
                            borderWidth: 1
                        },
                        {
                            label: 'å›ºå®šç¿¼',
                            data: [0, 10, 10, 2],
                            backgroundColor: 'rgba(52, 211, 153, 0.5)', // emerald
                            borderColor: '#34d399',
                            borderWidth: 1
                        },
                        {
                            label: 'VTOL',
                            data: [8, 8, 8, 9],
                            backgroundColor: 'rgba(251, 191, 36, 0.5)', // amber
                            borderColor: '#fbbf24',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            grid: { color: '#1e293b' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // --- Anatomy Grid Logic ---
        function initAnatomyGrid() {
            const container = document.getElementById('anatomy-grid');
            anatomyData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'interactive-card bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg flex flex-col items-center text-center group';
                card.onclick = () => showAnatomyDetail(item.id);
                card.innerHTML = `
                    <div class="text-4xl mb-3 group-hover:scale-110 transition-transform grayscale group-hover:grayscale-0">${item.icon}</div>
                    <h3 class="font-bold text-slate-200 group-hover:text-sky-400 transition">${item.title}</h3>
                    <p class="text-xs text-slate-500 font-bold mt-1 uppercase tracking-wide border border-slate-700 rounded px-2 py-0.5">${item.role}</p>
                `;
                container.appendChild(card);
            });
        }

        function showAnatomyDetail(id) {
            const item = anatomyData.find(d => d.id === id);
            const detailBox = document.getElementById('anatomy-detail');
            
            document.getElementById('detail-icon').textContent = item.icon;
            document.getElementById('detail-title').textContent = item.title;
            document.getElementById('detail-desc').textContent = item.desc;
            
            const specsList = document.getElementById('detail-specs');
            specsList.innerHTML = '';
            item.specs.forEach(spec => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="text-slate-500">></span> ${spec}`;
                specsList.appendChild(li);
            });

            detailBox.classList.remove('hidden');
        }

        // --- DShot Visualizer Logic ---
        function initDShotBits() {
            const throttleContainer = document.getElementById('bits-throttle');
            const telemContainer = document.getElementById('bits-telemetry');
            const crcContainer = document.getElementById('bits-crc');

            // 11 Throttle bits - Emerald Theme
            for(let i=0; i<11; i++) {
                createBit(throttleContainer, 'bg-emerald-500', 'Throttle (11-bit)', 'æ§åˆ¶é¦¬é”æ¨åŠ› (0-2047 éš)ã€‚48 ç‚ºæœ€ä½å•Ÿå‹•è½‰é€Ÿã€‚');
            }
            // 1 Telemetry bit - Amber Theme
            createBit(telemContainer, 'bg-amber-500', 'Telemetry (1-bit)', 'è«‹æ±‚é›»èª¿å›å‚³ eRPMã€é›»å£“ã€æº«åº¦ç­‰æ•¸æ“šã€‚');
            // 4 CRC bits - Rose Theme
            for(let i=0; i<4; i++) {
                createBit(crcContainer, 'bg-rose-500', 'CRC Checksum (4-bit)', 'å¾ªç’°å†—é¤˜æ ¡é©—ï¼Œç¢ºä¿è¨Šè™Ÿç„¡å¹²æ“¾éŒ¯èª¤ã€‚');
            }
        }

        function createBit(container, colorClass, title, desc) {
            const bit = document.createElement('div');
            // Darker base, bright hover
            bit.className = `bit-box w-6 h-10 md:w-8 md:h-12 ${colorClass} rounded cursor-help opacity-60 hover:opacity-100 shadow-[0_0_5px_rgba(0,0,0,0.5)] border border-white/10`;
            
            bit.onmouseover = () => {
                document.getElementById('dshot-info-title').textContent = title;
                document.getElementById('dshot-info-desc').textContent = desc;
                // Update info box border color dynamically based on hover
                const borderColor = colorClass.replace('bg-', 'border-');
                const infoBox = document.getElementById('dshot-info-box');
                infoBox.className = `bg-slate-950 border-l-4 ${borderColor} p-6 rounded-r shadow-inner min-h-[100px] transition-all`;
            };
            container.appendChild(bit);
        }

        // --- PID Chart Logic ---
        let pidChartInstance = null;

        function initPidChart() {
            const ctx = document.getElementById('pidChart').getContext('2d');
            const initialProfile = pidProfiles.balanced;

            pidChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['0', '50', '100', '150', '200', '250', '300', '350', '400', '450', '500', '550 (ms)'],
                    datasets: [
                        {
                            label: 'Setpoint (Target)',
                            data: Array(12).fill(100),
                            borderColor: '#475569', // slate-600
                            borderDash: [5, 5],
                            pointRadius: 0,
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: initialProfile.label,
                            data: initialProfile.data,
                            borderColor: initialProfile.color,
                            backgroundColor: initialProfile.color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            min: 0,
                            max: 150,
                            grid: { color: '#1e293b' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        tooltip: { mode: 'index', intersect: false, backgroundColor: '#0f172a', borderColor: '#334155', borderWidth: 1 }
                    }
                }
            });
        }

        function updatePidChart(profileKey) {
            const profile = pidProfiles[profileKey];
            const dataset = pidChartInstance.data.datasets[1];
            
            dataset.label = profile.label;
            dataset.data = profile.data;
            dataset.borderColor = profile.color;
            dataset.backgroundColor = profile.color.replace('rgb', 'rgba').replace(')', ', 0.1)');
            
            pidChartInstance.update();
        }

        // --- Software Stack Switcher ---
        function switchStack(stackId) {
            document.getElementById('tab-px4').classList.remove('bg-slate-900', 'text-sky-400');
            document.getElementById('tab-px4').classList.add('bg-slate-950', 'text-slate-500');
            document.getElementById('tab-ardupilot').classList.remove('bg-slate-900', 'text-rose-400');
            document.getElementById('tab-ardupilot').classList.add('bg-slate-950', 'text-slate-500');
            
            // Activate Tab
            const activeTab = document.getElementById(`tab-${stackId}`);
            activeTab.classList.remove('bg-slate-950', 'text-slate-500');
            activeTab.classList.add('bg-slate-900');
            if(stackId === 'px4') activeTab.classList.add('text-sky-400');
            else activeTab.classList.add('text-rose-400');
            
            // Content
            document.querySelectorAll('.stack-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`content-${stackId}`).classList.remove('hidden');
        }
        
        switchStack('px4'); // Init

        // --- Diagnostic Tool ---
        const diagnosisDB = {
            desync: {
                title: 'Motor Desynchronization',
                desc: 'é¦¬é”åœ¨é«˜è½‰é€Ÿæ™‚ç™¼ç”Ÿä¸Ÿæ­¥æˆ–åœè½‰ã€‚åŸå› ï¼šESC ç„¡æ³•è®€å– Back-EMF (åé›»å‹•å‹¢)ã€‚',
                action: 'Check 1: å¢åŠ  Rampup Powerã€‚ Check 2: ä¸¦è¯ä½ ESR é›»å®¹æ¿¾æ³¢ã€‚'
            },
            mag: {
                title: 'Mag Interference / TBE',
                desc: 'ç¾…ç›¤å—åˆ°é›»æµç£å ´å¹²æ“¾ï¼Œå°è‡´ Toilet Bowl Effect (é¦¬æ¡¶æ•ˆæ‡‰/ç¹åœˆ)ã€‚',
                action: 'é é›¢ PDB èˆ‡å¤§é›»æµç·šæã€‚åŸ·è¡Œ Compass Calibrationã€‚å¿…è¦æ™‚ä½¿ç”¨æ¶ˆç£å™¨ã€‚'
            },
            reverse: {
                title: 'Wrong Motor Direction',
                desc: 'é¦¬é”æ—‹è½‰æ–¹å‘éŒ¯èª¤ï¼Œå°è‡´èµ·é£›ç¿»æ©Ÿã€‚',
                action: 'é€²å…¥ BLHeli/Bluejay Configurator èª¿æ•´ï¼Œæˆ–é€é DShot Cmd æ”¹è®Šè½‰å‘ã€‚'
            },
            failsafe: {
                title: 'Failsafe Triggered',
                desc: 'RX è¨Šè™Ÿä¸Ÿå¤±æˆ– RSSI éä½ã€‚',
                action: 'æª¢æŸ¥å¤©ç·šå®‰è£ä½ç½® (ä¿æŒ 90 åº¦)ã€‚ç¢ºèª RTH (Return to Home) é«˜åº¦è¨­å®šæ˜¯å¦å®‰å…¨ã€‚'
            }
        };

        function showDiagnosis() {
            const select = document.getElementById('diagnostic-select');
            const resultBox = document.getElementById('diagnostic-result');
            const key = select.value;

            if (!key) {
                resultBox.classList.add('hidden');
                return;
            }

            const data = diagnosisDB[key];
            document.getElementById('diag-title').textContent = data.title;
            document.getElementById('diag-desc').textContent = data.desc;
            document.getElementById('diag-action').textContent = data.action;
            
            resultBox.classList.remove('hidden');
        }
    </script>
</body>
</html>
