<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAS R&D Hub (Engineer Reference)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- MathJax for rendering formulas -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #020617; /* slate-950 */
            color: #cbd5e1; /* slate-300 */
        }

        .mono-font { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Chart Container */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            max-height: 400px;
        }

        /* Nav & Interactions */
        .nav-item.active {
            background-color: rgba(14, 165, 233, 0.15);
            color: #38bdf8;
            border-left: 3px solid #38bdf8;
        }
        
        .interactive-card, .port-connector, .topo-block {
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid #334155;
        }
        .interactive-card:hover, .port-connector:hover, .topo-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.15);
            border-color: #38bdf8;
            background-color: rgba(30, 41, 59, 0.8);
        }

        /* Bit Visualization */
        .bit-box { transition: all 0.2s; }
        .bit-box:hover { transform: scale(1.15); z-index: 10; box-shadow: 0 0 10px currentColor; }

        /* Roadmap */
        .roadmap-item {
            position: relative;
            padding-left: 2rem;
            padding-bottom: 2rem;
            border-left: 2px solid #334155;
        }
        .roadmap-item:last-child { border-left: 2px solid transparent; }
        .roadmap-dot {
            position: absolute; left: -0.55rem; top: 0; width: 1rem; height: 1rem; border-radius: 50%; background-color: #0f172a; border: 2px solid #38bdf8;
        }

        /* Math formula style override */
        mjx-container { color: #cbd5e1 !important; }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <!-- Mobile Header -->
    <div class="md:hidden bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center sticky top-0 z-50">
        <h1 class="font-bold text-lg text-slate-100"><i class="fa-solid fa-code mr-2"></i>UAS R&D Hub</h1>
        <button id="mobile-menu-btn" class="text-slate-400 focus:outline-none text-2xl">‚ò∞</button>
    </div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="hidden md:flex flex-col w-64 bg-slate-900 border-r border-slate-800 h-screen sticky top-0 z-40 overflow-y-auto">
        <div class="p-6 border-b border-slate-800">
            <h1 class="text-2xl font-bold text-slate-100 tracking-tight mono-font">
                UAS<span class="text-sky-500">_Dev</span>
            </h1>
            <p class="text-xs text-slate-500 mt-1">Engineer Reference Ed.</p>
        </div>
        <div class="flex-1 py-4 space-y-1">
            
            <!-- Strategic -->
            <div class="px-4 py-2 text-xs font-bold text-slate-600 uppercase tracking-wider">Strategic</div>
            <a href="#" onclick="navTo('section-roadmap')" class="nav-item block px-6 py-3 text-sm font-medium text-orange-400 hover:bg-slate-800 hover:text-orange-200 border-l-4 border-transparent transition-colors active bg-orange-900/10"><i class="fa-solid fa-chess-knight mr-2 w-4"></i>Tech Roadmap (CTO)</a>
            <a href="#" onclick="navTo('section-teardown')" class="nav-item block px-6 py-3 text-sm font-medium text-emerald-400 hover:bg-slate-800 hover:text-emerald-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-box-open mr-2 w-4"></i>X500 Á°¨È´îÊãÜËß£ (Ref)</a>

            <!-- Hardware Deep Dive -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">Hardware Engineering</div>
            <a href="#" onclick="navTo('section-bldc')" class="nav-item block px-6 py-3 text-sm font-medium text-sky-400 hover:bg-slate-800 hover:text-sky-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-bolt mr-2 w-4"></i>BLDC È¶¨ÈÅîÂØ¶È©óÂÆ§ (Full)</a>
            <a href="#" onclick="navTo('section-pixhawk')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-microchip mr-2 w-4"></i>Pixhawk 6X Pinout</a>
            <a href="#" onclick="navTo('section-hardware')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-dna mr-2 w-4"></i>Sensors & Anatomy</a>
            
            <!-- System & Logic -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">Control & Signals</div>
            <a href="#" onclick="navTo('section-protocols')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-wave-square mr-2 w-4"></i>DShot Timing Specs</a>
            <a href="#" onclick="navTo('section-pid')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-arrow-trend-up mr-2 w-4"></i>PID Control Theory</a>
            <a href="#" onclick="navTo('section-intro')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-chart-pie mr-2 w-4"></i>Physics Overview</a>
            
            <!-- Software -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">Software Ops</div>
            <a href="#" onclick="navTo('section-software')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-brands fa-git-alt mr-2 w-4"></i>Architecture Stack</a>
            <a href="#" onclick="navTo('section-maint')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-wrench mr-2 w-4"></i>Diagnostics</a>
        </div>
        <div class="p-4 bg-slate-950 border-t border-slate-800">
            <div class="text-xs text-slate-500 flex items-center">
                <span class="w-2 h-2 rounded-full bg-emerald-500 mr-2 shadow-[0_0_5px_#10b981]"></span>
                Engineer: Marlon
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 p-4 md:p-10 overflow-x-hidden">

        <!-- 1. Roadmap (CTO) -->
        <section id="section-roadmap" class="mb-16 animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-slate-100 mb-2">ÊäÄË°ìÂâçÁûª (Tech Roadmap)</h2>
                        <p class="text-slate-400 max-w-3xl leading-relaxed">
                            Holybro CTO ËßÄÈªûÔºöPX4 Á°¨È´îÊ®ôÊ∫ñÂæû FMUv6 Âêë **PAB Ê®ôÊ∫ñ** Ëàá **i.MX RT** Êû∂ÊßãÁöÑÊºîÈÄ≤„ÄÇ
                        </p>
                    </div>
                    <div class="hidden lg:block text-right">
                        <span class="block bg-slate-800 text-slate-400 border border-slate-700 px-3 py-1 rounded text-xs font-mono mb-1">Standard: PAB</span>
                    </div>
                </div>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-slate-200 mb-6 flex items-center"><i class="fa-solid fa-timeline mr-2 text-orange-500"></i>Next-Gen Avionics</h3>
                    <div class="pl-2 space-y-6 border-l-2 border-slate-800 ml-2">
                        <div class="roadmap-item">
                            <div class="roadmap-dot border-orange-500"></div>
                            <h4 class="text-base font-bold text-orange-400">FMURT7 (i.MX RT1176)</h4>
                            <p class="text-sm text-slate-400 mt-1">1GHz Dual-Core (Cortex-M7/M4). Á™ÅÁ†¥ STM32 ÁÆóÂäõÁì∂È†∏ÔºåÂéüÁîüÊîØÊè¥ Ethernet„ÄÇ</p>
                        </div>
                        <div class="roadmap-item">
                            <div class="roadmap-dot border-sky-500"></div>
                            <h4 class="text-base font-bold text-sky-400">PAB Standard</h4>
                            <p class="text-sm text-slate-400 mt-1">Pixhawk Autopilot Bus. Â∞á Flight Core Ëàá Carrier Board Ëß£ËÄ¶ÔºåÂØ¶ÁèæÁ°¨È´îÁÜ±ÊèíÊãîÂçáÁ¥ö„ÄÇ</p>
                        </div>
                    </div>
                </div>
                <!-- Peripherals -->
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h4 class="font-bold text-slate-200 mb-3 text-sm uppercase tracking-wider">Industrial Peripherals</h4>
                    <div class="space-y-3">
                        <div class="bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 text-sm block">Unicore UM982 (Dual Antenna)</strong>
                            <p class="text-xs text-slate-500 mt-1">Moving Baseline RTK„ÄÇÈÄèÈÅéÈõôÂ§©Á∑öÁõ∏‰ΩçÂ∑ÆË®àÁÆó <strong class="text-sky-400">Heading (Ëà™Âêë)</strong>ÔºåÂÆåÂÖ®ÂÖçÁñ´Á£ÅÂπ≤Êìæ„ÄÇ</p>
                        </div>
                        <div class="bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 text-sm block">PM08D (200A/14S)</strong>
                            <p class="text-xs text-slate-500 mt-1">Êï∏‰Ωç I2C ÈõªÊµÅË®à„ÄÇÈáùÂ∞çÂ§ßÂûãËæ≤Ê•≠Ê©üËàáÁâ©ÊµÅÊ©üË®≠Ë®à„ÄÇ</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Teardown (Ref) -->
        <section id="section-teardown" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">X500 V2 Á°¨È´îÂèÉËÄÉË®≠Ë®à</h2>
                <p class="text-slate-400">Mads Tech ÊãÜËß£È©óË≠â„ÄÇÊ®ôÊ∫ñ PX4 ÈñãÁôºÊ©üÈÖçÁΩÆ„ÄÇ</p>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-slate-200 mb-4">BOM & Specs</h3>
                    <div class="space-y-4 font-mono text-sm">
                        <div class="border-l-2 border-emerald-500 pl-4">
                            <div class="text-emerald-400 font-bold">1. Frame</div>
                            <div class="text-xs text-slate-500">X500 V2 (500mm). Injection Molded PDB (No soldering required).</div>
                        </div>
                        <div class="border-l-2 border-rose-500 pl-4">
                            <div class="text-rose-400 font-bold">2. Propulsion</div>
                            <div class="text-xs text-slate-500">
                                Motors: 2216 920KV (DJI F450 Class)<br>
                                ESC: 20A BLHeli_S (DShot Capable)<br>
                                Props: 1045 Self-tightening
                            </div>
                        </div>
                        <div class="border-l-2 border-sky-500 pl-4">
                            <div class="text-sky-400 font-bold">3. Avionics</div>
                            <div class="text-xs text-slate-500">
                                FC: Pixhawk 6C (H743)<br>
                                Power: PM02D (Digital I2C)<br>
                                GPS: M8N / M10 (Standard)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                    <h4 class="font-bold text-slate-200 mb-3 text-sm uppercase"><i class="fa-solid fa-triangle-exclamation text-yellow-500 mr-2"></i>Critical Notes</h4>
                    <ul class="text-sm text-slate-400 space-y-2 list-disc list-inside">
                        <li><strong>PM02 vs PM02D:</strong> ÂãôÂøÖÁ¢∫Ë™çÂèÉÊï∏ <code class="bg-slate-800 px-1 rounded text-sky-300">SENS_EN_INA226</code> Â∑≤ÂïüÁî®ÔºåÂê¶ÂâáËÆÄ‰∏çÂà∞ÈõªÂ£ì„ÄÇ</li>
                        <li><strong>Motor Order:</strong> PX4 Quad-X È†ÜÂ∫èÁÇ∫ M1(FR), M2(RL), M3(FL), M4(RR)„ÄÇËàá ArduPilot ÂÆöÁæ©‰∏çÂêå„ÄÇ</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 3. BLDC Lab (FULL - NO SIMPLIFICATION) -->
        <section id="section-bldc" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-slate-100 mb-2">BLDC È¶¨ÈÅîÊéßÂà∂ÊùøÂØ¶È©óÂÆ§</h2>
                        <p class="text-slate-400 max-w-3xl leading-relaxed">
                            STM32 FOC (Á£ÅÂ†¥Â∞éÂêëÊéßÂà∂) Á°¨È´îÊû∂ÊßãËàáÊï∏Â≠∏Ê®°Âûã„ÄÇ<strong>ÂåÖÂê´ÂÖÉ‰ª∂ÈÅ∏ÂûãË®àÁÆóÂÖ¨Âºè„ÄÇ</strong>
                        </p>
                    </div>
                    <div class="hidden md:block">
                        <span class="bg-sky-900/30 text-sky-400 border border-sky-700/50 px-3 py-1 rounded text-xs font-mono">Target: Custom ESC / Driver</span>
                    </div>
                </div>
            </header>

            <!-- Topology -->
            <div class="bg-slate-950 p-6 rounded-xl border border-slate-800 shadow-inner mb-8 overflow-x-auto">
                <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">3-Phase Inverter Topology</h3>
                <div class="flex flex-col md:flex-row gap-4 items-stretch min-w-[700px]">
                    <!-- MCU -->
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('mcu')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-sky-400 text-xs px-2 py-0.5 rounded border border-slate-700">Controller</div>
                        <div class="text-center mt-2">
                            <i class="fa-solid fa-microchip text-3xl text-sky-500 mb-2"></i>
                            <h4 class="font-bold text-slate-200">STM32 G4</h4>
                            <p class="text-xs text-slate-500 mt-1 mono-font">CORDIC / FMAC</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-right-long text-xl"></i></div>
                    <!-- Driver -->
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('driver')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-amber-400 text-xs px-2 py-0.5 rounded border border-slate-700">Pre-Driver</div>
                        <div class="text-center mt-2">
                            <i class="fa-solid fa-charging-station text-3xl text-amber-500 mb-2"></i>
                            <h4 class="font-bold text-slate-200">Gate Driver</h4>
                            <p class="text-xs text-slate-500 mt-1 mono-font">DRV8301</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-right-long text-xl"></i></div>
                    <!-- MOSFET -->
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('mosfet')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-rose-400 text-xs px-2 py-0.5 rounded border border-slate-700">Power Stage</div>
                        <div class="text-center mt-2">
                            <i class="fa-solid fa-bolt text-3xl text-rose-500 mb-2"></i>
                            <h4 class="font-bold text-slate-200">MOSFETs</h4>
                            <p class="text-xs text-slate-500 mt-1 mono-font">Low Rds(on)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detail Box (With Formulas) -->
            <div id="bldc-detail-box" class="bg-slate-800 border border-slate-700 p-6 rounded-xl shadow-lg mb-8 transition-all hidden">
                <div class="flex items-start">
                    <div class="mr-4 text-3xl" id="bldc-icon"></div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-slate-100 mb-2" id="bldc-title"></h3>
                        <p class="text-slate-300 mb-4 text-sm leading-relaxed" id="bldc-desc"></p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-800">
                            <h4 class="text-xs text-sky-500 font-bold uppercase mb-3 border-b border-slate-800 pb-1">Engineering Math & Selection</h4>
                            <ul class="text-sm text-slate-400 mono-font space-y-3" id="bldc-specs"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FOC Workflow (Restored) -->
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <h3 class="text-lg font-bold text-slate-200 mb-6 flex items-center">
                    <i class="fa-solid fa-wave-square mr-2 text-emerald-500"></i>
                    FOC Control Loop (Math Model)
                </h3>
                <div class="grid md:grid-cols-4 gap-4 text-center">
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <div class="text-xs text-slate-500 mb-1">1. Sampling</div>
                        <h4 class="font-bold text-emerald-400">ADC $I_a, I_b$</h4>
                        <p class="text-xs text-slate-400 mt-2">Center-Aligned PWM Trigger</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <div class="text-xs text-slate-500 mb-1">2. Transforms</div>
                        <h4 class="font-bold text-emerald-400">Clarke & Park</h4>
                        <p class="text-xs text-slate-400 mt-2">$$ abc \rightarrow \alpha\beta \rightarrow dq $$</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <div class="text-xs text-slate-500 mb-1">3. Loop</div>
                        <h4 class="font-bold text-emerald-400">PI Controller</h4>
                        <p class="text-xs text-slate-400 mt-2">$$ V_q = K_p e + K_i \int e $$</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <div class="text-xs text-slate-500 mb-1">4. Modulation</div>
                        <h4 class="font-bold text-emerald-400">SVPWM</h4>
                        <p class="text-xs text-slate-400 mt-2">Sector Calc & Duty Cycle</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Pixhawk Pinout (FULL DETAIL) -->
        <section id="section-pixhawk" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Pixhawk 6X Êé•Âè£ÂÆöÁæ© (Pinout)</h2>
                <p class="text-slate-400 max-w-3xl">Standard Baseboard Êé•Âè£ÈõªÊ∞£ÁâπÊÄß„ÄÇ</p>
            </header>
            
            <div class="grid lg:grid-cols-3 gap-6">
                <!-- Port Map -->
                <div class="lg:col-span-2 bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('power')">
                            <div class="port-label text-rose-400">POWER 1 & 2</div><i class="fa-solid fa-battery-full text-xl text-rose-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('gps')">
                            <div class="port-label text-emerald-400">GPS 1 & 2</div><i class="fa-solid fa-satellite text-xl text-emerald-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('telem')">
                            <div class="port-label text-sky-400">TELEM 1-3</div><i class="fa-solid fa-wifi text-xl text-sky-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('fmu_pwm')">
                            <div class="port-label text-amber-400">FMU PWM</div><i class="fa-solid fa-fan text-xl text-amber-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('io_pwm')">
                            <div class="port-label text-slate-300">IO PWM</div><i class="fa-solid fa-gears text-xl text-slate-400 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('can')">
                            <div class="port-label text-indigo-400">CAN 1 & 2</div><i class="fa-solid fa-network-wired text-xl text-indigo-500 my-2"></i>
                        </div>
                    </div>
                </div>
                <!-- Detail Panel -->
                <div class="lg:col-span-1">
                    <div id="port-detail-panel" class="bg-slate-900 border border-slate-700 h-full rounded-xl p-6 shadow-lg animate-fade-in">
                        <div class="flex items-center mb-4 pb-4 border-b border-slate-800">
                            <div id="port-icon" class="text-2xl mr-3"></div>
                            <div><h4 id="port-title" class="text-xl font-bold text-white">Select Port</h4></div>
                        </div>
                        <div id="port-content" class="text-sm text-slate-400"><p class="italic opacity-70">Click diagram to view full electrical specs.</p></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. System Overview (Updated with Physics) -->
        <section id="section-intro" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Á≥ªÁµ±Ê¶ÇËßÄ (Engineering Physics)</h2>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <div class="chart-container"><canvas id="vehicleChart"></canvas></div>
                </div>
                <div class="space-y-4">
                    <div class="bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-sky-400 block mb-1">Disk Loading (ÂúìÁõ§Ë≤†Ëºâ)</strong>
                        <p class="text-xs text-slate-400">$$ DL = \frac{Weight}{PropArea} $$</p>
                        <p class="text-xs text-slate-500 mt-1">High DL (Racing) = Stable in wind, inefficient.<br>Low DL (Endurance) = Efficient, sensitive to wind.</p>
                    </div>
                    <div class="bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-emerald-400 block mb-1">Stall Speed (Â§±ÈÄüÈÄüÂ∫¶)</strong>
                        <p class="text-xs text-slate-400">$$ V_{stall} = \sqrt{\frac{2W}{\rho S C_{L,max}}} $$</p>
                        <p class="text-xs text-slate-500 mt-1">Fixed-wing critical parameter. Must fly above this speed.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Hardware Anatomy -->
        <section id="section-hardware" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Á°¨È´îËß£Ââñ (Components)</h2>
            </header>
            <div class="grid md:grid-cols-4 gap-4" id="anatomy-grid"></div>
            <div id="anatomy-detail" class="mt-6 bg-slate-800/50 border border-slate-700 p-6 rounded-xl shadow-lg hidden">
                <h3 id="detail-title" class="text-xl font-bold text-sky-400 mb-2"></h3>
                <p id="detail-desc" class="text-slate-300 mb-2"></p>
                <div class="bg-slate-950 p-3 rounded border border-slate-800">
                    <ul class="space-y-1 text-sm text-emerald-400 mono-font" id="detail-specs"></ul>
                </div>
            </div>
        </section>

        <!-- 7. Protocols (Detailed Timing) -->
        <section id="section-protocols" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">DShot Timing Specs</h2>
            </header>
            <div class="bg-slate-900 p-8 rounded-xl shadow-lg border border-slate-800">
                <div class="flex flex-wrap justify-center gap-1 mb-8" id="dshot-bits"></div>
                <div class="grid md:grid-cols-3 gap-4 text-center text-xs mono-font">
                    <div class="bg-slate-950 p-3 rounded border border-slate-700">
                        <strong class="text-sky-400 block mb-1">DShot150</strong>
                        <span>150 kbit/s</span><br>
                        <span class="text-slate-500">Bit Period: 6.67¬µs</span>
                    </div>
                    <div class="bg-slate-950 p-3 rounded border border-slate-700">
                        <strong class="text-sky-400 block mb-1">DShot300</strong>
                        <span>300 kbit/s</span><br>
                        <span class="text-slate-500">Bit Period: 3.33¬µs</span>
                    </div>
                    <div class="bg-slate-950 p-3 rounded border border-slate-700">
                        <strong class="text-sky-400 block mb-1">DShot600</strong>
                        <span>600 kbit/s</span><br>
                        <span class="text-slate-500">Bit Period: 1.67¬µs</span>
                    </div>
                </div>
                <div class="mt-6 text-center text-xs text-slate-500">
                    * Frame Length: 16 bits (11 Throttle + 1 Telem + 4 CRC). Requires DMA on STM32.
                </div>
            </div>
        </section>

        <!-- 8. PID (Theory) -->
        <section id="section-pid" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">PID Control Theory</h2>
            </header>
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <div class="mb-6 bg-slate-950 p-4 rounded border border-slate-700 text-center">
                    <p class="text-slate-300 text-sm mono-font">
                        $$ u(t) = K_p e(t) + K_i \int_0^t e(\tau)d\tau + K_d \frac{de(t)}{dt} + FF $$
                    </p>
                    <p class="text-xs text-slate-500 mt-2">Standard PID Form + Feed Forward (FF) for latency compensation.</p>
                </div>
                <div class="chart-container"><canvas id="pidChart"></canvas></div>
                <div class="flex justify-center gap-4 mt-4">
                    <button onclick="updatePidChart('balanced')" class="px-3 py-1 bg-emerald-900/30 text-emerald-400 border border-emerald-800 rounded text-xs font-bold">Perfect Tune</button>
                    <button onclick="updatePidChart('highP')" class="px-3 py-1 bg-rose-900/30 text-rose-400 border border-rose-800 rounded text-xs font-bold">High P (Oscillation)</button>
                </div>
            </div>
        </section>

        <!-- 9. Software Architecture -->
        <section id="section-software" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Software Architecture Stack</h2>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-sky-400 mb-4">PX4 Autopilot</h3>
                    <ul class="space-y-3 text-sm text-slate-400">
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>OS Kernel</span> <span class="mono-font text-slate-200">NuttX (POSIX-like)</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Middleware</span> <span class="mono-font text-slate-200">uORB (Pub/Sub)</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>License</span> <span class="mono-font text-slate-200">BSD 3-Clause</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Sim</span> <span class="mono-font text-slate-200">Gazebo / JMAVSim</span></li>
                    </ul>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-rose-400 mb-4">ArduPilot</h3>
                    <ul class="space-y-3 text-sm text-slate-400">
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>OS Kernel</span> <span class="mono-font text-slate-200">ChibiOS (Real-time)</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Architecture</span> <span class="mono-font text-slate-200">Monolithic</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>License</span> <span class="mono-font text-slate-200">GPL v3</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Scripting</span> <span class="mono-font text-slate-200">Lua</span></li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 10. Maintenance -->
        <section id="section-maint" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Field Diagnostics</h2>
            </header>
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <select id="diagnostic-select" onchange="showDiagnosis()" class="w-full p-3 bg-slate-800 border border-slate-700 rounded text-slate-200 mb-4">
                    <option value="">Select Symptom</option>
                    <option value="desync">Motor Desync / Screeching</option>
                    <option value="mag">Toilet Bowl Effect (TBE)</option>
                    <option value="vib">High Vibrations (Z-Axis)</option>
                </select>
                <div id="diagnostic-result" class="hidden p-4 bg-slate-950 border-l-4 border-emerald-500">
                    <h4 id="diag-title" class="font-bold text-emerald-400 mb-2"></h4>
                    <p id="diag-desc" class="text-sm text-slate-300 mb-2"></p>
                    <p id="diag-action" class="text-xs text-sky-400 mono-font"></p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Init Chart.js ---
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = '#334155';

        // --- Data: BLDC Specs (Restored & Enhanced) ---
        const bldcSpecs = {
            mcu: {
                icon: '<i class="fa-solid fa-microchip text-sky-500"></i>',
                title: 'MCU (Computation)',
                desc: 'FOC requires heavy math (Trig/Matrix).',
                specs: [
                    'Rec: STM32G431 (170MHz, CORDIC, FMAC)',
                    'ADC: 3x 12-bit (5Msps) for simultaneous I_sense',
                    'Timer: TIM1 (Advanced) for 6-ch PWM generation',
                    'Flash: 128KB+ for bootloader + app'
                ]
            },
            driver: {
                icon: '<i class="fa-solid fa-charging-station text-amber-500"></i>',
                title: 'Gate Driver',
                desc: 'Interface between 3.3V Logic and High Voltage Power Stage.',
                specs: [
                    'Current: Ig_peak > Qg / t_rise (Ensure fast switching)',
                    'Dead-time: Hardware insertion (prevent shoot-through)',
                    'Protection: UVLO, OCP, OTP',
                    'Bootstrap: Requires capacitor for High-Side driving'
                ]
            },
            mosfet: {
                icon: '<i class="fa-solid fa-bolt text-rose-500"></i>',
                title: 'MOSFETs (Inverter)',
                desc: '3-Phase Bridge (6x NMOS). Main heat source.',
                specs: [
                    'Vds: > 1.5x V_batt (e.g., 40V for 6S/25V)',
                    'Rds(on): < 3mŒ© (Power Loss = I¬≤ * Rds)',
                    'Qg: Low Qg minimizes switching loss',
                    'Package: DFN 5x6 (Good thermal pad)'
                ]
            }
        };

        // --- Data: Pixhawk Ports (Detailed) ---
        const portDB = {
            power: { title: 'POWER 1 & 2', subtitle: 'Redundant Input', icon: '<i class="fa-solid fa-battery-full text-rose-500"></i>', content: '<ul class="mono-font space-y-1 text-xs"><li>1,2: VCC (4.9-5.5V)</li><li>3: I_SENS (0-3.3V Analog)</li><li>4: V_SENS (0-3.3V Analog)</li><li>5,6: GND</li></ul><p class="mt-2 text-xs text-slate-400">Uses LTC4417 for ideal diode OR-ing priority.</p>' },
            gps: { title: 'GPS 1 & 2', subtitle: 'UART + I2C', icon: '<i class="fa-solid fa-satellite text-emerald-500"></i>', content: '<ul class="mono-font space-y-1 text-xs"><li>1: VCC_5V</li><li>2: TX (MCU Out)</li><li>3: RX (MCU In)</li><li>4: I2C_SCL (Mag)</li><li>5: I2C_SDA (Mag)</li><li>6: Safety Switch (GPS1 Only)</li></ul>' },
            telem: { title: 'TELEM 1-3', subtitle: 'Mavlink UART', icon: '<i class="fa-solid fa-wifi text-sky-500"></i>', content: '<ul class="mono-font space-y-1 text-xs"><li>1: VCC (Max 1.5A)</li><li>2: TX</li><li>3: RX</li><li>4: CTS (Flow Ctrl)</li><li>5: RTS (Flow Ctrl)</li><li>6: GND</li></ul>' },
            fmu_pwm: { title: 'FMU PWM', subtitle: 'DShot / Motor', icon: '<i class="fa-solid fa-fan text-amber-500"></i>', content: '<p class="text-xs">Direct STM32H7 Timer connection. Used for DShot ESCs. <br><span class="text-rose-400">Warning:</span> No servo rail power provided on most baseboards.</p>' },
            io_pwm: { title: 'IO PWM', subtitle: 'Servo / Aux', icon: '<i class="fa-solid fa-gears text-slate-400"></i>', content: '<p class="text-xs">Controlled by STM32F1 IO co-processor. 50-400Hz PWM. <br>Requires external BEC on Servo Rail for power.</p>' },
            can: { title: 'CAN 1 & 2', subtitle: 'UAVCAN', icon: '<i class="fa-solid fa-network-wired text-indigo-500"></i>', content: '<ul class="mono-font space-y-1 text-xs"><li>1: VCC_5V</li><li>2: CAN_H</li><li>3: CAN_L</li><li>4: GND</li></ul><p class="mt-2 text-xs">Differential signal. Requires 120Œ© termination.</p>' }
        };

        const anatomyData = [
            { id: 'brain', icon: 'üß†', title: 'Flight Controller', desc: 'STM32 H7', specs: ['H753/H743', 'Floating Point Unit', 'Triple Redundant IMU'] },
            { id: 'muscle', icon: 'üí™', title: 'ESC / Motor', desc: 'FOC System', specs: ['Field Oriented Control', 'DShot Digital Protocol', 'Regenerative Braking'] },
            { id: 'senses', icon: 'üëÅÔ∏è', title: 'Sensors', desc: 'Perception', specs: ['ICM-42688 (Gyro/Acc)', 'RM3100 (Mag)', 'BMP388 (Baro)'] },
            { id: 'heart', icon: 'üîã', title: 'Power', desc: 'Management', specs: ['PM02D (Digital I2C)', 'LTC4417 (OR-ing)', 'High-C LiPo'] }
        ];

        // --- Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            initVehicleChart();
            initAnatomyGrid();
            initDShotBits();
            initPidChart();
            
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                const s = document.getElementById('sidebar');
                s.classList.toggle('hidden'); s.classList.toggle('fixed'); s.classList.toggle('inset-0');
            });
        });

        function navTo(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0,0);
            
            document.querySelectorAll('.nav-item').forEach(i => {
                i.classList.remove('active', 'bg-orange-900/10', 'text-orange-400', 'border-orange-400', 'bg-emerald-900/10', 'text-emerald-400', 'border-emerald-400', 'bg-sky-900/10', 'text-sky-400', 'border-sky-400');
                i.classList.add('text-slate-400', 'border-transparent');
            });

            const link = Array.from(document.querySelectorAll('.nav-item')).find(l => l.getAttribute('onclick').includes(id));
            if(link) {
                if(id.includes('roadmap')) link.classList.add('active', 'text-orange-400', 'border-l-4', 'border-orange-400');
                else if(id.includes('teardown')) link.classList.add('active', 'text-emerald-400', 'border-l-4', 'border-emerald-400');
                else if(id.includes('bldc')) link.classList.add('active', 'text-sky-400', 'border-l-4', 'border-sky-400');
                else link.classList.add('active', 'text-sky-400', 'border-l-4', 'border-sky-400');
                link.classList.remove('text-slate-400', 'border-transparent');
            }
            if(window.innerWidth < 768) { document.getElementById('sidebar').classList.add('hidden'); document.getElementById('sidebar').classList.remove('fixed', 'inset-0'); }
        }

        // --- Interactions ---
        function showBldcDetail(k) {
            const d = bldcSpecs[k];
            const b = document.getElementById('bldc-detail-box');
            document.getElementById('bldc-icon').innerHTML = d.icon;
            document.getElementById('bldc-title').innerText = d.title;
            document.getElementById('bldc-desc').innerText = d.desc;
            const l = document.getElementById('bldc-specs'); l.innerHTML = '';
            d.specs.forEach(s => l.innerHTML += `<li><span class="text-sky-500 mr-2">></span>${s}</li>`);
            b.classList.remove('hidden'); b.classList.add('animate-fade-in');
        }

        function showPortDetail(k) {
            const d = portDB[k];
            const p = document.getElementById('port-detail-panel');
            document.getElementById('port-icon').innerHTML = d.icon;
            document.getElementById('port-title').innerText = d.title;
            document.getElementById('port-content').innerHTML = d.content;
            p.classList.remove('animate-fade-in'); void p.offsetWidth; p.classList.add('animate-fade-in');
        }

        function initAnatomyGrid() {
            const c = document.getElementById('anatomy-grid');
            anatomyData.forEach(d => {
                const div = document.createElement('div');
                div.className = 'interactive-card bg-slate-900 p-4 rounded-xl border border-slate-800 shadow-lg text-center group';
                div.onclick = () => {
                    const b = document.getElementById('anatomy-detail');
                    document.getElementById('detail-title').innerText = d.title;
                    document.getElementById('detail-desc').innerText = d.desc;
                    const l = document.getElementById('detail-specs'); l.innerHTML = '';
                    d.specs.forEach(s => l.innerHTML += `<li>> ${s}</li>`);
                    b.classList.remove('hidden');
                };
                div.innerHTML = `<div class="text-3xl mb-2 grayscale group-hover:grayscale-0 transition">${d.icon}</div><h3 class="font-bold text-slate-200 text-sm">${d.title}</h3>`;
                c.appendChild(div);
            });
        }

        function initDShotBits() {
            const c = document.getElementById('dshot-bits');
            for(let i=0; i<16; i++) {
                const b = document.createElement('div');
                let color = i < 11 ? 'bg-emerald-500' : (i < 12 ? 'bg-amber-500' : 'bg-rose-500');
                b.className = `bit-box w-5 h-8 md:w-6 md:h-10 ${color} rounded opacity-60 hover:opacity-100 border border-white/10 m-0.5 cursor-help`;
                c.appendChild(b);
            }
        }

        function initVehicleChart() {
            new Chart(document.getElementById('vehicleChart'), {
                type: 'radar',
                data: {
                    labels: ['Hover Stability', 'Cruise Efficiency', 'Payload', 'Range', 'Wind Resistance'],
                    datasets: [
                        { label: 'Multicopter', data: [10, 3, 5, 3, 6], borderColor: '#38bdf8', backgroundColor: 'rgba(56, 189, 248, 0.2)' },
                        { label: 'Fixed-wing', data: [0, 10, 7, 10, 4], borderColor: '#34d399', backgroundColor: 'rgba(52, 211, 153, 0.2)' },
                        { label: 'VTOL', data: [8, 8, 6, 8, 5], borderColor: '#fbbf24', backgroundColor: 'rgba(251, 191, 36, 0.2)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { grid: { color: '#334155' }, angleLines: { color: '#334155' } } } }
            });
        }

        let pidChart;
        function initPidChart() {
            pidChart = new Chart(document.getElementById('pidChart'), {
                type: 'line',
                data: {
                    labels: [0,10,20,30,40,50,60,70,80],
                    datasets: [{ label: 'Target', data: Array(9).fill(1), borderColor: '#64748b', borderDash: [5,5] }, { label: 'Response', data: [0, 0.6, 1.2, 0.9, 1.05, 0.98, 1.01, 1, 1], borderColor: '#34d399', backgroundColor: 'rgba(52, 211, 153, 0.1)', fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 1.5, grid: { color: '#1e293b' } }, x: { grid: { display: false } } } }
            });
        }
        function updatePidChart(t) {
            const m = { balanced: {d:[0, 0.6, 1.1, 0.95, 1.02, 0.99, 1, 1, 1], c:'#34d399'}, highP: {d:[0, 0.8, 1.4, 0.6, 1.3, 0.8, 1.1, 0.95, 1], c:'#f43f5e'} };
            const p = m[t];
            pidChart.data.datasets[1].data = p.d;
            pidChart.data.datasets[1].borderColor = p.c;
            pidChart.update();
        }

        function showDiagnosis() {
            const v = document.getElementById('diagnostic-select').value;
            const r = document.getElementById('diagnostic-result');
            const t = document.getElementById('diag-title');
            const d = document.getElementById('diag-desc');
            const a = document.getElementById('diag-action');
            
            if(!v) { r.classList.add('hidden'); return; }
            
            const db = {
                desync: { t: 'Motor Desync', d: 'ESC loses commutation sync at high RPM.', a: 'Action: 1. Increase Rampup Power in BLHeli. 2. Check for loose bullet connectors.' },
                mag: { t: 'Toilet Bowl Effect', d: 'Compass interference causes circling.', a: 'Action: 1. Calibrate Mag. 2. Move GPS mast away from PDB/Power cables.' },
                vib: { t: 'Z-Axis Vibration', d: 'High vibrations confuse the EKF altitude est.', a: 'Action: 1. Balance Props. 2. Check FC damping mount.' }
            };
            const data = db[v];
            t.innerText = data.t; d.innerText = data.d; a.innerText = data.a;
            r.classList.remove('hidden');
        }
    </script>
</body>
</html>
