<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAS R&D Hub (繁體中文工程版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #020617; /* slate-950 */
            color: #cbd5e1; /* slate-300 */
        }

        .mono-font { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Chart Container */
        .chart-container { position: relative; width: 100%; height: 300px; max-height: 400px; }

        /* Nav & Interactions */
        .nav-item.active { background-color: rgba(14, 165, 233, 0.15); color: #38bdf8; border-left: 3px solid #38bdf8; }
        
        .interactive-card, .port-connector, .topo-block {
            transition: all 0.2s ease; cursor: pointer; border: 1px solid #334155;
        }
        .interactive-card:hover, .port-connector:hover, .topo-block:hover {
            transform: translateY(-2px); box-shadow: 0 0 15px rgba(56, 189, 248, 0.15); border-color: #38bdf8; background-color: rgba(30, 41, 59, 0.8);
        }

        /* Hardware Specific Styles */
        .hw-block { border: 1px solid #334155; transition: all 0.2s ease; }
        .hw-block:hover { border-color: #38bdf8; box-shadow: 0 0 20px rgba(56, 189, 248, 0.1); transform: translateY(-2px); }

        /* Pinout Table Styles */
        .pin-table th { text-align: left; padding: 0.5rem; color: #94a3b8; font-size: 0.7rem; text-transform: uppercase; border-bottom: 1px solid #334155; }
        .pin-table td { padding: 0.5rem; border-bottom: 1px solid #1e293b; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #cbd5e1; }
        .pin-table tr:last-child td { border-bottom: none; }
        
        .voltage-tag { padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: bold; margin-right: 4px; display: inline-block;}
        .v-5 { background: rgba(244, 63, 94, 0.15); color: #fb7185; border: 1px solid rgba(244, 63, 94, 0.3); }
        .v-33 { background: rgba(56, 189, 248, 0.15); color: #38bdf8; border: 1px solid rgba(56, 189, 248, 0.3); }
        .v-gnd { background: rgba(148, 163, 184, 0.15); color: #94a3b8; border: 1px solid rgba(148, 163, 184, 0.3); }

        /* Bit Visualization */
        .bit-box { transition: all 0.2s; }
        .bit-box:hover { transform: scale(1.15); z-index: 10; box-shadow: 0 0 10px currentColor; }

        /* Roadmap */
        .roadmap-item { position: relative; padding-left: 2rem; padding-bottom: 2rem; border-left: 2px solid #334155; }
        .roadmap-item:last-child { border-left: 2px solid transparent; }
        .roadmap-dot { position: absolute; left: -0.55rem; top: 0; width: 1rem; height: 1rem; border-radius: 50%; background-color: #0f172a; border: 2px solid #38bdf8; }

        /* FOC Steps */
        .foc-step { position: relative; }
        .foc-step::after { content: '➜'; position: absolute; right: -20px; top: 50%; transform: translateY(-50%); color: #475569; font-size: 1.2rem; }
        .foc-step:last-child::after { display: none; }
        @media (max-width: 768px) { .foc-step::after { right: 50%; top: auto; bottom: -25px; transform: translateX(50%) rotate(90deg); } }

        /* Source Badge */
        .source-badge { display: inline-flex; align-items: center; padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge-holybro { background-color: rgba(234, 88, 12, 0.1); border: 1px solid rgba(234, 88, 12, 0.3); color: #fb923c; }
        .badge-teardown { background-color: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); color: #34d399; }
        .badge-standard { background-color: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); color: #60a5fa; }
        .badge-datasheet { background-color: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); color: #c084fc; }
        .badge-design { background-color: rgba(236, 72, 153, 0.1); border: 1px solid rgba(236, 72, 153, 0.3); color: #f472b6; }

        /* Chip Diagram */
        .chip-pkg { position: relative; background: #1e293b; border: 2px solid #475569; border-radius: 4px; }
        .chip-pin { width: 6px; height: 2px; background: #64748b; position: absolute; }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <!-- Mobile Header -->
    <div class="md:hidden bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center sticky top-0 z-50">
        <h1 class="font-bold text-lg text-slate-100"><i class="fa-solid fa-code mr-2"></i>UAS R&D Hub</h1>
        <button id="mobile-menu-btn" class="text-slate-400 focus:outline-none text-2xl">☰</button>
    </div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="hidden md:flex flex-col w-64 bg-slate-900 border-r border-slate-800 h-screen sticky top-0 z-40 overflow-y-auto">
        <div class="p-6 border-b border-slate-800">
            <h1 class="text-xl font-bold text-slate-100 tracking-tight mono-font">
                UAS<span class="text-sky-500">_Dev</span>
            </h1>
            <p class="text-xs text-slate-500 mt-1">繁體中文工程版 (TC Edition)</p>
        </div>
        <div class="flex-1 py-4 space-y-1">
            <!-- Strategic -->
            <div class="px-4 py-2 text-xs font-bold text-slate-600 uppercase tracking-wider">戰略規劃 (Strategic)</div>
            <a href="#" onclick="navTo('section-roadmap')" class="nav-item block px-6 py-3 text-sm font-medium text-orange-400 hover:bg-slate-800 hover:text-orange-200 border-l-4 border-transparent transition-colors active bg-orange-900/10"><i class="fa-solid fa-chess-knight mr-2 w-4"></i>技術路線圖 (Roadmap)</a>
            <a href="#" onclick="navTo('section-teardown')" class="nav-item block px-6 py-3 text-sm font-medium text-emerald-400 hover:bg-slate-800 hover:text-emerald-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-box-open mr-2 w-4"></i>X500 硬體拆解 (Ref)</a>

            <!-- Hardware Deep Dive -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">硬體工程 (Hardware)</div>
            <a href="#" onclick="navTo('section-mcu')" class="nav-item block px-6 py-3 text-sm font-medium text-purple-400 hover:bg-slate-800 hover:text-purple-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-microchip mr-2 w-4"></i>MCU 架構詳解 (Chips)</a>
            <a href="#" onclick="navTo('section-design')" class="nav-item block px-6 py-3 text-sm font-medium text-pink-400 hover:bg-slate-800 hover:text-pink-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-compass-drafting mr-2 w-4"></i>自製指南 (Design)</a>
            <a href="#" onclick="navTo('section-pixhawk')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-server mr-2 w-4"></i>Pixhawk 6X vs 6C</a>
            <a href="#" onclick="navTo('section-bldc')" class="nav-item block px-6 py-3 text-sm font-medium text-sky-400 hover:bg-slate-800 hover:text-sky-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-bolt mr-2 w-4"></i>BLDC 馬達實驗室 (Full)</a>
            <a href="#" onclick="navTo('section-hardware')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-dna mr-2 w-4"></i>硬體解剖 (Anatomy)</a>
            
            <!-- System & Logic -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">控制與邏輯 (Logic)</div>
            <a href="#" onclick="navTo('section-intro')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-chart-pie mr-2 w-4"></i>系統概觀 (Physics)</a>
            <a href="#" onclick="navTo('section-protocols')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-wave-square mr-2 w-4"></i>DShot 通訊時序</a>
            <a href="#" onclick="navTo('section-pid')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-arrow-trend-up mr-2 w-4"></i>PID 控制理論</a>
            
            <!-- Ops -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">營運與維護 (Ops)</div>
            <a href="#" onclick="navTo('section-software')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-brands fa-git-alt mr-2 w-4"></i>軟體棧 (Stack)</a>
            <a href="#" onclick="navTo('section-maint')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-wrench mr-2 w-4"></i>故障診斷 (Debug)</a>
        </div>
        <div class="p-4 bg-slate-950 border-t border-slate-800 text-xs text-slate-500">Engineer: Marlon</div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 p-4 md:p-10 overflow-x-hidden">

        <!-- 1. Roadmap -->
        <section id="section-roadmap" class="mb-16 animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">技術前瞻 (Tech Roadmap)</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-holybro">官方來源</span><span>Holybro CTO @ PX4 Summit</span>
                </div>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-slate-200 mb-6 flex items-center"><i class="fa-solid fa-timeline mr-2 text-orange-500"></i>次世代航電架構</h3>
                    <div class="pl-2 space-y-6 border-l-2 border-slate-800 ml-2">
                        <div class="roadmap-item">
                            <div class="roadmap-dot border-orange-500"></div>
                            <h4 class="text-base font-bold text-orange-400">FMURT7 (i.MX RT1176)</h4>
                            <p class="text-sm text-slate-400 mt-1">1GHz 雙核心 (Cortex-M7/M4)。突破 STM32 的效能瓶頸，原生支援乙太網 (Ethernet)，適合邊緣 AI 計算。</p>
                        </div>
                        <div class="roadmap-item">
                            <div class="roadmap-dot border-sky-500"></div>
                            <h4 class="text-base font-bold text-sky-400">PAB 標準 (Pixhawk Autopilot Bus)</h4>
                            <p class="text-sm text-slate-400 mt-1">模組化設計標準。將「飛控核心 (Core)」與「載板 (Baseboard)」分離，實現硬體熱插拔升級。</p>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h4 class="font-bold text-slate-200 mb-3 text-sm uppercase tracking-wider">高階周邊設備</h4>
                    <div class="space-y-3">
                        <div class="bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 text-sm block">Unicore UM982 (雙天線 RTK)</strong>
                            <p class="text-xs text-slate-500 mt-1">支援 GPS Heading (雙天線定航向)。在高壓電塔或大型金屬結構旁，可完全免疫磁羅盤干擾。</p>
                        </div>
                        <div class="bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 text-sm block">PM08D (200A 數位電流計)</strong>
                            <p class="text-xs text-slate-500 mt-1">I2C 數位傳輸。專為 14S 高壓農業機與物流無人機設計。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- MCU Deep Dive -->
        <section id="section-mcu" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">STM32 晶片架構詳解 (MCU Deep Dive)</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-datasheet">Datasheet</span>
                    <span>STM32H753 / H743 / F103</span>
                </div>
            </header>

            <div class="grid lg:grid-cols-2 gap-8 mb-8">
                <!-- Main Processor (H7) -->
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fa-solid fa-brain mr-2 text-purple-500"></i>
                        主飛控核心 (FMU): H7 系列
                    </h3>
                    
                    <div class="space-y-6">
                        <!-- H753 vs H743 Comparison -->
                        <div class="bg-slate-950 p-4 rounded-lg border border-slate-700">
                            <div class="grid grid-cols-2 gap-4 border-b border-slate-800 pb-2 mb-2">
                                <div>
                                    <h4 class="text-emerald-400 font-bold">STM32H753 (Pixhawk 6X)</h4>
                                    <span class="text-xs text-slate-500">旗艦 / 企業級</span>
                                </div>
                                <div>
                                    <h4 class="text-sky-400 font-bold">STM32H743 (Pixhawk 6C)</h4>
                                    <span class="text-xs text-slate-500">標準 / 消費級</span>
                                </div>
                            </div>
                            <ul class="text-sm text-slate-300 space-y-2 list-disc list-inside">
                                <li><strong>核心架構:</strong> 兩者皆為 Cortex-M7 @ 480MHz。</li>
                                <li><strong>算力關鍵:</strong> 具備 <span class="text-yellow-400">DP-FPU (雙精度浮點運算單元)</span>。
                                    <p class="text-xs text-slate-500 ml-5 mt-1">這對於運行 EKF3 (Extended Kalman Filter) 至關重要，能大幅減少姿態解算的累積誤差。</p>
                                </li>
                                <li><strong>差異點 (Security):</strong> <br>
                                    <span class="text-emerald-400">H753</span> 內建硬體加密加速引擎 (Crypto/Hash) 與更強的 Secure Boot 功能。適合需要防篡改、加密通訊的軍用/物流專案。<br>
                                    <span class="text-sky-400">H743</span> 則移除部分加密硬體，性價比更高。
                                </li>
                            </ul>
                        </div>

                        <!-- Technical Specs -->
                        <div class="grid grid-cols-2 gap-4 text-xs font-mono">
                            <div class="bg-slate-800 p-2 rounded">
                                <span class="block text-slate-500">Flash / RAM</span>
                                <span class="text-white">2MB / 1MB</span>
                            </div>
                            <div class="bg-slate-800 p-2 rounded">
                                <span class="block text-slate-500">DMA 通道</span>
                                <span class="text-white">MDMA + DMA2D</span>
                                <span class="block text-[10px] text-slate-500">AXI Bus Matrix 確保高速 IO 不卡頓</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- IO Processor (F103) -->
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fa-solid fa-shield-halved mr-2 text-rose-500"></i>
                        協處理器 (IO / Failsafe): F103
                    </h3>
                    
                    <div class="bg-slate-950 p-4 rounded-lg border border-slate-700 h-full">
                        <div class="mb-4">
                            <h4 class="text-rose-400 font-bold">STM32F103 (PX4IO)</h4>
                            <span class="text-xs text-slate-500">Cortex-M3 @ 72MHz</span>
                        </div>
                        
                        <div class="space-y-4 text-sm text-slate-300">
                            <div>
                                <strong class="text-white block mb-1">存在的目的? (Why do we need it?)</strong>
                                <p>若主核 (H7) 因為軟體 Bug 或過載而崩潰/重啟，F103 仍能獨立運作。</p>
                            </div>
                            
                            <div class="border-l-2 border-rose-900 pl-3">
                                <strong class="text-rose-300">1. 硬體級 Failsafe (失效保護)</strong>
                                <p class="text-xs text-slate-400 mt-1">當與主核失去 UART 連線時，F103 會立即接管 PWM 輸出，鎖定舵機或關閉馬達，防止飛機全速衝撞。</p>
                            </div>

                            <div class="border-l-2 border-sky-900 pl-3">
                                <strong class="text-sky-300">2. RC 訊號解碼</strong>
                                <p class="text-xs text-slate-400 mt-1">專門處理 SBUS / PPM 訊號的解析。支援 "RC Passthrough" (手動直通模式)，即使飛控當機，飛手仍可能控制飛機姿態。</p>
                            </div>

                            <div class="mt-4 p-2 bg-slate-900 border border-slate-800 rounded text-xs">
                                <span class="text-slate-500">通訊鏈路:</span>
                                <span class="text-mono text-emerald-400">UART (1.5Mbps)</span>
                                <br>H7 與 F103 之間透過高速串口交換控制指令與馬達數值。
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- New Section: Hardware Design Guide -->
        <section id="section-design" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">自製硬體指南 (Hardware Design Guide)</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-design">Reference Design</span>
                    <span>相容 FMUv6C 標準</span>
                </div>
            </header>

            <!-- Warning / Intro -->
            <div class="bg-amber-900/10 border border-amber-800 p-4 rounded-lg mb-8 flex items-start">
                <i class="fa-solid fa-circle-exclamation text-amber-500 mt-1 mr-3"></i>
                <div class="text-sm text-slate-300">
                    <strong class="text-amber-400 block mb-1">關於 Pixhawk 6C 原理圖</strong>
                    <p>Holybro 官方並未公開 6C 的完整原理圖 (SCH)。若需自製相容硬體，建議採用 <strong>FMUv6C 標準 + 開源參考設計 (如 Pix32 v6)</strong> 的策略，而非嘗試 1:1 複製。下方提供實作導向的模組拆解與 Pin Mapping。</p>
                </div>
            </div>

            <!-- Tab Navigation for Design -->
            <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden mb-8">
                <div class="flex border-b border-slate-800 bg-slate-950 overflow-x-auto">
                    <button onclick="showDesignTab('modules')" id="tab-modules" class="px-6 py-4 text-sm font-bold text-pink-400 bg-slate-900 border-r border-slate-800 transition whitespace-nowrap">模組拆解清單</button>
                    <button onclick="showDesignTab('pinout')" id="tab-pinout" class="px-6 py-4 text-sm font-bold text-slate-500 bg-slate-950 transition whitespace-nowrap">H743 Pin Mapping (一體板)</button>
                </div>

                <!-- Tab 1: Modules Breakdown -->
                <div id="content-modules" class="p-6 md:p-8 animate-fade-in">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-sky-400 font-bold mb-3 border-b border-sky-900 pb-2">1. 核心與 IO (Core)</h4>
                            <ul class="space-y-3 text-sm text-slate-400">
                                <li><strong class="text-white">FMU:</strong> STM32H743ZIT6 (LQFP144)。外掛 QSPI Flash (儲存)、FRAM (參數)。</li>
                                <li><strong class="text-white">IO MCU:</strong> STM32F103C8T6。負責 PWM 輸出與 RC 解碼。與 FMU 透過 UART 通訊。</li>
                                <li><strong class="text-white">Debug:</strong> SWD 介面 (建議保留 6-pin JST-GH)。</li>
                            </ul>

                            <h4 class="text-emerald-400 font-bold mb-3 mt-6 border-b border-emerald-900 pb-2">2. 感測器 (Sensors)</h4>
                            <ul class="space-y-3 text-sm text-slate-400">
                                <li><strong class="text-white">IMU 1 (SPI):</strong> ICM-42688-P (高頻震動性能佳)。</li>
                                <li><strong class="text-white">IMU 2 (SPI):</strong> BMI088 (工業級穩定性)。</li>
                                <li><strong class="text-white">Mag (I2C):</strong> IST8310 (外部 I2C 磁羅盤)。</li>
                                <li><strong class="text-white">Baro (SPI/I2C):</strong> MS5611 (高精度氣壓計)。</li>
                                <li class="text-xs italic">* 建議加入 IMU 加熱電阻與溫控電路。</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-rose-400 font-bold mb-3 border-b border-rose-900 pb-2">3. 電源架構 (Power)</h4>
                            <ul class="space-y-3 text-sm text-slate-400">
                                <li><strong class="text-white">輸入冗餘:</strong> POWER1 / POWER2 / USB 三路輸入 (Ideal Diode OR-ing)。</li>
                                <li><strong class="text-white">電壓軌:</strong> 5V (主供電), 3.3V_FMU, 3.3V_SENSORS (分開 LDO 以減少雜訊)。</li>
                                <li><strong class="text-white">監測:</strong> ADC 讀取電壓與電流 (分壓電路)。</li>
                            </ul>

                            <h4 class="text-amber-400 font-bold mb-3 mt-6 border-b border-amber-900 pb-2">4. 通訊與接口 (Comms)</h4>
                            <ul class="space-y-3 text-sm text-slate-400">
                                <li><strong class="text-white">Connectors:</strong> JST-GH 1.25mm (Pixhawk 標準)。</li>
                                <li><strong class="text-white">CAN:</strong> 2x CAN-FD (需外掛 Transceiver 如 TJA1051)。</li>
                                <li><strong class="text-white">Protection:</strong> 所有對外接口皆需 ESD TVS 保護。</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Pin Mapping -->
                <div id="content-pinout" class="hidden p-6 md:p-8 animate-fade-in">
                    <div class="mb-4 text-sm text-slate-400 bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-pink-400">設計目標：</strong> 類 Pixhawk 6C 一體板 (All-in-one)。<br>
                        <strong class="text-pink-400">MCU 型號：</strong> STM32H743ZIT6 (LQFP144)。<br>
                        <span class="text-xs">此表可直接作為原理圖 Symbol Pin Assignment 參考。</span>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse text-sm">
                            <thead>
                                <tr class="bg-slate-800 text-slate-200">
                                    <th class="p-3 border-b border-slate-700">Port Name (Function)</th>
                                    <th class="p-3 border-b border-slate-700">MCU Pin</th>
                                    <th class="p-3 border-b border-slate-700">STM32 Function</th>
                                    <th class="p-3 border-b border-slate-700">Connector (JST-GH)</th>
                                </tr>
                            </thead>
                            <tbody class="text-slate-400 font-mono">
                                <!-- GPS1 -->
                                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                                    <td class="p-3 text-emerald-400 font-bold">GPS 1</td>
                                    <td class="p-3">PA9 / PA10</td>
                                    <td class="p-3">USART1_TX / RX</td>
                                    <td class="p-3">10-Pin (含 I2C, Safety)</td>
                                </tr>
                                <!-- TELEM1 -->
                                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                                    <td class="p-3 text-sky-400 font-bold">TELEM 1</td>
                                    <td class="p-3">PE7 / PE8</td>
                                    <td class="p-3">UART7_TX / RX</td>
                                    <td class="p-3">6-Pin (Pin 2/3)</td>
                                </tr>
                                <!-- TELEM2 -->
                                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                                    <td class="p-3 text-sky-400">TELEM 2</td>
                                    <td class="p-3">PC12 / PD2</td>
                                    <td class="p-3">UART5_TX / RX</td>
                                    <td class="p-3">6-Pin</td>
                                </tr>
                                <!-- TELEM3 -->
                                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                                    <td class="p-3 text-sky-400">TELEM 3</td>
                                    <td class="p-3">PA2 / PA3</td>
                                    <td class="p-3">USART2_TX / RX</td>
                                    <td class="p-3">4-Pin or 6-Pin</td>
                                </tr>
                                <!-- GPS2 -->
                                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                                    <td class="p-3 text-emerald-400">GPS 2</td>
                                    <td class="p-3">PE0 / PE1</td>
                                    <td class="p-3">UART8_TX / RX</td>
                                    <td class="p-3">6-Pin</td>
                                </tr>
                                <!-- IO Link -->
                                <tr class="border-b border-slate-800 bg-slate-800/30">
                                    <td class="p-3 text-rose-400">IO LINK (Internal)</td>
                                    <td class="p-3">PC6 / PC7</td>
                                    <td class="p-3">USART6_TX / RX</td>
                                    <td class="p-3">To STM32F103</td>
                                </tr>
                                <!-- Debug -->
                                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                                    <td class="p-3 text-amber-400">DEBUG Console</td>
                                    <td class="p-3">PB10 / PB11</td>
                                    <td class="p-3">USART3_TX / RX</td>
                                    <td class="p-3">6-Pin (含 SWD)</td>
                                </tr>
                                <!-- USB -->
                                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                                    <td class="p-3 text-white">USB OTG</td>
                                    <td class="p-3">PA11 / PA12</td>
                                    <td class="p-3">USB_DM / DP</td>
                                    <td class="p-3">Type-C</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Pixhawk 6 Standards (TC Localized) -->
        <section id="section-pixhawk" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Pixhawk 6X/6C 硬體標準對照</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-standard">DS-012/018</span>
                    <span>規格已驗證 (Specs Verified)</span>
                </div>
            </header>

            <!-- Use Case Selector (TC) -->
            <div class="mb-8 bg-slate-900 p-6 rounded-xl border border-slate-800">
                <h3 class="text-lg font-bold text-white mb-4"><i class="fa-solid fa-filter mr-2 text-sky-500"></i>應用場景建議 (Selection Guide)</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <button onclick="recommendBoard('industrial')" class="p-4 bg-slate-950 border border-emerald-900/50 hover:border-emerald-500 hover:bg-emerald-900/10 rounded-lg text-left transition group">
                        <strong class="text-emerald-400 block mb-1 group-hover:translate-x-1 transition-transform">工業/科研 (Industrial)</strong>
                        <span class="text-xs text-slate-500">BVLOS 超視距、測繪、AI 邊緣運算、高價值載荷。</span>
                    </button>
                    <button onclick="recommendBoard('swarm')" class="p-4 bg-slate-950 border border-sky-900/50 hover:border-sky-500 hover:bg-sky-900/10 rounded-lg text-left transition group">
                        <strong class="text-sky-400 block mb-1 group-hover:translate-x-1 transition-transform">機群/教育 (Swarms/Edu)</strong>
                        <span class="text-xs text-slate-500">無人機燈光秀、穿越機、大學實驗室、成本敏感型專案。</span>
                    </button>
                </div>
                <div id="recommendation-result" class="mt-4 p-4 bg-slate-800 rounded border-l-4 border-slate-600 hidden animate-fade-in">
                    <!-- JS populated -->
                </div>
            </div>

            <div class="bg-slate-950 rounded-xl border border-slate-800 overflow-hidden mb-8">
                <table class="w-full comp-table text-slate-300">
                    <thead>
                        <tr class="bg-slate-900">
                            <th class="w-1/4">規格項目 (Spec)</th>
                            <th class="w-1/3 text-emerald-400">Pixhawk 6X (旗艦版)</th>
                            <th class="w-1/3 text-sky-400">Pixhawk 6C (標準版)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>MCU (處理器)</td>
                            <td><strong class="text-slate-200">STM32H753</strong><br><span class="text-xs text-slate-500">內建硬體加密/Hash加速器</span></td>
                            <td><strong class="text-slate-200">STM32H743</strong><br><span class="text-xs text-slate-500">標準高效能核心</span></td>
                        </tr>
                        <tr>
                            <td>Redundancy (冗餘)</td>
                            <td><span class="bg-emerald-900/30 text-emerald-400 px-2 py-0.5 rounded text-xs">三路冗餘 (3x Domains)</span></td>
                            <td><span class="bg-slate-800 text-slate-400 px-2 py-0.5 rounded text-xs">雙路冗餘 (2x Domains)</span></td>
                        </tr>
                        <tr>
                            <td>Connectivity (連接)</td>
                            <td><span class="text-emerald-400">Ethernet (100Base-T)</span></td>
                            <td><span class="text-slate-500">無 (僅 USB OTG)</span></td>
                        </tr>
                        <tr>
                            <td>Security (安全)</td>
                            <td><span class="text-emerald-400">NXP SE050 (安全晶片)</span></td>
                            <td><span class="text-slate-500">無</span></td>
                        </tr>
                        <tr>
                            <td>Form Factor (外型)</td>
                            <td>模組化 (符合 PAB 標準)</td>
                            <td>整合式 (專有介面)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Port Map (6X Standard) -->
            <div class="grid lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">Port Pinout (6X 載板參考)</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('power')">
                            <div class="port-label text-rose-400">POWER 1 & 2</div><i class="fa-solid fa-battery-full text-xl text-rose-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('gps')">
                            <div class="port-label text-emerald-400">GPS 1 & 2</div><i class="fa-solid fa-satellite text-xl text-emerald-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('telem')">
                            <div class="port-label text-sky-400">TELEM 1-3</div><i class="fa-solid fa-wifi text-xl text-sky-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('fmu_pwm')">
                            <div class="port-label text-amber-400">FMU PWM</div><i class="fa-solid fa-fan text-xl text-amber-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('io_pwm')">
                            <div class="port-label text-slate-300">IO PWM</div><i class="fa-solid fa-gears text-xl text-slate-400 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('can')">
                            <div class="port-label text-indigo-400">CAN 1 & 2</div><i class="fa-solid fa-network-wired text-xl text-indigo-500 my-2"></i>
                        </div>
                    </div>
                </div>
                <!-- Detail Panel -->
                <div class="lg:col-span-1">
                    <div id="port-detail-panel" class="bg-slate-900 border border-slate-700 h-full rounded-xl p-6 shadow-lg animate-fade-in flex flex-col">
                        <div class="flex items-center mb-4 pb-4 border-b border-slate-800">
                            <div id="port-icon" class="text-2xl mr-3"></div>
                            <div><h4 id="port-title" class="text-xl font-bold text-white">請選擇接口</h4></div>
                        </div>
                        <div id="port-content" class="text-sm text-slate-400 flex-1 overflow-y-auto"><p class="italic opacity-70">點擊左側圖表以查看詳細電氣規格。</p></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Teardown (Ref) -->
        <section id="section-teardown" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">X500 V2 硬體參考設計</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-teardown">實機驗證</span>
                    <span>X500 V2 標準開發套件</span>
                </div>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-slate-200 mb-4">BOM 表與規格</h3>
                    <div class="space-y-4 font-mono text-sm">
                        <div class="border-l-2 border-emerald-500 pl-4">
                            <div class="text-emerald-400 font-bold">1. 機架 (Frame)</div>
                            <div class="text-xs text-slate-500">X500 V2 (500mm 軸距)。整合射出成型 PDB (無需焊接)。</div>
                        </div>
                        <div class="border-l-2 border-rose-500 pl-4">
                            <div class="text-rose-400 font-bold">2. 動力 (Propulsion)</div>
                            <div class="text-xs text-slate-500">
                                馬達: 2216 920KV (類似 DJI F450 規格)<br>
                                電調: 20A BLHeli_S (硬體支援 DShot)<br>
                                螺旋槳: 1045 自鎖槳
                            </div>
                        </div>
                        <div class="border-l-2 border-sky-500 pl-4">
                            <div class="text-sky-400 font-bold">3. 航電 (Avionics)</div>
                            <div class="text-xs text-slate-500">
                                飛控: Pixhawk 6C (標準版)<br>
                                電源模組: PM02D (I2C 數位監控)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h4 class="font-bold text-slate-200 mb-3 text-sm uppercase"><i class="fa-solid fa-triangle-exclamation text-yellow-500 mr-2"></i>組裝注意事項 (Critical Notes)</h4>
                    <ul class="text-sm text-slate-400 space-y-2 list-disc list-inside">
                        <li><strong>PM02 vs PM02D:</strong> 務必確認 PX4 參數 <code class="bg-slate-800 px-1 rounded text-sky-300">SENS_EN_INA226</code> 已啟用，否則無法讀取電壓（因為是數位訊號）。</li>
                        <li><strong>馬達順序:</strong> PX4 的 Quad-X 定義為：M1(右前/CCW), M2(左後/CCW), M3(左前/CW), M4(右後/CW)。這與 ArduPilot 不同。</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 4. BLDC Lab (Full Math) -->
        <section id="section-bldc" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">BLDC 馬達控制板實驗室</h2>
                <p class="text-slate-400 max-w-3xl">STM32 FOC 架構與元件選型公式。</p>
            </header>

            <!-- Topology -->
            <div class="bg-slate-950 p-6 rounded-xl border border-slate-800 shadow-inner mb-8 overflow-x-auto">
                <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">逆變器拓撲 (Inverter Topology)</h3>
                <div class="flex flex-col md:flex-row gap-4 items-stretch min-w-[700px]">
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('mcu')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-sky-400 text-xs px-2 py-0.5 rounded border border-slate-700">控制器 (MCU)</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-microchip text-3xl text-sky-500 mb-2"></i><h4 class="font-bold text-slate-200">STM32 G4</h4></div>
                    </div>
                    <div class="flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-right-long text-xl"></i></div>
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('driver')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-amber-400 text-xs px-2 py-0.5 rounded border border-slate-700">預驅 (Pre-Driver)</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-charging-station text-3xl text-amber-500 mb-2"></i><h4 class="font-bold text-slate-200">Gate Driver</h4></div>
                    </div>
                    <div class="flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-right-long text-xl"></i></div>
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('mosfet')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-rose-400 text-xs px-2 py-0.5 rounded border border-slate-700">功率級 (Power Stage)</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-bolt text-3xl text-rose-500 mb-2"></i><h4 class="font-bold text-slate-200">MOSFETs</h4></div>
                    </div>
                </div>
            </div>

            <div id="bldc-detail-box" class="bg-slate-800 border border-slate-700 p-6 rounded-xl shadow-lg mb-8 hidden">
                <div class="flex items-start">
                    <div class="mr-4 text-3xl" id="bldc-icon"></div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-slate-100 mb-2" id="bldc-title"></h3>
                        <p class="text-slate-300 mb-4 text-sm" id="bldc-desc"></p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-800">
                            <h4 class="text-xs text-sky-500 font-bold uppercase mb-3">選型公式 (Engineering Math)</h4>
                            <ul class="text-sm text-slate-400 mono-font space-y-3" id="bldc-specs"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FOC Workflow -->
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <h3 class="text-lg font-bold text-slate-200 mb-6 flex items-center"><i class="fa-solid fa-wave-square mr-2 text-emerald-500"></i>FOC 控制流程 (Control Loop)</h3>
                <div class="grid md:grid-cols-4 gap-4 text-center">
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm">1. ADC 採樣</h4>
                        <p class="text-xs text-slate-400 mt-2">讀取相電流 Ia, Ib</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm">2. 座標變換</h4>
                        <p class="text-xs text-slate-400 mt-2">Clarke / Park (abc轉dq)</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm">3. PID 控制</h4>
                        <p class="text-xs text-slate-400 mt-2">電流環/速度環計算</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm">4. SVPWM</h4>
                        <p class="text-xs text-slate-400 mt-2">空間向量調變輸出</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. System Overview (Physics) -->
        <section id="section-intro" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">系統概觀 (物理特性)</h2>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <div class="chart-container"><canvas id="vehicleChart"></canvas></div>
                </div>
                <div class="space-y-4">
                    <div class="bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-sky-400 block mb-1">圓盤負載 (Disk Loading)</strong>
                        <p class="text-xs text-slate-400">$$ DL = \frac{Weight}{PropArea} $$</p>
                        <p class="text-xs text-slate-500 mt-1">DL 高 (競速機) = 抗風性強，效率低。<br>DL 低 (長航時) = 效率高，易受風影響。</p>
                    </div>
                    <div class="bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-emerald-400 block mb-1">失速速度 (Stall Speed)</strong>
                        <p class="text-xs text-slate-400">$$ V_{stall} = \sqrt{\frac{2W}{\rho S C_{L,max}}} $$</p>
                        <p class="text-xs text-slate-500 mt-1">固定翼關鍵參數。飛行速度必須高於此值以維持升力。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Hardware Anatomy -->
        <section id="section-hardware" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">硬體解剖 (生理學觀點)</h2>
            </header>
            <div class="grid md:grid-cols-4 gap-4" id="anatomy-grid"></div>
            <div id="anatomy-detail" class="mt-6 bg-slate-800/50 border border-slate-700 p-6 rounded-xl shadow-lg hidden">
                <h3 id="detail-title" class="text-xl font-bold text-sky-400 mb-2"></h3>
                <p id="detail-desc" class="text-slate-300 mb-2"></p>
                <div class="bg-slate-950 p-3 rounded border border-slate-800"><ul class="space-y-1 text-sm text-emerald-400 mono-font" id="detail-specs"></ul></div>
            </div>
        </section>

        <!-- 7. Protocols -->
        <section id="section-protocols" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">DShot 通訊時序</h2>
            </header>
            <div class="bg-slate-900 p-8 rounded-xl shadow-lg border border-slate-800">
                <div class="flex flex-wrap justify-center gap-1 mb-8" id="dshot-bits"></div>
                <div class="grid md:grid-cols-3 gap-4 text-center text-xs mono-font">
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot150</strong><span>150 kbit/s</span></div>
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot300</strong><span>300 kbit/s</span></div>
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot600</strong><span>600 kbit/s</span></div>
                </div>
            </div>
        </section>

        <!-- 8. PID -->
        <section id="section-pid" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">PID 控制理論</h2>
            </header>
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <div class="mb-6 bg-slate-950 p-4 rounded border border-slate-700 text-center">
                    <p class="text-slate-300 text-sm mono-font">$$ u(t) = K_p e(t) + K_i \int_0^t e(\tau)d\tau + K_d \frac{de(t)}{dt} + FF $$</p>
                    <p class="text-xs text-slate-500 mt-2">標準 PID 公式 + 前饋控制 (Feed Forward) 以補償延遲。</p>
                </div>
                <div class="chart-container"><canvas id="pidChart"></canvas></div>
                <div class="flex justify-center gap-4 mt-4">
                    <button onclick="updatePidChart('balanced')" class="px-3 py-1 bg-emerald-900/30 text-emerald-400 border border-emerald-800 rounded">完美調校 (Balanced)</button>
                    <button onclick="updatePidChart('highP')" class="px-3 py-1 bg-rose-900/30 text-rose-400 border border-rose-800 rounded">P值過高 (High P)</button>
                </div>
            </div>
        </section>

        <!-- 9. Software -->
        <section id="section-software" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">軟體棧 (Software Stack)</h2>
            </header>
            <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
                <div class="flex border-b border-slate-800 bg-slate-950">
                    <button id="tab-px4" onclick="switchStack('px4')" class="flex-1 py-4 font-bold text-sky-400 bg-slate-900 border-r border-slate-800 transition">PX4 Autopilot</button>
                    <button id="tab-ardupilot" onclick="switchStack('ardupilot')" class="flex-1 py-4 font-bold text-slate-500 bg-slate-950 transition">ArduPilot</button>
                </div>
                <div id="content-px4" class="p-8">
                    <div class="space-y-2 text-sm text-slate-400"><p><strong>核心 (Kernel):</strong> NuttX (即時 POSIX 系統)</p><p><strong>授權:</strong> BSD 3-Clause (商業友善)</p><p><strong>特色:</strong> 模組化架構，原生支援 ROS 2。</p></div>
                </div>
                <div id="content-ardupilot" class="p-8 hidden">
                    <div class="space-y-2 text-sm text-slate-400"><p><strong>核心 (Kernel):</strong> ChibiOS</p><p><strong>授權:</strong> GPL v3 (強制開源)</p><p><strong>特色:</strong> 功能極其豐富，支援 Lua 腳本。</p></div>
                </div>
            </div>
        </section>

        <!-- 10. Maintenance -->
        <section id="section-maint" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">故障診斷 (Diagnostics)</h2>
            </header>
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <select id="diagnostic-select" onchange="showDiagnosis()" class="w-full p-3 bg-slate-800 border border-slate-700 rounded text-slate-200 mb-4">
                    <option value="">選擇症狀 (Select Symptom)</option>
                    <option value="desync">馬達失步 (Motor Desync)</option>
                    <option value="mag">羅盤干擾 (Compass Error)</option>
                </select>
                <div id="diagnostic-result" class="hidden mt-4 p-4 bg-slate-950 border-l-4 border-emerald-500">
                    <h4 id="diag-title" class="font-bold text-emerald-400 mb-2"></h4>
                    <p id="diag-desc" class="text-sm text-slate-300"></p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Chart Defaults ---
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = '#334155';

        // --- Recommendation Logic (TC) ---
        function recommendBoard(type) {
            const el = document.getElementById('recommendation-result');
            el.classList.remove('hidden');
            if (type === 'industrial') {
                el.innerHTML = `
                    <div class="flex items-center mb-2"><span class="text-emerald-400 text-xl font-bold mr-2">推薦: Pixhawk 6X</span></div>
                    <p class="text-sm text-slate-300">原因：<strong>三路冗餘 (Triple Redundancy)</strong> 確保高可靠性。內建 <strong>Ethernet</strong> 支援 AI 機載電腦整合。</p>
                `;
                el.style.borderColor = '#10b981';
            } else {
                el.innerHTML = `
                    <div class="flex items-center mb-2"><span class="text-sky-400 text-xl font-bold mr-2">推薦: Pixhawk 6C</span></div>
                    <p class="text-sm text-slate-300">原因：<strong>成本優化 (Cost Optimized)</strong>。H743 處理器提供相同的飛行性能。雙路冗餘對於非關鍵任務已足夠。</p>
                `;
                el.style.borderColor = '#38bdf8';
            }
        }

        // --- Design Section Tabs Logic ---
        function showDesignTab(tabId) {
            // Hide all contents
            document.getElementById('content-modules').classList.add('hidden');
            document.getElementById('content-pinout').classList.add('hidden');
            
            // Remove active style from tabs
            document.getElementById('tab-modules').className = "px-6 py-4 text-sm font-bold text-slate-500 bg-slate-950 transition whitespace-nowrap";
            document.getElementById('tab-pinout').className = "px-6 py-4 text-sm font-bold text-slate-500 bg-slate-950 transition whitespace-nowrap";

            // Show selected content & style tab
            document.getElementById(`content-${tabId}`).classList.remove('hidden');
            if(tabId === 'modules') {
                document.getElementById('tab-modules').className = "px-6 py-4 text-sm font-bold text-pink-400 bg-slate-900 border-r border-slate-800 transition whitespace-nowrap";
            } else {
                document.getElementById('tab-pinout').className = "px-6 py-4 text-sm font-bold text-pink-400 bg-slate-900 border-l border-slate-800 transition whitespace-nowrap";
            }
        }

        // --- Data: Pixhawk Ports (TC Translated) ---
        const portDB = {
            power: {
                title: 'POWER 1 & 2 (電源)', subtitle: 'LTC4417 理想二極體', icon: '<i class="fa-solid fa-battery-full text-rose-500"></i>',
                content: `<table class="w-full pin-table">
                    <tr><th>腳位</th><th>訊號</th><th>電壓</th><th>備註</th></tr>
                    <tr><td>1,2</td><td>VCC</td><td class="v-5">5V</td><td>主電源輸入</td></tr>
                    <tr><td>3</td><td>I_SENS</td><td class="v-33">3.3V</td><td>電流感測 (類比)</td></tr>
                    <tr><td>4</td><td>V_SENS</td><td class="v-33">3.3V</td><td>電壓感測 (類比)</td></tr>
                    <tr><td>5,6</td><td>GND</td><td class="v-gnd">GND</td><td>接地</td></tr>
                </table><p class="mt-2 text-xs text-slate-400">優先權：Power1 > Power2 > USB</p>`
            },
            gps: {
                title: 'GPS 1 (定位)', subtitle: 'GNSS + 羅盤 + 安全開關', icon: '<i class="fa-solid fa-satellite text-emerald-500"></i>',
                content: `<table class="w-full pin-table">
                    <tr><th>腳位</th><th>訊號</th><th>電壓</th></tr>
                    <tr><td>1</td><td>VCC</td><td class="v-5">5V</td></tr>
                    <tr><td>2</td><td>TX</td><td class="v-33">3.3V</td></tr>
                    <tr><td>3</td><td>RX</td><td class="v-33">3.3V</td></tr>
                    <tr><td>4,5</td><td>I2C</td><td class="v-33">3.3V</td></tr>
                    <tr><td>6</td><td>Safe</td><td class="v-33">3.3V</td></tr>
                </table>`
            },
            telem: { title: 'TELEM 1 (數傳)', subtitle: '高功率輸出', icon: '<i class="fa-solid fa-wifi text-sky-500"></i>', content: `<table class="w-full pin-table"><tr><th>腳位</th><th>訊號</th><th>電壓</th></tr><tr><td>1</td><td>VCC</td><td class="v-5">5V (1.5A)</td></tr><tr><td>2,3</td><td>TX/RX</td><td class="v-33">3.3V</td></tr><tr><td>4,5</td><td>CTS/RTS</td><td class="v-33">3.3V</td></tr></table>` },
            fmu_pwm: { title: 'FMU PWM (輔助)', subtitle: 'DShot 馬達訊號', icon: '<i class="fa-solid fa-fan text-amber-500"></i>', content: `<p class="text-xs text-slate-300">直連 STM32 H7 Timer。用於 DShot 電調。</p><div class="mt-2 bg-slate-950 p-2 rounded border border-amber-900/50 text-xs text-amber-400">VCC 腳位通常未連接或光隔離。不可用於驅動舵機。</div>` },
            io_pwm: { title: 'IO PWM (主輸出)', subtitle: '舵機訊號', icon: '<i class="fa-solid fa-gears text-slate-400"></i>', content: `<p class="text-xs text-slate-300">由 F103 協處理器管理。</p><div class="mt-2 bg-slate-950 p-2 rounded border border-rose-900/50 text-xs text-rose-400">需要外部 BEC 接到 Servo Rail 供電。</div>` },
            can: { title: 'CAN 1/2', subtitle: 'UAVCAN', icon: '<i class="fa-solid fa-network-wired text-indigo-500"></i>', content: `<table class="w-full pin-table"><tr><th>腳位</th><th>訊號</th></tr><tr><td>1</td><td>VCC</td></tr><tr><td>2</td><td>CAN_H</td></tr><tr><td>3</td><td>CAN_L</td></tr><tr><td>4</td><td>GND</td></tr></table>` }
        };

        const bldcSpecs = {
            mcu: { icon: '<i class="fa-solid fa-microchip text-sky-500"></i>', title: 'STM32 G4', desc: '數學運算加速', specs: ['CORDIC/FMAC 引擎 (加速三角函數)', '3x 12-bit ADC (同步採樣)', 'TIM1 進階 PWM 定時器'] },
            driver: { icon: '<i class="fa-solid fa-charging-station text-amber-500"></i>', title: 'Gate Driver', desc: '閘極驅動器', specs: ['電流能力: Ig > Qg/tr', '死區時間 (Dead-time) 硬體插入', 'Bootstrap 電容 (高側驅動需用)'] },
            mosfet: { icon: '<i class="fa-solid fa-bolt text-rose-500"></i>', title: 'MOSFETs', desc: '逆變器橋', specs: ['Vds > 1.5倍 電池電壓', 'Rds(on) < 3mΩ (降低發熱)', '封裝: DFN 5x6 (散熱佳)'] }
        };

        const anatomyData = [
            { id: 'brain', icon: '🧠', title: 'FC (大腦)', desc: 'H753', specs: ['三路 IMU'] },
            { id: 'muscle', icon: '💪', title: 'ESC (肌肉)', desc: 'FOC', specs: ['DShot600'] },
            { id: 'senses', icon: '👁️', title: 'Sensor (感官)', desc: '陣列', specs: ['ICM/BMI'] },
            { id: 'heart', icon: '🔋', title: 'Power (心臟)', desc: 'PM02D', specs: ['I2C 數位'] }
        ];

        // --- Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            initVehicleChart();
            initAnatomyGrid();
            initDShotBits();
            initPidChart();
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                const s = document.getElementById('sidebar'); s.classList.toggle('hidden'); s.classList.toggle('fixed'); s.classList.toggle('inset-0');
            });
        });

        function navTo(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0,0);
            document.querySelectorAll('.nav-item').forEach(i => {
                i.classList.remove('active', 'bg-orange-900/10', 'text-orange-400', 'border-orange-400', 'bg-emerald-900/10', 'text-emerald-400', 'border-emerald-400', 'bg-sky-900/10', 'text-sky-400', 'border-sky-400', 'text-purple-400', 'border-purple-400', 'text-pink-400', 'border-pink-400', 'bg-slate-800');
                i.classList.add('text-slate-400', 'border-transparent');
            });
            const link = Array.from(document.querySelectorAll('.nav-item')).find(l => l.getAttribute('onclick').includes(id));
            if(link) {
                if(id.includes('roadmap')) link.classList.add('active', 'text-orange-400', 'border-l-4', 'border-orange-400');
                else if(id.includes('teardown')) link.classList.add('active', 'text-emerald-400', 'border-l-4', 'border-emerald-400');
                else if(id.includes('mcu')) link.classList.add('active', 'text-purple-400', 'border-l-4', 'border-purple-400');
                else if(id.includes('design')) link.classList.add('active', 'text-pink-400', 'border-l-4', 'border-pink-400');
                else if(id.includes('bldc') || id.includes('pixhawk')) link.classList.add('active', 'text-sky-400', 'border-l-4', 'border-sky-400');
                else link.classList.add('active', 'text-sky-400', 'border-l-4', 'border-sky-400');
                link.classList.remove('text-slate-400', 'border-transparent');
            }
            if(window.innerWidth < 768) { document.getElementById('sidebar').classList.add('hidden'); document.getElementById('sidebar').classList.remove('fixed', 'inset-0'); }
        }

        // --- Interactions ---
        function showBldcDetail(k) {
            const d = bldcSpecs[k];
            const b = document.getElementById('bldc-detail-box');
            document.getElementById('bldc-icon').innerHTML = d.icon;
            document.getElementById('bldc-title').innerText = d.title;
            document.getElementById('bldc-desc').innerText = d.desc;
            const l = document.getElementById('bldc-specs'); l.innerHTML = '';
            d.specs.forEach(s => l.innerHTML += `<li><span class="text-sky-500 mr-2">></span>${s}</li>`);
            b.classList.remove('hidden'); b.classList.add('animate-fade-in');
        }

        function showPortDetail(k) {
            const d = portDB[k];
            const p = document.getElementById('port-detail-panel');
            document.getElementById('port-icon').innerHTML = d.icon;
            document.getElementById('port-title').innerText = d.title;
            document.getElementById('port-content').innerHTML = d.content;
            p.classList.remove('animate-fade-in'); void p.offsetWidth; p.classList.add('animate-fade-in');
        }

        function initAnatomyGrid() {
            const c = document.getElementById('anatomy-grid');
            anatomyData.forEach(d => {
                const div = document.createElement('div');
                div.className = 'interactive-card bg-slate-900 p-4 rounded-xl border border-slate-800 shadow-lg text-center group';
                div.onclick = () => {
                    const b = document.getElementById('anatomy-detail');
                    document.getElementById('detail-title').innerText = d.title;
                    document.getElementById('detail-desc').innerText = d.desc;
                    const l = document.getElementById('detail-specs'); l.innerHTML = '';
                    d.specs.forEach(s => l.innerHTML += `<li>> ${s}</li>`);
                    b.classList.remove('hidden');
                };
                div.innerHTML = `<div class="text-3xl mb-2 grayscale group-hover:grayscale-0 transition">${d.icon}</div><h3 class="font-bold text-slate-200 text-sm">${d.title}</h3>`;
                c.appendChild(div);
            });
        }

        function initDShotBits() {
            const c = document.getElementById('dshot-bits');
            for(let i=0; i<16; i++) {
                const b = document.createElement('div');
                let color = i < 11 ? 'bg-emerald-500' : (i < 12 ? 'bg-amber-500' : 'bg-rose-500');
                b.className = `bit-box w-5 h-8 md:w-6 md:h-10 ${color} rounded opacity-60 hover:opacity-100 border border-white/10 m-0.5 cursor-help`;
                c.appendChild(b);
            }
        }

        function initVehicleChart() {
            new Chart(document.getElementById('vehicleChart'), {
                type: 'radar',
                data: {
                    labels: ['懸停穩定性', '巡航效率', '載重能力', '航程', '抗風性'],
                    datasets: [
                        { label: '多旋翼 (Multi)', data: [10, 3, 5, 3, 6], borderColor: '#38bdf8', backgroundColor: 'rgba(56, 189, 248, 0.2)' },
                        { label: '固定翼 (Fixed)', data: [0, 10, 7, 10, 4], borderColor: '#34d399', backgroundColor: 'rgba(52, 211, 153, 0.2)' },
                        { label: '垂直起降 (VTOL)', data: [8, 8, 6, 8, 5], borderColor: '#fbbf24', backgroundColor: 'rgba(251, 191, 36, 0.2)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { grid: { color: '#334155' }, angleLines: { color: '#334155' } } } }
            });
        }

        let pidChart;
        function initPidChart() {
            pidChart = new Chart(document.getElementById('pidChart'), {
                type: 'line',
                data: {
                    labels: [0,10,20,30,40,50,60,70,80],
                    datasets: [{ label: '目標值 (Target)', data: Array(9).fill(1), borderColor: '#64748b', borderDash: [5,5] }, { label: '響應 (Response)', data: [0, 0.6, 1.2, 0.9, 1.05, 0.98, 1.01, 1, 1], borderColor: '#34d399', backgroundColor: 'rgba(52, 211, 153, 0.1)', fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 1.5, grid: { color: '#1e293b' } }, x: { grid: { display: false } } } }
            });
        }
        function updatePidChart(t) {
            const m = { balanced: {d:[0, 0.6, 1.1, 0.95, 1.02, 0.99, 1, 1, 1], c:'#34d399'}, highP: {d:[0, 0.8, 1.4, 0.6, 1.3, 0.8, 1.1, 0.95, 1], c:'#f43f5e'} };
            const p = m[t];
            pidChart.data.datasets[1].data = p.d;
            pidChart.data.datasets[1].borderColor = p.c;
            pidChart.update();
        }

        // --- Software Stack Switcher ---
        function switchStack(id) {
            document.getElementById('content-px4').classList.add('hidden');
            document.getElementById('content-ardupilot').classList.add('hidden');
            document.getElementById(`content-${id}`).classList.remove('hidden');
            document.getElementById('tab-px4').className = id === 'px4' ? 'flex-1 py-4 font-bold text-sky-400 bg-slate-900 border-r border-slate-800 transition' : 'flex-1 py-4 font-bold text-slate-500 bg-slate-950 transition';
            document.getElementById('tab-ardupilot').className = id === 'ardupilot' ? 'flex-1 py-4 font-bold text-rose-400 bg-slate-900 transition' : 'flex-1 py-4 font-bold text-slate-500 bg-slate-950 transition';
        }

        function showDiagnosis() {
            const v = document.getElementById('diagnostic-select').value;
            const r = document.getElementById('diagnostic-result');
            const t = document.getElementById('diag-title');
            const d = document.getElementById('diag-desc');
            if(!v) { r.classList.add('hidden'); return; }
            const db = {
                desync: {t:'馬達失步 (Desync)', d:'建議操作：1. 在 BLHeli 中增加 Rampup Power。 2. 檢查馬達接線是否鬆脫。'},
                mag: {t:'羅盤干擾 (TBE)', d:'建議操作：1. 重新校準磁羅盤。 2. 將 GPS 支架移離 PDB 或電源線。'}
            };
            const data = db[v];
            t.innerText = data.t; d.innerText = data.d;
            r.classList.remove('hidden');
        }
    </script>
</body>
</html>
