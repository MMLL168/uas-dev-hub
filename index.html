<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAS R&D Hub (ç¹é«”ä¸­æ–‡å·¥ç¨‹ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #020617; /* slate-950 */
            color: #cbd5e1; /* slate-300 */
        }

        .mono-font { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Chart Container */
        .chart-container { position: relative; width: 100%; height: 300px; max-height: 400px; }

        /* Nav & Interactions */
        .nav-item.active { background-color: rgba(14, 165, 233, 0.15); color: #38bdf8; border-left: 3px solid #38bdf8; }
        
        .interactive-card, .port-connector, .topo-block {
            transition: all 0.2s ease; cursor: pointer; border: 1px solid #334155;
        }
        .interactive-card:hover, .port-connector:hover, .topo-block:hover {
            transform: translateY(-2px); box-shadow: 0 0 15px rgba(56, 189, 248, 0.15); border-color: #38bdf8; background-color: rgba(30, 41, 59, 0.8);
        }

        /* Hardware Specific Styles */
        .hw-block { border: 1px solid #334155; transition: all 0.2s ease; }
        .hw-block:hover { border-color: #38bdf8; box-shadow: 0 0 20px rgba(56, 189, 248, 0.1); transform: translateY(-2px); }

        /* Pinout Table Styles */
        .pin-table th { text-align: left; padding: 0.5rem; color: #94a3b8; font-size: 0.7rem; text-transform: uppercase; border-bottom: 1px solid #334155; }
        .pin-table td { padding: 0.5rem; border-bottom: 1px solid #1e293b; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #cbd5e1; }
        .pin-table tr:last-child td { border-bottom: none; }
        
        .voltage-tag { padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: bold; margin-right: 4px; display: inline-block;}
        .v-5 { background: rgba(244, 63, 94, 0.15); color: #fb7185; border: 1px solid rgba(244, 63, 94, 0.3); }
        .v-33 { background: rgba(56, 189, 248, 0.15); color: #38bdf8; border: 1px solid rgba(56, 189, 248, 0.3); }
        .v-gnd { background: rgba(148, 163, 184, 0.15); color: #94a3b8; border: 1px solid rgba(148, 163, 184, 0.3); }

        /* Bit Visualization */
        .bit-box { transition: all 0.2s; }
        .bit-box:hover { transform: scale(1.15); z-index: 10; box-shadow: 0 0 10px currentColor; }

        /* Roadmap */
        .roadmap-item { position: relative; padding-left: 2rem; padding-bottom: 2rem; border-left: 2px solid #334155; }
        .roadmap-item:last-child { border-left: 2px solid transparent; }
        .roadmap-dot { position: absolute; left: -0.55rem; top: 0; width: 1rem; height: 1rem; border-radius: 50%; background-color: #0f172a; border: 2px solid #38bdf8; }

        /* FOC Steps */
        .foc-step { position: relative; }
        .foc-step::after { content: 'âœ'; position: absolute; right: -20px; top: 50%; transform: translateY(-50%); color: #475569; font-size: 1.2rem; }
        .foc-step:last-child::after { display: none; }
        @media (max-width: 768px) { .foc-step::after { right: 50%; top: auto; bottom: -25px; transform: translateX(50%) rotate(90deg); } }

        /* Source Badge */
        .source-badge { display: inline-flex; align-items: center; padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge-holybro { background-color: rgba(234, 88, 12, 0.1); border: 1px solid rgba(234, 88, 12, 0.3); color: #fb923c; }
        .badge-teardown { background-color: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); color: #34d399; }
        .badge-standard { background-color: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); color: #60a5fa; }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <!-- Mobile Header -->
    <div class="md:hidden bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center sticky top-0 z-50">
        <h1 class="font-bold text-lg text-slate-100"><i class="fa-solid fa-code mr-2"></i>UAS R&D Hub</h1>
        <button id="mobile-menu-btn" class="text-slate-400 focus:outline-none text-2xl">â˜°</button>
    </div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="hidden md:flex flex-col w-64 bg-slate-900 border-r border-slate-800 h-screen sticky top-0 z-40 overflow-y-auto">
        <div class="p-6 border-b border-slate-800">
            <h1 class="text-xl font-bold text-slate-100 tracking-tight mono-font">
                UAS<span class="text-sky-500">_Dev</span>
            </h1>
            <p class="text-xs text-slate-500 mt-1">ç¹é«”ä¸­æ–‡å·¥ç¨‹ç‰ˆ (TC Edition)</p>
        </div>
        <div class="flex-1 py-4 space-y-1">
            <!-- Strategic -->
            <div class="px-4 py-2 text-xs font-bold text-slate-600 uppercase tracking-wider">æˆ°ç•¥è¦åŠƒ (Strategic)</div>
            <a href="#" onclick="navTo('section-roadmap')" class="nav-item block px-6 py-3 text-sm font-medium text-orange-400 hover:bg-slate-800 hover:text-orange-200 border-l-4 border-transparent transition-colors active bg-orange-900/10"><i class="fa-solid fa-chess-knight mr-2 w-4"></i>æŠ€è¡“è·¯ç·šåœ– (Roadmap)</a>
            <a href="#" onclick="navTo('section-teardown')" class="nav-item block px-6 py-3 text-sm font-medium text-emerald-400 hover:bg-slate-800 hover:text-emerald-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-box-open mr-2 w-4"></i>X500 ç¡¬é«”æ‹†è§£ (Ref)</a>

            <!-- Hardware Deep Dive -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">ç¡¬é«”å·¥ç¨‹ (Hardware)</div>
            <a href="#" onclick="navTo('section-pixhawk')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-microchip mr-2 w-4"></i>Pixhawk 6X vs 6C</a>
            <a href="#" onclick="navTo('section-bldc')" class="nav-item block px-6 py-3 text-sm font-medium text-sky-400 hover:bg-slate-800 hover:text-sky-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-bolt mr-2 w-4"></i>BLDC é¦¬é”å¯¦é©—å®¤ (Full)</a>
            <a href="#" onclick="navTo('section-hardware')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-dna mr-2 w-4"></i>ç¡¬é«”è§£å‰– (Anatomy)</a>
            
            <!-- System & Logic -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">æ§åˆ¶èˆ‡é‚è¼¯ (Logic)</div>
            <a href="#" onclick="navTo('section-intro')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-chart-pie mr-2 w-4"></i>ç³»çµ±æ¦‚è§€ (Physics)</a>
            <a href="#" onclick="navTo('section-protocols')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-wave-square mr-2 w-4"></i>DShot é€šè¨Šæ™‚åº</a>
            <a href="#" onclick="navTo('section-pid')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-arrow-trend-up mr-2 w-4"></i>PID æ§åˆ¶ç†è«–</a>
            
            <!-- Ops -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">ç‡Ÿé‹èˆ‡ç¶­è­· (Ops)</div>
            <a href="#" onclick="navTo('section-software')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-brands fa-git-alt mr-2 w-4"></i>è»Ÿé«”æ£§ (Stack)</a>
            <a href="#" onclick="navTo('section-maint')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-wrench mr-2 w-4"></i>æ•…éšœè¨ºæ–· (Debug)</a>
        </div>
        <div class="p-4 bg-slate-950 border-t border-slate-800 text-xs text-slate-500">Engineer: Marlon</div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 p-4 md:p-10 overflow-x-hidden">

        <!-- 1. Roadmap -->
        <section id="section-roadmap" class="mb-16 animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">æŠ€è¡“å‰ç» (Tech Roadmap)</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-holybro">å®˜æ–¹ä¾†æº</span><span>Holybro CTO @ PX4 Summit</span>
                </div>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-slate-200 mb-6 flex items-center"><i class="fa-solid fa-timeline mr-2 text-orange-500"></i>æ¬¡ä¸–ä»£èˆªé›»æ¶æ§‹</h3>
                    <div class="pl-2 space-y-6 border-l-2 border-slate-800 ml-2">
                        <div class="roadmap-item">
                            <div class="roadmap-dot border-orange-500"></div>
                            <h4 class="text-base font-bold text-orange-400">FMURT7 (i.MX RT1176)</h4>
                            <p class="text-sm text-slate-400 mt-1">1GHz é›™æ ¸å¿ƒ (Cortex-M7/M4)ã€‚çªç ´ STM32 çš„æ•ˆèƒ½ç“¶é ¸ï¼ŒåŸç”Ÿæ”¯æ´ä¹™å¤ªç¶² (Ethernet)ï¼Œé©åˆé‚Šç·£ AI è¨ˆç®—ã€‚</p>
                        </div>
                        <div class="roadmap-item">
                            <div class="roadmap-dot border-sky-500"></div>
                            <h4 class="text-base font-bold text-sky-400">PAB æ¨™æº– (Pixhawk Autopilot Bus)</h4>
                            <p class="text-sm text-slate-400 mt-1">æ¨¡çµ„åŒ–è¨­è¨ˆæ¨™æº–ã€‚å°‡ã€Œé£›æ§æ ¸å¿ƒ (Core)ã€èˆ‡ã€Œè¼‰æ¿ (Baseboard)ã€åˆ†é›¢ï¼Œå¯¦ç¾ç¡¬é«”ç†±æ’æ‹”å‡ç´šã€‚</p>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h4 class="font-bold text-slate-200 mb-3 text-sm uppercase tracking-wider">é«˜éšå‘¨é‚Šè¨­å‚™</h4>
                    <div class="space-y-3">
                        <div class="bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 text-sm block">Unicore UM982 (é›™å¤©ç·š RTK)</strong>
                            <p class="text-xs text-slate-500 mt-1">æ”¯æ´ GPS Heading (é›™å¤©ç·šå®šèˆªå‘)ã€‚åœ¨é«˜å£“é›»å¡”æˆ–å¤§å‹é‡‘å±¬çµæ§‹æ—ï¼Œå¯å®Œå…¨å…ç–«ç£ç¾…ç›¤å¹²æ“¾ã€‚</p>
                        </div>
                        <div class="bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 text-sm block">PM08D (200A æ•¸ä½é›»æµè¨ˆ)</strong>
                            <p class="text-xs text-slate-500 mt-1">I2C æ•¸ä½å‚³è¼¸ã€‚å°ˆç‚º 14S é«˜å£“è¾²æ¥­æ©Ÿèˆ‡ç‰©æµç„¡äººæ©Ÿè¨­è¨ˆã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Pixhawk 6 Standards (TC Localized) -->
        <section id="section-pixhawk" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Pixhawk 6X/6C ç¡¬é«”æ¨™æº–å°ç…§</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-standard">DS-012/018</span>
                    <span>è¦æ ¼å·²é©—è­‰ (Specs Verified)</span>
                </div>
            </header>

            <!-- Use Case Selector (TC) -->
            <div class="mb-8 bg-slate-900 p-6 rounded-xl border border-slate-800">
                <h3 class="text-lg font-bold text-white mb-4"><i class="fa-solid fa-filter mr-2 text-sky-500"></i>æ‡‰ç”¨å ´æ™¯å»ºè­° (Selection Guide)</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <button onclick="recommendBoard('industrial')" class="p-4 bg-slate-950 border border-emerald-900/50 hover:border-emerald-500 hover:bg-emerald-900/10 rounded-lg text-left transition group">
                        <strong class="text-emerald-400 block mb-1 group-hover:translate-x-1 transition-transform">å·¥æ¥­/ç§‘ç ” (Industrial)</strong>
                        <span class="text-xs text-slate-500">BVLOS è¶…è¦–è·ã€æ¸¬ç¹ªã€AI é‚Šç·£é‹ç®—ã€é«˜åƒ¹å€¼è¼‰è·ã€‚</span>
                    </button>
                    <button onclick="recommendBoard('swarm')" class="p-4 bg-slate-950 border border-sky-900/50 hover:border-sky-500 hover:bg-sky-900/10 rounded-lg text-left transition group">
                        <strong class="text-sky-400 block mb-1 group-hover:translate-x-1 transition-transform">æ©Ÿç¾¤/æ•™è‚² (Swarms/Edu)</strong>
                        <span class="text-xs text-slate-500">ç„¡äººæ©Ÿç‡ˆå…‰ç§€ã€ç©¿è¶Šæ©Ÿã€å¤§å­¸å¯¦é©—å®¤ã€æˆæœ¬æ•æ„Ÿå‹å°ˆæ¡ˆã€‚</span>
                    </button>
                </div>
                <div id="recommendation-result" class="mt-4 p-4 bg-slate-800 rounded border-l-4 border-slate-600 hidden animate-fade-in">
                    <!-- JS populated -->
                </div>
            </div>

            <div class="bg-slate-950 rounded-xl border border-slate-800 overflow-hidden mb-8">
                <table class="w-full comp-table text-slate-300">
                    <thead>
                        <tr class="bg-slate-900">
                            <th class="w-1/4">è¦æ ¼é …ç›® (Spec)</th>
                            <th class="w-1/3 text-emerald-400">Pixhawk 6X (æ——è‰¦ç‰ˆ)</th>
                            <th class="w-1/3 text-sky-400">Pixhawk 6C (æ¨™æº–ç‰ˆ)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>MCU (è™•ç†å™¨)</td>
                            <td><strong class="text-slate-200">STM32H753</strong><br><span class="text-xs text-slate-500">å…§å»ºç¡¬é«”åŠ å¯†/HashåŠ é€Ÿå™¨</span></td>
                            <td><strong class="text-slate-200">STM32H743</strong><br><span class="text-xs text-slate-500">æ¨™æº–é«˜æ•ˆèƒ½æ ¸å¿ƒ</span></td>
                        </tr>
                        <tr>
                            <td>Redundancy (å†—é¤˜)</td>
                            <td><span class="bg-emerald-900/30 text-emerald-400 px-2 py-0.5 rounded text-xs">ä¸‰è·¯å†—é¤˜ (3x Domains)</span></td>
                            <td><span class="bg-slate-800 text-slate-400 px-2 py-0.5 rounded text-xs">é›™è·¯å†—é¤˜ (2x Domains)</span></td>
                        </tr>
                        <tr>
                            <td>Connectivity (é€£æ¥)</td>
                            <td><span class="text-emerald-400">Ethernet (100Base-T)</span></td>
                            <td><span class="text-slate-500">ç„¡ (åƒ… USB OTG)</span></td>
                        </tr>
                        <tr>
                            <td>Security (å®‰å…¨)</td>
                            <td><span class="text-emerald-400">NXP SE050 (å®‰å…¨æ™¶ç‰‡)</span></td>
                            <td><span class="text-slate-500">ç„¡</span></td>
                        </tr>
                        <tr>
                            <td>Form Factor (å¤–å‹)</td>
                            <td>æ¨¡çµ„åŒ– (ç¬¦åˆ PAB æ¨™æº–)</td>
                            <td>æ•´åˆå¼ (å°ˆæœ‰ä»‹é¢)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Port Map (6X Standard) -->
            <div class="grid lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">Port Pinout (6X è¼‰æ¿åƒè€ƒ)</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('power')">
                            <div class="port-label text-rose-400">POWER 1 & 2</div><i class="fa-solid fa-battery-full text-xl text-rose-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('gps')">
                            <div class="port-label text-emerald-400">GPS 1 & 2</div><i class="fa-solid fa-satellite text-xl text-emerald-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('telem')">
                            <div class="port-label text-sky-400">TELEM 1-3</div><i class="fa-solid fa-wifi text-xl text-sky-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('fmu_pwm')">
                            <div class="port-label text-amber-400">FMU PWM</div><i class="fa-solid fa-fan text-xl text-amber-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('io_pwm')">
                            <div class="port-label text-slate-300">IO PWM</div><i class="fa-solid fa-gears text-xl text-slate-400 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('can')">
                            <div class="port-label text-indigo-400">CAN 1 & 2</div><i class="fa-solid fa-network-wired text-xl text-indigo-500 my-2"></i>
                        </div>
                    </div>
                </div>
                <!-- Detail Panel -->
                <div class="lg:col-span-1">
                    <div id="port-detail-panel" class="bg-slate-900 border border-slate-700 h-full rounded-xl p-6 shadow-lg animate-fade-in flex flex-col">
                        <div class="flex items-center mb-4 pb-4 border-b border-slate-800">
                            <div id="port-icon" class="text-2xl mr-3"></div>
                            <div><h4 id="port-title" class="text-xl font-bold text-white">è«‹é¸æ“‡æ¥å£</h4></div>
                        </div>
                        <div id="port-content" class="text-sm text-slate-400 flex-1 overflow-y-auto"><p class="italic opacity-70">é»æ“Šå·¦å´åœ–è¡¨ä»¥æŸ¥çœ‹è©³ç´°é›»æ°£è¦æ ¼ã€‚</p></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Teardown (Ref) -->
        <section id="section-teardown" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">X500 V2 ç¡¬é«”åƒè€ƒè¨­è¨ˆ</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-teardown">å¯¦æ©Ÿé©—è­‰</span>
                    <span>X500 V2 æ¨™æº–é–‹ç™¼å¥—ä»¶</span>
                </div>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-slate-200 mb-4">BOM è¡¨èˆ‡è¦æ ¼</h3>
                    <div class="space-y-4 font-mono text-sm">
                        <div class="border-l-2 border-emerald-500 pl-4">
                            <div class="text-emerald-400 font-bold">1. æ©Ÿæ¶ (Frame)</div>
                            <div class="text-xs text-slate-500">X500 V2 (500mm è»¸è·)ã€‚æ•´åˆå°„å‡ºæˆå‹ PDB (ç„¡éœ€ç„Šæ¥)ã€‚</div>
                        </div>
                        <div class="border-l-2 border-rose-500 pl-4">
                            <div class="text-rose-400 font-bold">2. å‹•åŠ› (Propulsion)</div>
                            <div class="text-xs text-slate-500">
                                é¦¬é”: 2216 920KV (é¡ä¼¼ DJI F450 è¦æ ¼)<br>
                                é›»èª¿: 20A BLHeli_S (ç¡¬é«”æ”¯æ´ DShot)<br>
                                èºæ—‹æ§³: 1045 è‡ªé–æ§³
                            </div>
                        </div>
                        <div class="border-l-2 border-sky-500 pl-4">
                            <div class="text-sky-400 font-bold">3. èˆªé›» (Avionics)</div>
                            <div class="text-xs text-slate-500">
                                é£›æ§: Pixhawk 6C (æ¨™æº–ç‰ˆ)<br>
                                é›»æºæ¨¡çµ„: PM02D (I2C æ•¸ä½ç›£æ§)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h4 class="font-bold text-slate-200 mb-3 text-sm uppercase"><i class="fa-solid fa-triangle-exclamation text-yellow-500 mr-2"></i>çµ„è£æ³¨æ„äº‹é … (Critical Notes)</h4>
                    <ul class="text-sm text-slate-400 space-y-2 list-disc list-inside">
                        <li><strong>PM02 vs PM02D:</strong> å‹™å¿…ç¢ºèª PX4 åƒæ•¸ <code class="bg-slate-800 px-1 rounded text-sky-300">SENS_EN_INA226</code> å·²å•Ÿç”¨ï¼Œå¦å‰‡ç„¡æ³•è®€å–é›»å£“ï¼ˆå› ç‚ºæ˜¯æ•¸ä½è¨Šè™Ÿï¼‰ã€‚</li>
                        <li><strong>é¦¬é”é †åº:</strong> PX4 çš„ Quad-X å®šç¾©ç‚ºï¼šM1(å³å‰/CCW), M2(å·¦å¾Œ/CCW), M3(å·¦å‰/CW), M4(å³å¾Œ/CW)ã€‚é€™èˆ‡ ArduPilot ä¸åŒã€‚</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 4. BLDC Lab (Full Math) -->
        <section id="section-bldc" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">BLDC é¦¬é”æ§åˆ¶æ¿å¯¦é©—å®¤</h2>
                <p class="text-slate-400 max-w-3xl">STM32 FOC æ¶æ§‹èˆ‡å…ƒä»¶é¸å‹å…¬å¼ã€‚</p>
            </header>

            <!-- Topology -->
            <div class="bg-slate-950 p-6 rounded-xl border border-slate-800 shadow-inner mb-8 overflow-x-auto">
                <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">é€†è®Šå™¨æ‹“æ’² (Inverter Topology)</h3>
                <div class="flex flex-col md:flex-row gap-4 items-stretch min-w-[700px]">
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('mcu')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-sky-400 text-xs px-2 py-0.5 rounded border border-slate-700">æ§åˆ¶å™¨ (MCU)</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-microchip text-3xl text-sky-500 mb-2"></i><h4 class="font-bold text-slate-200">STM32 G4</h4></div>
                    </div>
                    <div class="flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-right-long text-xl"></i></div>
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('driver')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-amber-400 text-xs px-2 py-0.5 rounded border border-slate-700">é é©… (Pre-Driver)</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-charging-station text-3xl text-amber-500 mb-2"></i><h4 class="font-bold text-slate-200">Gate Driver</h4></div>
                    </div>
                    <div class="flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-right-long text-xl"></i></div>
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('mosfet')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-rose-400 text-xs px-2 py-0.5 rounded border border-slate-700">åŠŸç‡ç´š (Power Stage)</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-bolt text-3xl text-rose-500 mb-2"></i><h4 class="font-bold text-slate-200">MOSFETs</h4></div>
                    </div>
                </div>
            </div>

            <div id="bldc-detail-box" class="bg-slate-800 border border-slate-700 p-6 rounded-xl shadow-lg mb-8 hidden">
                <div class="flex items-start">
                    <div class="mr-4 text-3xl" id="bldc-icon"></div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-slate-100 mb-2" id="bldc-title"></h3>
                        <p class="text-slate-300 mb-4 text-sm" id="bldc-desc"></p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-800">
                            <h4 class="text-xs text-sky-500 font-bold uppercase mb-3">é¸å‹å…¬å¼ (Engineering Math)</h4>
                            <ul class="text-sm text-slate-400 mono-font space-y-3" id="bldc-specs"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FOC Workflow -->
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <h3 class="text-lg font-bold text-slate-200 mb-6 flex items-center"><i class="fa-solid fa-wave-square mr-2 text-emerald-500"></i>FOC æ§åˆ¶æµç¨‹ (Control Loop)</h3>
                <div class="grid md:grid-cols-4 gap-4 text-center">
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm">1. ADC æ¡æ¨£</h4>
                        <p class="text-xs text-slate-400 mt-2">è®€å–ç›¸é›»æµ Ia, Ib</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm">2. åº§æ¨™è®Šæ›</h4>
                        <p class="text-xs text-slate-400 mt-2">Clarke / Park (abcè½‰dq)</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm">3. PID æ§åˆ¶</h4>
                        <p class="text-xs text-slate-400 mt-2">é›»æµç’°/é€Ÿåº¦ç’°è¨ˆç®—</p>
                    </div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm">4. SVPWM</h4>
                        <p class="text-xs text-slate-400 mt-2">ç©ºé–“å‘é‡èª¿è®Šè¼¸å‡º</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. System Overview (Physics) -->
        <section id="section-intro" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">ç³»çµ±æ¦‚è§€ (ç‰©ç†ç‰¹æ€§)</h2>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <div class="chart-container"><canvas id="vehicleChart"></canvas></div>
                </div>
                <div class="space-y-4">
                    <div class="bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-sky-400 block mb-1">åœ“ç›¤è² è¼‰ (Disk Loading)</strong>
                        <p class="text-xs text-slate-400">$$ DL = \frac{Weight}{PropArea} $$</p>
                        <p class="text-xs text-slate-500 mt-1">DL é«˜ (ç«¶é€Ÿæ©Ÿ) = æŠ—é¢¨æ€§å¼·ï¼Œæ•ˆç‡ä½ã€‚<br>DL ä½ (é•·èˆªæ™‚) = æ•ˆç‡é«˜ï¼Œæ˜“å—é¢¨å½±éŸ¿ã€‚</p>
                    </div>
                    <div class="bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-emerald-400 block mb-1">å¤±é€Ÿé€Ÿåº¦ (Stall Speed)</strong>
                        <p class="text-xs text-slate-400">$$ V_{stall} = \sqrt{\frac{2W}{\rho S C_{L,max}}} $$</p>
                        <p class="text-xs text-slate-500 mt-1">å›ºå®šç¿¼é—œéµåƒæ•¸ã€‚é£›è¡Œé€Ÿåº¦å¿…é ˆé«˜æ–¼æ­¤å€¼ä»¥ç¶­æŒå‡åŠ›ã€‚</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Hardware Anatomy -->
        <section id="section-hardware" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">ç¡¬é«”è§£å‰– (ç”Ÿç†å­¸è§€é»)</h2>
            </header>
            <div class="grid md:grid-cols-4 gap-4" id="anatomy-grid"></div>
            <div id="anatomy-detail" class="mt-6 bg-slate-800/50 border border-slate-700 p-6 rounded-xl shadow-lg hidden">
                <h3 id="detail-title" class="text-xl font-bold text-sky-400 mb-2"></h3>
                <p id="detail-desc" class="text-slate-300 mb-2"></p>
                <div class="bg-slate-950 p-3 rounded border border-slate-800"><ul class="space-y-1 text-sm text-emerald-400 mono-font" id="detail-specs"></ul></div>
            </div>
        </section>

        <!-- 7. Protocols -->
        <section id="section-protocols" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">DShot é€šè¨Šæ™‚åº</h2>
            </header>
            <div class="bg-slate-900 p-8 rounded-xl shadow-lg border border-slate-800">
                <div class="flex flex-wrap justify-center gap-1 mb-8" id="dshot-bits"></div>
                <div class="grid md:grid-cols-3 gap-4 text-center text-xs mono-font">
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot150</strong><span>150 kbit/s</span></div>
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot300</strong><span>300 kbit/s</span></div>
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot600</strong><span>600 kbit/s</span></div>
                </div>
            </div>
        </section>

        <!-- 8. PID -->
        <section id="section-pid" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">PID æ§åˆ¶ç†è«–</h2>
            </header>
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <div class="mb-6 bg-slate-950 p-4 rounded border border-slate-700 text-center">
                    <p class="text-slate-300 text-sm mono-font">$$ u(t) = K_p e(t) + K_i \int_0^t e(\tau)d\tau + K_d \frac{de(t)}{dt} + FF $$</p>
                    <p class="text-xs text-slate-500 mt-2">æ¨™æº– PID å…¬å¼ + å‰é¥‹æ§åˆ¶ (Feed Forward) ä»¥è£œå„Ÿå»¶é²ã€‚</p>
                </div>
                <div class="chart-container"><canvas id="pidChart"></canvas></div>
                <div class="flex justify-center gap-4 mt-4">
                    <button onclick="updatePidChart('balanced')" class="px-3 py-1 bg-emerald-900/30 text-emerald-400 border border-emerald-800 rounded">å®Œç¾èª¿æ ¡ (Balanced)</button>
                    <button onclick="updatePidChart('highP')" class="px-3 py-1 bg-rose-900/30 text-rose-400 border border-rose-800 rounded">På€¼éé«˜ (High P)</button>
                </div>
            </div>
        </section>

        <!-- 9. Software -->
        <section id="section-software" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">è»Ÿé«”æ£§ (Software Stack)</h2>
            </header>
            <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
                <div class="flex border-b border-slate-800 bg-slate-950">
                    <button id="tab-px4" onclick="switchStack('px4')" class="flex-1 py-4 font-bold text-sky-400 bg-slate-900 border-r border-slate-800 transition">PX4 Autopilot</button>
                    <button id="tab-ardupilot" onclick="switchStack('ardupilot')" class="flex-1 py-4 font-bold text-slate-500 bg-slate-950 transition">ArduPilot</button>
                </div>
                <div id="content-px4" class="p-8">
                    <div class="space-y-2 text-sm text-slate-400"><p><strong>æ ¸å¿ƒ (Kernel):</strong> NuttX (å³æ™‚ POSIX ç³»çµ±)</p><p><strong>æˆæ¬Š:</strong> BSD 3-Clause (å•†æ¥­å‹å–„)</p><p><strong>ç‰¹è‰²:</strong> æ¨¡çµ„åŒ–æ¶æ§‹ï¼ŒåŸç”Ÿæ”¯æ´ ROS 2ã€‚</p></div>
                </div>
                <div id="content-ardupilot" class="p-8 hidden">
                    <div class="space-y-2 text-sm text-slate-400"><p><strong>æ ¸å¿ƒ (Kernel):</strong> ChibiOS</p><p><strong>æˆæ¬Š:</strong> GPL v3 (å¼·åˆ¶é–‹æº)</p><p><strong>ç‰¹è‰²:</strong> åŠŸèƒ½æ¥µå…¶è±å¯Œï¼Œæ”¯æ´ Lua è…³æœ¬ã€‚</p></div>
                </div>
            </div>
        </section>

        <!-- 10. Maintenance -->
        <section id="section-maint" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">æ•…éšœè¨ºæ–· (Diagnostics)</h2>
            </header>
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <select id="diagnostic-select" onchange="showDiagnosis()" class="w-full p-3 bg-slate-800 border border-slate-700 rounded text-slate-200 mb-4">
                    <option value="">é¸æ“‡ç—‡ç‹€ (Select Symptom)</option>
                    <option value="desync">é¦¬é”å¤±æ­¥ (Motor Desync)</option>
                    <option value="mag">ç¾…ç›¤å¹²æ“¾ (Compass Error)</option>
                </select>
                <div id="diagnostic-result" class="hidden mt-4 p-4 bg-slate-950 border-l-4 border-emerald-500">
                    <h4 id="diag-title" class="font-bold text-emerald-400 mb-2"></h4>
                    <p id="diag-desc" class="text-sm text-slate-300"></p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Chart Defaults ---
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = '#334155';

        // --- Recommendation Logic (TC) ---
        function recommendBoard(type) {
            const el = document.getElementById('recommendation-result');
            el.classList.remove('hidden');
            if (type === 'industrial') {
                el.innerHTML = `
                    <div class="flex items-center mb-2"><span class="text-emerald-400 text-xl font-bold mr-2">æ¨è–¦: Pixhawk 6X</span></div>
                    <p class="text-sm text-slate-300">åŸå› ï¼š<strong>ä¸‰è·¯å†—é¤˜ (Triple Redundancy)</strong> ç¢ºä¿é«˜å¯é æ€§ã€‚å…§å»º <strong>Ethernet</strong> æ”¯æ´ AI æ©Ÿè¼‰é›»è…¦æ•´åˆã€‚</p>
                `;
                el.style.borderColor = '#10b981';
            } else {
                el.innerHTML = `
                    <div class="flex items-center mb-2"><span class="text-sky-400 text-xl font-bold mr-2">æ¨è–¦: Pixhawk 6C</span></div>
                    <p class="text-sm text-slate-300">åŸå› ï¼š<strong>æˆæœ¬å„ªåŒ– (Cost Optimized)</strong>ã€‚H743 è™•ç†å™¨æä¾›ç›¸åŒçš„é£›è¡Œæ€§èƒ½ã€‚é›™è·¯å†—é¤˜å°æ–¼éé—œéµä»»å‹™å·²è¶³å¤ ã€‚</p>
                `;
                el.style.borderColor = '#38bdf8';
            }
        }

        // --- Data: Pixhawk Ports (TC Translated) ---
        const portDB = {
            power: {
                title: 'POWER 1 & 2 (é›»æº)', subtitle: 'LTC4417 ç†æƒ³äºŒæ¥µé«”', icon: '<i class="fa-solid fa-battery-full text-rose-500"></i>',
                content: `<table class="w-full pin-table">
                    <tr><th>è…³ä½</th><th>è¨Šè™Ÿ</th><th>é›»å£“</th><th>å‚™è¨»</th></tr>
                    <tr><td>1,2</td><td>VCC</td><td class="v-5">5V</td><td>ä¸»é›»æºè¼¸å…¥</td></tr>
                    <tr><td>3</td><td>I_SENS</td><td class="v-33">3.3V</td><td>é›»æµæ„Ÿæ¸¬ (é¡æ¯”)</td></tr>
                    <tr><td>4</td><td>V_SENS</td><td class="v-33">3.3V</td><td>é›»å£“æ„Ÿæ¸¬ (é¡æ¯”)</td></tr>
                    <tr><td>5,6</td><td>GND</td><td class="v-gnd">GND</td><td>æ¥åœ°</td></tr>
                </table><p class="mt-2 text-xs text-slate-400">å„ªå…ˆæ¬Šï¼šPower1 > Power2 > USB</p>`
            },
            gps: {
                title: 'GPS 1 (å®šä½)', subtitle: 'GNSS + ç¾…ç›¤ + å®‰å…¨é–‹é—œ', icon: '<i class="fa-solid fa-satellite text-emerald-500"></i>',
                content: `<table class="w-full pin-table">
                    <tr><th>è…³ä½</th><th>è¨Šè™Ÿ</th><th>é›»å£“</th></tr>
                    <tr><td>1</td><td>VCC</td><td class="v-5">5V</td></tr>
                    <tr><td>2</td><td>TX</td><td class="v-33">3.3V</td></tr>
                    <tr><td>3</td><td>RX</td><td class="v-33">3.3V</td></tr>
                    <tr><td>4,5</td><td>I2C</td><td class="v-33">3.3V</td></tr>
                    <tr><td>6</td><td>Safe</td><td class="v-33">3.3V</td></tr>
                </table>`
            },
            telem: { title: 'TELEM 1 (æ•¸å‚³)', subtitle: 'é«˜åŠŸç‡è¼¸å‡º', icon: '<i class="fa-solid fa-wifi text-sky-500"></i>', content: `<table class="w-full pin-table"><tr><th>è…³ä½</th><th>è¨Šè™Ÿ</th><th>é›»å£“</th></tr><tr><td>1</td><td>VCC</td><td class="v-5">5V (1.5A)</td></tr><tr><td>2,3</td><td>TX/RX</td><td class="v-33">3.3V</td></tr><tr><td>4,5</td><td>CTS/RTS</td><td class="v-33">3.3V</td></tr></table>` },
            fmu_pwm: { title: 'FMU PWM (è¼”åŠ©)', subtitle: 'DShot é¦¬é”è¨Šè™Ÿ', icon: '<i class="fa-solid fa-fan text-amber-500"></i>', content: `<p class="text-xs text-slate-300">ç›´é€£ STM32 H7 Timerã€‚ç”¨æ–¼ DShot é›»èª¿ã€‚</p><div class="mt-2 bg-slate-950 p-2 rounded border border-amber-900/50 text-xs text-amber-400">VCC è…³ä½é€šå¸¸æœªé€£æ¥æˆ–å…‰éš”é›¢ã€‚ä¸å¯ç”¨æ–¼é©…å‹•èˆµæ©Ÿã€‚</div>` },
            io_pwm: { title: 'IO PWM (ä¸»è¼¸å‡º)', subtitle: 'èˆµæ©Ÿè¨Šè™Ÿ', icon: '<i class="fa-solid fa-gears text-slate-400"></i>', content: `<p class="text-xs text-slate-300">ç”± F103 å”è™•ç†å™¨ç®¡ç†ã€‚</p><div class="mt-2 bg-slate-950 p-2 rounded border border-rose-900/50 text-xs text-rose-400">éœ€è¦å¤–éƒ¨ BEC æ¥åˆ° Servo Rail ä¾›é›»ã€‚</div>` },
            can: { title: 'CAN 1/2', subtitle: 'UAVCAN', icon: '<i class="fa-solid fa-network-wired text-indigo-500"></i>', content: `<table class="w-full pin-table"><tr><th>è…³ä½</th><th>è¨Šè™Ÿ</th></tr><tr><td>1</td><td>VCC</td></tr><tr><td>2</td><td>CAN_H</td></tr><tr><td>3</td><td>CAN_L</td></tr><tr><td>4</td><td>GND</td></tr></table>` }
        };

        const bldcSpecs = {
            mcu: { icon: '<i class="fa-solid fa-microchip text-sky-500"></i>', title: 'STM32 G4', desc: 'æ•¸å­¸é‹ç®—åŠ é€Ÿ', specs: ['CORDIC/FMAC å¼•æ“ (åŠ é€Ÿä¸‰è§’å‡½æ•¸)', '3x 12-bit ADC (åŒæ­¥æ¡æ¨£)', 'TIM1 é€²éš PWM å®šæ™‚å™¨'] },
            driver: { icon: '<i class="fa-solid fa-charging-station text-amber-500"></i>', title: 'Gate Driver', desc: 'é–˜æ¥µé©…å‹•å™¨', specs: ['é›»æµèƒ½åŠ›: Ig > Qg/tr', 'æ­»å€æ™‚é–“ (Dead-time) ç¡¬é«”æ’å…¥', 'Bootstrap é›»å®¹ (é«˜å´é©…å‹•éœ€ç”¨)'] },
            mosfet: { icon: '<i class="fa-solid fa-bolt text-rose-500"></i>', title: 'MOSFETs', desc: 'é€†è®Šå™¨æ©‹', specs: ['Vds > 1.5å€ é›»æ± é›»å£“', 'Rds(on) < 3mÎ© (é™ä½ç™¼ç†±)', 'å°è£: DFN 5x6 (æ•£ç†±ä½³)'] }
        };

        const anatomyData = [
            { id: 'brain', icon: 'ğŸ§ ', title: 'FC (å¤§è…¦)', desc: 'H753', specs: ['ä¸‰è·¯ IMU'] },
            { id: 'muscle', icon: 'ğŸ’ª', title: 'ESC (è‚Œè‚‰)', desc: 'FOC', specs: ['DShot600'] },
            { id: 'senses', icon: 'ğŸ‘ï¸', title: 'Sensor (æ„Ÿå®˜)', desc: 'é™£åˆ—', specs: ['ICM/BMI'] },
            { id: 'heart', icon: 'ğŸ”‹', title: 'Power (å¿ƒè‡Ÿ)', desc: 'PM02D', specs: ['I2C æ•¸ä½'] }
        ];

        // --- Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            initVehicleChart();
            initAnatomyGrid();
            initDShotBits();
            initPidChart();
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                const s = document.getElementById('sidebar'); s.classList.toggle('hidden'); s.classList.toggle('fixed'); s.classList.toggle('inset-0');
            });
        });

        function navTo(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0,0);
            document.querySelectorAll('.nav-item').forEach(i => {
                i.classList.remove('active', 'bg-orange-900/10', 'text-orange-400', 'border-orange-400', 'bg-emerald-900/10', 'text-emerald-400', 'border-emerald-400', 'bg-sky-900/10', 'text-sky-400', 'border-sky-400');
                i.classList.add('text-slate-400', 'border-transparent');
            });
            const link = Array.from(document.querySelectorAll('.nav-item')).find(l => l.getAttribute('onclick').includes(id));
            if(link) {
                if(id.includes('roadmap')) link.classList.add('active', 'text-orange-400', 'border-l-4', 'border-orange-400');
                else if(id.includes('teardown')) link.classList.add('active', 'text-emerald-400', 'border-l-4', 'border-emerald-400');
                else if(id.includes('bldc') || id.includes('pixhawk')) link.classList.add('active', 'text-sky-400', 'border-l-4', 'border-sky-400');
                else link.classList.add('active', 'text-sky-400', 'border-l-4', 'border-sky-400');
                link.classList.remove('text-slate-400', 'border-transparent');
            }
            if(window.innerWidth < 768) { document.getElementById('sidebar').classList.add('hidden'); document.getElementById('sidebar').classList.remove('fixed', 'inset-0'); }
        }

        // --- Interactions ---
        function showBldcDetail(k) {
            const d = bldcSpecs[k];
            const b = document.getElementById('bldc-detail-box');
            document.getElementById('bldc-icon').innerHTML = d.icon;
            document.getElementById('bldc-title').innerText = d.title;
            document.getElementById('bldc-desc').innerText = d.desc;
            const l = document.getElementById('bldc-specs'); l.innerHTML = '';
            d.specs.forEach(s => l.innerHTML += `<li><span class="text-sky-500 mr-2">></span>${s}</li>`);
            b.classList.remove('hidden'); b.classList.add('animate-fade-in');
        }

        function showPortDetail(k) {
            const d = portDB[k];
            const p = document.getElementById('port-detail-panel');
            document.getElementById('port-icon').innerHTML = d.icon;
            document.getElementById('port-title').innerText = d.title;
            document.getElementById('port-content').innerHTML = d.content;
            p.classList.remove('animate-fade-in'); void p.offsetWidth; p.classList.add('animate-fade-in');
        }

        function initAnatomyGrid() {
            const c = document.getElementById('anatomy-grid');
            anatomyData.forEach(d => {
                const div = document.createElement('div');
                div.className = 'interactive-card bg-slate-900 p-4 rounded-xl border border-slate-800 shadow-lg text-center group';
                div.onclick = () => {
                    const b = document.getElementById('anatomy-detail');
                    document.getElementById('detail-title').innerText = d.title;
                    document.getElementById('detail-desc').innerText = d.desc;
                    const l = document.getElementById('detail-specs'); l.innerHTML = '';
                    d.specs.forEach(s => l.innerHTML += `<li>> ${s}</li>`);
                    b.classList.remove('hidden');
                };
                div.innerHTML = `<div class="text-3xl mb-2 grayscale group-hover:grayscale-0 transition">${d.icon}</div><h3 class="font-bold text-slate-200 text-sm">${d.title}</h3>`;
                c.appendChild(div);
            });
        }

        function initDShotBits() {
            const c = document.getElementById('dshot-bits');
            for(let i=0; i<16; i++) {
                const b = document.createElement('div');
                let color = i < 11 ? 'bg-emerald-500' : (i < 12 ? 'bg-amber-500' : 'bg-rose-500');
                b.className = `bit-box w-5 h-8 md:w-6 md:h-10 ${color} rounded opacity-60 hover:opacity-100 border border-white/10 m-0.5 cursor-help`;
                c.appendChild(b);
            }
        }

        function initVehicleChart() {
            new Chart(document.getElementById('vehicleChart'), {
                type: 'radar',
                data: {
                    labels: ['æ‡¸åœç©©å®šæ€§', 'å·¡èˆªæ•ˆç‡', 'è¼‰é‡èƒ½åŠ›', 'èˆªç¨‹', 'æŠ—é¢¨æ€§'],
                    datasets: [
                        { label: 'å¤šæ—‹ç¿¼ (Multi)', data: [10, 3, 5, 3, 6], borderColor: '#38bdf8', backgroundColor: 'rgba(56, 189, 248, 0.2)' },
                        { label: 'å›ºå®šç¿¼ (Fixed)', data: [0, 10, 7, 10, 4], borderColor: '#34d399', backgroundColor: 'rgba(52, 211, 153, 0.2)' },
                        { label: 'å‚ç›´èµ·é™ (VTOL)', data: [8, 8, 6, 8, 5], borderColor: '#fbbf24', backgroundColor: 'rgba(251, 191, 36, 0.2)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { grid: { color: '#334155' }, angleLines: { color: '#334155' } } } }
            });
        }

        let pidChart;
        function initPidChart() {
            pidChart = new Chart(document.getElementById('pidChart'), {
                type: 'line',
                data: {
                    labels: [0,10,20,30,40,50,60,70,80],
                    datasets: [{ label: 'ç›®æ¨™å€¼ (Target)', data: Array(9).fill(1), borderColor: '#64748b', borderDash: [5,5] }, { label: 'éŸ¿æ‡‰ (Response)', data: [0, 0.6, 1.2, 0.9, 1.05, 0.98, 1.01, 1, 1], borderColor: '#34d399', backgroundColor: 'rgba(52, 211, 153, 0.1)', fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 1.5, grid: { color: '#1e293b' } }, x: { grid: { display: false } } } }
            });
        }
        function updatePidChart(t) {
            const m = { balanced: {d:[0, 0.6, 1.1, 0.95, 1.02, 0.99, 1, 1, 1], c:'#34d399'}, highP: {d:[0, 0.8, 1.4, 0.6, 1.3, 0.8, 1.1, 0.95, 1], c:'#f43f5e'} };
            const p = m[t];
            pidChart.data.datasets[1].data = p.d;
            pidChart.data.datasets[1].borderColor = p.c;
            pidChart.update();
        }

        // --- Software Stack Switcher ---
        function switchStack(id) {
            document.getElementById('content-px4').classList.add('hidden');
            document.getElementById('content-ardupilot').classList.add('hidden');
            document.getElementById(`content-${id}`).classList.remove('hidden');
            document.getElementById('tab-px4').className = id === 'px4' ? 'flex-1 py-4 font-bold text-sky-400 bg-slate-900 border-r border-slate-800 transition' : 'flex-1 py-4 font-bold text-slate-500 bg-slate-950 transition';
            document.getElementById('tab-ardupilot').className = id === 'ardupilot' ? 'flex-1 py-4 font-bold text-rose-400 bg-slate-900 transition' : 'flex-1 py-4 font-bold text-slate-500 bg-slate-950 transition';
        }

        function showDiagnosis() {
            const v = document.getElementById('diagnostic-select').value;
            const r = document.getElementById('diagnostic-result');
            const t = document.getElementById('diag-title');
            const d = document.getElementById('diag-desc');
            if(!v) { r.classList.add('hidden'); return; }
            const db = {
                desync: {t:'é¦¬é”å¤±æ­¥ (Desync)', d:'å»ºè­°æ“ä½œï¼š1. åœ¨ BLHeli ä¸­å¢åŠ  Rampup Powerã€‚ 2. æª¢æŸ¥é¦¬é”æ¥ç·šæ˜¯å¦é¬†è„«ã€‚'},
                mag: {t:'ç¾…ç›¤å¹²æ“¾ (TBE)', d:'å»ºè­°æ“ä½œï¼š1. é‡æ–°æ ¡æº–ç£ç¾…ç›¤ã€‚ 2. å°‡ GPS æ”¯æ¶ç§»é›¢ PDB æˆ–é›»æºç·šã€‚'}
            };
            const data = db[v];
            t.innerText = data.t; d.innerText = data.d;
            r.classList.remove('hidden');
        }
    </script>
</body>
</html>
