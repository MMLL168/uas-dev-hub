<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAS R&D Hub (Omniscient Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #020617; /* slate-950 */
            color: #cbd5e1; /* slate-300 */
        }

        .mono-font { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Chart Container */
        .chart-container { position: relative; width: 100%; height: 300px; max-height: 400px; }

        /* Nav & Interactions */
        .nav-item.active { background-color: rgba(14, 165, 233, 0.15); color: #38bdf8; border-left: 3px solid #38bdf8; }
        
        .interactive-card, .port-connector, .topo-block {
            transition: all 0.2s ease; cursor: pointer; border: 1px solid #334155;
        }
        .interactive-card:hover, .port-connector:hover, .topo-block:hover {
            transform: translateY(-2px); box-shadow: 0 0 15px rgba(56, 189, 248, 0.15); border-color: #38bdf8; background-color: rgba(30, 41, 59, 0.8);
        }

        /* Hardware Specific Styles from Master Ref */
        .hw-block { border: 1px solid #334155; transition: all 0.2s ease; }
        .hw-block:hover { border-color: #38bdf8; box-shadow: 0 0 20px rgba(56, 189, 248, 0.1); transform: translateY(-2px); }

        /* Pinout Table Styles */
        .pin-table th { text-align: left; padding: 0.5rem; color: #94a3b8; font-size: 0.7rem; text-transform: uppercase; border-bottom: 1px solid #334155; }
        .pin-table td { padding: 0.5rem; border-bottom: 1px solid #1e293b; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #cbd5e1; }
        .pin-table tr:last-child td { border-bottom: none; }
        
        .voltage-tag { padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: bold; margin-right: 4px; display: inline-block;}
        .v-5 { background: rgba(244, 63, 94, 0.15); color: #fb7185; border: 1px solid rgba(244, 63, 94, 0.3); }
        .v-33 { background: rgba(56, 189, 248, 0.15); color: #38bdf8; border: 1px solid rgba(56, 189, 248, 0.3); }
        .v-gnd { background: rgba(148, 163, 184, 0.15); color: #94a3b8; border: 1px solid rgba(148, 163, 184, 0.3); }

        /* Bit Visualization */
        .bit-box { transition: all 0.2s; }
        .bit-box:hover { transform: scale(1.15); z-index: 10; box-shadow: 0 0 10px currentColor; }

        /* Roadmap */
        .roadmap-item { position: relative; padding-left: 2rem; padding-bottom: 2rem; border-left: 2px solid #334155; }
        .roadmap-item:last-child { border-left: 2px solid transparent; }
        .roadmap-dot { position: absolute; left: -0.55rem; top: 0; width: 1rem; height: 1rem; border-radius: 50%; background-color: #0f172a; border: 2px solid #38bdf8; }

        /* Math formula style override */
        mjx-container { color: #cbd5e1 !important; }
        
        /* FOC Steps */
        .foc-step { position: relative; }
        .foc-step::after { content: '‚ûú'; position: absolute; right: -20px; top: 50%; transform: translateY(-50%); color: #475569; font-size: 1.2rem; }
        .foc-step:last-child::after { display: none; }
        @media (max-width: 768px) { .foc-step::after { right: 50%; top: auto; bottom: -25px; transform: translateX(50%) rotate(90deg); } }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <!-- Mobile Header -->
    <div class="md:hidden bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center sticky top-0 z-50">
        <h1 class="font-bold text-lg text-slate-100"><i class="fa-solid fa-code mr-2"></i>UAS R&D Hub</h1>
        <button id="mobile-menu-btn" class="text-slate-400 focus:outline-none text-2xl">‚ò∞</button>
    </div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="hidden md:flex flex-col w-64 bg-slate-900 border-r border-slate-800 h-screen sticky top-0 z-40 overflow-y-auto">
        <div class="p-6 border-b border-slate-800">
            <h1 class="text-xl font-bold text-slate-100 tracking-tight mono-font">
                UAS<span class="text-sky-500">_Dev</span>
            </h1>
            <p class="text-xs text-slate-500 mt-1">Omniscient Edition</p>
        </div>
        <div class="flex-1 py-4 space-y-1">
            <!-- Strategic -->
            <div class="px-4 py-2 text-xs font-bold text-slate-600 uppercase tracking-wider">Strategic</div>
            <a href="#" onclick="navTo('section-roadmap')" class="nav-item block px-6 py-3 text-sm font-medium text-orange-400 hover:bg-slate-800 hover:text-orange-200 border-l-4 border-transparent transition-colors active bg-orange-900/10"><i class="fa-solid fa-chess-knight mr-2 w-4"></i>Tech Roadmap (CTO)</a>
            <a href="#" onclick="navTo('section-teardown')" class="nav-item block px-6 py-3 text-sm font-medium text-emerald-400 hover:bg-slate-800 hover:text-emerald-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-box-open mr-2 w-4"></i>X500 Á°¨È´îÊãÜËß£ (Ref)</a>

            <!-- Hardware Deep Dive -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">Engineering Deep Dive</div>
            <a href="#" onclick="navTo('section-pixhawk')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-microchip mr-2 w-4"></i>Pixhawk 6X Master</a>
            <a href="#" onclick="navTo('section-bldc')" class="nav-item block px-6 py-3 text-sm font-medium text-sky-400 hover:bg-slate-800 hover:text-sky-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-bolt mr-2 w-4"></i>BLDC È¶¨ÈÅîÂØ¶È©óÂÆ§ (Full)</a>
            <a href="#" onclick="navTo('section-hardware')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-dna mr-2 w-4"></i>Á°¨È´îËß£Ââñ (Anatomy)</a>
            
            <!-- System & Logic -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">Control & Logic</div>
            <a href="#" onclick="navTo('section-intro')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-chart-pie mr-2 w-4"></i>Á≥ªÁµ±Ê¶ÇËßÄ (Physics)</a>
            <a href="#" onclick="navTo('section-protocols')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-wave-square mr-2 w-4"></i>DShot ÈÄöË®äÊôÇÂ∫è</a>
            <a href="#" onclick="navTo('section-pid')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-arrow-trend-up mr-2 w-4"></i>PID ÊéßÂà∂ÁêÜË´ñ</a>
            
            <!-- Ops -->
            <div class="px-4 py-2 mt-4 text-xs font-bold text-slate-600 uppercase tracking-wider">Operations</div>
            <a href="#" onclick="navTo('section-software')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-brands fa-git-alt mr-2 w-4"></i>ËªüÈ´îÊ£ß (Stack)</a>
            <a href="#" onclick="navTo('section-maint')" class="nav-item block px-6 py-3 text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-slate-200 border-l-4 border-transparent transition-colors"><i class="fa-solid fa-wrench mr-2 w-4"></i>ÊïÖÈöúË®∫Êñ∑ (Debug)</a>
        </div>
        <div class="p-4 bg-slate-950 border-t border-slate-800 text-xs text-slate-500">Engineer: Marlon</div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 p-4 md:p-10 overflow-x-hidden">

        <!-- 1. Roadmap -->
        <section id="section-roadmap" class="mb-16 animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">ÊäÄË°ìÂâçÁûª (Tech Roadmap)</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-holybro">Official</span><span>Holybro CTO @ PX4 Summit</span>
                </div>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-slate-200 mb-6 flex items-center"><i class="fa-solid fa-timeline mr-2 text-orange-500"></i>Avionics Evolution</h3>
                    <div class="pl-2 space-y-6 border-l-2 border-slate-800 ml-2">
                        <div class="roadmap-item">
                            <div class="roadmap-dot border-orange-500"></div>
                            <h4 class="text-base font-bold text-orange-400">FMURT7 (NXP i.MX RT1176)</h4>
                            <p class="text-sm text-slate-400 mt-1">1GHz Dual-Core. Native Ethernet. The future beyond STM32.</p>
                        </div>
                        <div class="roadmap-item">
                            <div class="roadmap-dot border-sky-500"></div>
                            <h4 class="text-base font-bold text-sky-400">PAB Standard</h4>
                            <p class="text-sm text-slate-400 mt-1">Pixhawk Autopilot Bus. Decouples core from carrier.</p>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h4 class="font-bold text-slate-200 mb-3 text-sm uppercase tracking-wider">Strategic Peripherals</h4>
                    <div class="space-y-3">
                        <div class="bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 text-sm block">Unicore UM982 (Dual Antenna)</strong>
                            <p class="text-xs text-slate-500 mt-1">GPS Heading (Yaw) source. Immune to magnetic interference.</p>
                        </div>
                        <div class="bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 text-sm block">PM08D (200A)</strong>
                            <p class="text-xs text-slate-500 mt-1">Digital I2C Power Monitor for heavy lift.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Pixhawk 6X Master (Expanded) -->
        <section id="section-pixhawk" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Pixhawk 6X Á°¨È´îÂ∫ïÂ±§ÂÖ®Ëß£</h2>
                <p class="text-slate-400 max-w-3xl">Architecture, Power Path, and Pin-to-Pin Specifications.</p>
            </header>

            <!-- Architecture -->
            <div class="grid lg:grid-cols-2 gap-6 mb-8">
                <div class="hw-block bg-slate-900 p-5 rounded-xl relative overflow-hidden">
                    <span class="text-sky-400 font-mono text-xs border border-sky-500/50 px-2 py-1 rounded">FMU Core</span>
                    <h3 class="text-2xl font-bold text-white mt-3">STM32 H753</h3>
                    <ul class="mt-4 space-y-2 text-sm text-slate-300 mono-font">
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Freq</span> <span class="text-sky-300">480 MHz</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Core</span> <span class="text-sky-300">Cortex-M7</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Role</span> <span>Guidance, Navigation, Control</span></li>
                    </ul>
                </div>
                <div class="hw-block bg-slate-900 p-5 rounded-xl relative overflow-hidden">
                    <span class="text-emerald-400 font-mono text-xs border border-emerald-500/50 px-2 py-1 rounded">IO Core</span>
                    <h3 class="text-2xl font-bold text-white mt-3">STM32 F103</h3>
                    <ul class="mt-4 space-y-2 text-sm text-slate-300 mono-font">
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Freq</span> <span class="text-emerald-300">72 MHz</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Core</span> <span class="text-emerald-300">Cortex-M3</span></li>
                        <li class="flex justify-between border-b border-slate-800 pb-1"><span>Role</span> <span>Failsafe, RC I/O, PWM</span></li>
                    </ul>
                </div>
            </div>

            <!-- Interface Pinouts (Deep Dive) -->
            <div class="grid lg:grid-cols-3 gap-6 mb-8">
                <!-- Port Visualizer -->
                <div class="lg:col-span-2 bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">Interactive Port Map</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('power')">
                            <div class="port-label text-rose-400">POWER 1 & 2</div><i class="fa-solid fa-battery-full text-xl text-rose-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('gps')">
                            <div class="port-label text-emerald-400">GPS 1 & 2</div><i class="fa-solid fa-satellite text-xl text-emerald-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('telem')">
                            <div class="port-label text-sky-400">TELEM 1-3</div><i class="fa-solid fa-wifi text-xl text-sky-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('fmu_pwm')">
                            <div class="port-label text-amber-400">FMU PWM</div><i class="fa-solid fa-fan text-xl text-amber-500 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('io_pwm')">
                            <div class="port-label text-slate-300">IO PWM</div><i class="fa-solid fa-gears text-xl text-slate-400 my-2"></i>
                        </div>
                        <div class="port-connector bg-slate-900/50 p-3 rounded text-center" onclick="showPortDetail('can')">
                            <div class="port-label text-indigo-400">CAN 1 & 2</div><i class="fa-solid fa-network-wired text-xl text-indigo-500 my-2"></i>
                        </div>
                    </div>
                </div>
                <!-- Detail Panel -->
                <div class="lg:col-span-1">
                    <div id="port-detail-panel" class="bg-slate-900 border border-slate-700 h-full rounded-xl p-6 shadow-lg animate-fade-in flex flex-col">
                        <div class="flex items-center mb-4 pb-4 border-b border-slate-800">
                            <div id="port-icon" class="text-2xl mr-3"></div>
                            <div><h4 id="port-title" class="text-xl font-bold text-white">Select Port</h4><p id="port-subtitle" class="text-xs text-slate-500"></p></div>
                        </div>
                        <div id="port-content" class="text-sm text-slate-400 flex-1 overflow-y-auto"><p class="italic opacity-70">Click diagram to view full electrical specs.</p></div>
                    </div>
                </div>
            </div>

            <!-- Subsystems Details -->
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- PWM Logic -->
                <div class="bg-slate-900 rounded-xl border border-slate-800 p-5">
                    <h3 class="text-white font-bold mb-3 text-sm uppercase"><i class="fa-solid fa-wave-square text-amber-500 mr-2"></i>PWM Architecture</h3>
                    <div class="flex gap-4 text-xs">
                        <div class="flex-1 bg-slate-950 p-3 rounded border border-amber-900/30">
                            <strong class="text-amber-400 block mb-1">FMU PWM (Aux)</strong>
                            <p class="text-slate-400 mb-2">Direct H7 Timer.</p>
                            <div class="bg-amber-900/20 text-amber-300 px-2 py-1 rounded">Protocol: DShot, OneShot</div>
                        </div>
                        <div class="flex-1 bg-slate-950 p-3 rounded border border-slate-700">
                            <strong class="text-slate-300 block mb-1">IO PWM (Main)</strong>
                            <p class="text-slate-400 mb-2">Via F103.</p>
                            <div class="bg-slate-800 text-slate-300 px-2 py-1 rounded">Protocol: PWM (50-400Hz)</div>
                        </div>
                    </div>
                </div>
                <!-- Sensor Matrix -->
                <div class="bg-slate-900 rounded-xl border border-slate-800 p-5">
                    <h3 class="text-white font-bold mb-3 text-sm uppercase"><i class="fa-solid fa-compass text-indigo-500 mr-2"></i>Sensor Redundancy</h3>
                    <div class="grid grid-cols-3 gap-2 text-center text-xs">
                        <div class="bg-slate-950 p-2 rounded"><span class="text-indigo-400 block font-bold">IMU1</span>ICM-42688</div>
                        <div class="bg-slate-950 p-2 rounded"><span class="text-indigo-400 block font-bold">IMU2</span>ICM-42688</div>
                        <div class="bg-slate-950 p-2 rounded"><span class="text-indigo-400 block font-bold">IMU3</span>BMI088</div>
                        <div class="bg-slate-950 p-2 rounded"><span class="text-slate-400 block font-bold">Mag</span>BMM150</div>
                        <div class="bg-slate-950 p-2 rounded"><span class="text-slate-400 block font-bold">Baro1</span>ICP-20100</div>
                        <div class="bg-slate-950 p-2 rounded"><span class="text-slate-400 block font-bold">Baro2</span>BMP388</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Teardown (Ref) -->
        <section id="section-teardown" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">X500 V2 Á°¨È´îÂèÉËÄÉË®≠Ë®à</h2>
                <div class="flex items-center gap-2 text-slate-400 text-sm">
                    <span class="source-badge badge-teardown"><i class="fa-solid fa-check mr-1"></i> Data Verified</span>
                </div>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-950 p-6 rounded-xl border border-slate-800">
                    <h3 class="text-lg font-bold text-slate-200 mb-4">BOM & Specs</h3>
                    <div class="space-y-4 font-mono text-sm">
                        <div class="border-l-2 border-emerald-500 pl-4">
                            <div class="text-emerald-400 font-bold">1. Frame</div>
                            <div class="text-xs text-slate-500">X500 V2 (500mm). Injection Molded PDB.</div>
                        </div>
                        <div class="border-l-2 border-rose-500 pl-4">
                            <div class="text-rose-400 font-bold">2. Propulsion</div>
                            <div class="text-xs text-slate-500">Motors: 2216 920KV. ESC: 20A BLHeli_S.</div>
                        </div>
                        <div class="border-l-2 border-sky-500 pl-4">
                            <div class="text-sky-400 font-bold">3. Avionics</div>
                            <div class="text-xs text-slate-500">FC: Pixhawk 6C (Standard). Power: PM02D.</div>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <h4 class="font-bold text-slate-200 mb-3 text-sm uppercase"><i class="fa-solid fa-triangle-exclamation text-yellow-500 mr-2"></i>Critical Notes</h4>
                    <ul class="text-sm text-slate-400 space-y-2 list-disc list-inside">
                        <li><strong>PM02 vs PM02D:</strong> Ensure `SENS_EN_INA226` is enabled for digital power monitoring.</li>
                        <li><strong>Motor Order:</strong> PX4 Quad-X: M1(FR), M2(RL), M3(FL), M4(RR).</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 4. BLDC Lab (Full Math) -->
        <section id="section-bldc" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">BLDC È¶¨ÈÅîÊéßÂà∂ÊùøÂØ¶È©óÂÆ§</h2>
                <p class="text-slate-400 max-w-3xl">STM32 FOC Architecture & Component Selection.</p>
            </header>

            <!-- Topology -->
            <div class="bg-slate-950 p-6 rounded-xl border border-slate-800 shadow-inner mb-8 overflow-x-auto">
                <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">Inverter Topology</h3>
                <div class="flex flex-col md:flex-row gap-4 items-stretch min-w-[700px]">
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('mcu')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-sky-400 text-xs px-2 py-0.5 rounded border border-slate-700">Controller</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-microchip text-3xl text-sky-500 mb-2"></i><h4 class="font-bold text-slate-200">STM32 G4</h4></div>
                    </div>
                    <div class="flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-right-long text-xl"></i></div>
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('driver')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-amber-400 text-xs px-2 py-0.5 rounded border border-slate-700">Pre-Driver</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-charging-station text-3xl text-amber-500 mb-2"></i><h4 class="font-bold text-slate-200">Gate Driver</h4></div>
                    </div>
                    <div class="flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-right-long text-xl"></i></div>
                    <div class="topo-block flex-1 bg-slate-900 rounded-lg p-4 cursor-pointer relative" onclick="showBldcDetail('mosfet')">
                        <div class="absolute -top-3 left-3 bg-slate-800 text-rose-400 text-xs px-2 py-0.5 rounded border border-slate-700">Power Stage</div>
                        <div class="text-center mt-2"><i class="fa-solid fa-bolt text-3xl text-rose-500 mb-2"></i><h4 class="font-bold text-slate-200">MOSFETs</h4></div>
                    </div>
                </div>
            </div>

            <div id="bldc-detail-box" class="bg-slate-800 border border-slate-700 p-6 rounded-xl shadow-lg mb-8 hidden">
                <div class="flex items-start">
                    <div class="mr-4 text-3xl" id="bldc-icon"></div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-slate-100 mb-2" id="bldc-title"></h3>
                        <p class="text-slate-300 mb-4 text-sm" id="bldc-desc"></p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-800">
                            <h4 class="text-xs text-sky-500 font-bold uppercase mb-3">Math & Selection</h4>
                            <ul class="text-sm text-slate-400 mono-font space-y-3" id="bldc-specs"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FOC Workflow -->
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <h3 class="text-lg font-bold text-slate-200 mb-6 flex items-center"><i class="fa-solid fa-wave-square mr-2 text-emerald-500"></i>FOC Control Loop</h3>
                <div class="grid md:grid-cols-4 gap-4 text-center">
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700"><h4 class="font-bold text-emerald-400 text-sm">1. ADC Sampling</h4><p class="text-xs text-slate-400 mt-2">Read Ia, Ib</p></div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700"><h4 class="font-bold text-emerald-400 text-sm">2. Clarke / Park</h4><p class="text-xs text-slate-400 mt-2">abc ‚ûú dq</p></div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700"><h4 class="font-bold text-emerald-400 text-sm">3. PID Loop</h4><p class="text-xs text-slate-400 mt-2">Torque Ctrl</p></div>
                    <div class="foc-step bg-slate-800 p-4 rounded border border-slate-700"><h4 class="font-bold text-emerald-400 text-sm">4. SVPWM</h4><p class="text-xs text-slate-400 mt-2">Duty Cycle</p></div>
                </div>
            </div>
        </section>

        <!-- 5. System Overview (Physics) -->
        <section id="section-intro" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Á≥ªÁµ±Ê¶ÇËßÄ (Engineering Physics)</h2>
            </header>
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-slate-900 p-6 rounded-xl border border-slate-800 shadow-lg">
                    <div class="chart-container"><canvas id="vehicleChart"></canvas></div>
                </div>
                <div class="space-y-4">
                    <div class="bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-sky-400 block mb-1">Disk Loading</strong>
                        <p class="text-xs text-slate-400">$$ DL = \frac{Weight}{PropArea} $$</p>
                    </div>
                    <div class="bg-slate-950 p-4 rounded border border-slate-800">
                        <strong class="text-emerald-400 block mb-1">Stall Speed</strong>
                        <p class="text-xs text-slate-400">$$ V_{stall} = \sqrt{\frac{2W}{\rho S C_{L,max}}} $$</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Hardware Anatomy -->
        <section id="section-hardware" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Á°¨È´îËß£Ââñ (Anatomy)</h2>
            </header>
            <div class="grid md:grid-cols-4 gap-4" id="anatomy-grid"></div>
            <div id="anatomy-detail" class="mt-6 bg-slate-800/50 border border-slate-700 p-6 rounded-xl shadow-lg hidden">
                <h3 id="detail-title" class="text-xl font-bold text-sky-400 mb-2"></h3>
                <p id="detail-desc" class="text-slate-300 mb-2"></p>
                <div class="bg-slate-950 p-3 rounded border border-slate-800"><ul class="space-y-1 text-sm text-emerald-400 mono-font" id="detail-specs"></ul></div>
            </div>
        </section>

        <!-- 7. Protocols -->
        <section id="section-protocols" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">DShot Timing Specs</h2>
            </header>
            <div class="bg-slate-900 p-8 rounded-xl shadow-lg border border-slate-800">
                <div class="flex flex-wrap justify-center gap-1 mb-8" id="dshot-bits"></div>
                <div class="grid md:grid-cols-3 gap-4 text-center text-xs mono-font">
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot150</strong><span>150 kbit/s</span></div>
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot300</strong><span>300 kbit/s</span></div>
                    <div class="bg-slate-950 p-3 rounded border border-slate-700"><strong class="text-sky-400 block">DShot600</strong><span>600 kbit/s</span></div>
                </div>
            </div>
        </section>

        <!-- 8. PID -->
        <section id="section-pid" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">PID Control Theory</h2>
            </header>
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <div class="mb-6 bg-slate-950 p-4 rounded border border-slate-700 text-center">
                    <p class="text-slate-300 text-sm mono-font">$$ u(t) = K_p e(t) + K_i \int_0^t e(\tau)d\tau + K_d \frac{de(t)}{dt} + FF $$</p>
                </div>
                <div class="chart-container"><canvas id="pidChart"></canvas></div>
                <div class="flex justify-center gap-4 mt-4">
                    <button onclick="updatePidChart('balanced')" class="px-3 py-1 bg-emerald-900/30 text-emerald-400 border border-emerald-800 rounded">Perfect</button>
                    <button onclick="updatePidChart('highP')" class="px-3 py-1 bg-rose-900/30 text-rose-400 border border-rose-800 rounded">High P</button>
                </div>
            </div>
        </section>

        <!-- 9. Software -->
        <section id="section-software" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Software Stack</h2>
            </header>
            <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
                <div class="flex border-b border-slate-800 bg-slate-950">
                    <button class="flex-1 py-4 text-sky-400 font-bold bg-slate-900">PX4</button>
                    <button class="flex-1 py-4 text-slate-500">ArduPilot</button>
                </div>
                <div class="p-8 text-slate-400 text-sm space-y-2">
                    <p><strong>Kernel:</strong> NuttX (Real-time POSIX)</p>
                    <p><strong>Middleware:</strong> uORB (Pub/Sub Messaging)</p>
                </div>
            </div>
        </section>

        <!-- 10. Maintenance -->
        <section id="section-maint" class="mb-16 hidden animate-section">
            <header class="mb-8 border-b border-slate-800 pb-4">
                <h2 class="text-3xl font-bold text-slate-100 mb-2">Field Diagnostics</h2>
            </header>
            <div class="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <select id="diagnostic-select" onchange="showDiagnosis()" class="w-full p-3 bg-slate-800 border border-slate-700 rounded text-slate-200">
                    <option value="">Select Symptom</option>
                    <option value="desync">Motor Desync</option>
                    <option value="mag">Mag Error</option>
                </select>
                <div id="diagnostic-result" class="hidden mt-4 p-4 bg-slate-950 border-l-4 border-emerald-500">
                    <h4 id="diag-title" class="font-bold text-emerald-400 mb-2"></h4>
                    <p id="diag-desc" class="text-sm text-slate-300"></p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Chart Defaults ---
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = '#334155';

        // --- Data: Pixhawk Ports (FULL DETAIL HTML) ---
        const portDB = {
            power: {
                title: 'POWER 1 & 2', subtitle: 'LTC4417 OR-ing', icon: '<i class="fa-solid fa-battery-full text-rose-500"></i>',
                content: `<table class="w-full pin-table">
                    <tr><th>Pin</th><th>Sig</th><th>Volt</th><th>Note</th></tr>
                    <tr><td>1,2</td><td>VCC</td><td class="v-5">5V</td><td>Input</td></tr>
                    <tr><td>3</td><td>I_SENS</td><td class="v-33">3.3V</td><td>Analog</td></tr>
                    <tr><td>4</td><td>V_SENS</td><td class="v-33">3.3V</td><td>Analog</td></tr>
                    <tr><td>5,6</td><td>GND</td><td class="v-gnd">GND</td><td>Ref</td></tr>
                </table><p class="mt-2 text-xs text-slate-400">ÂÑ™ÂÖàÊ¨äÔºöPower1 > Power2 > USB</p>`
            },
            gps: {
                title: 'GPS 1', subtitle: 'GNSS + Mag', icon: '<i class="fa-solid fa-satellite text-emerald-500"></i>',
                content: `<table class="w-full pin-table">
                    <tr><th>Pin</th><th>Sig</th><th>Volt</th></tr>
                    <tr><td>1</td><td>VCC</td><td class="v-5">5V</td></tr>
                    <tr><td>2</td><td>TX</td><td class="v-33">3.3V</td></tr>
                    <tr><td>3</td><td>RX</td><td class="v-33">3.3V</td></tr>
                    <tr><td>4,5</td><td>I2C</td><td class="v-33">3.3V</td></tr>
                    <tr><td>6</td><td>Safe</td><td class="v-33">3.3V</td></tr>
                </table>`
            },
            telem: { title: 'TELEM 1', subtitle: 'High Power', icon: '<i class="fa-solid fa-wifi text-sky-500"></i>', content: `<table class="w-full pin-table"><tr><th>Pin</th><th>Sig</th><th>Volt</th></tr><tr><td>1</td><td>VCC</td><td class="v-5">5V (1.5A)</td></tr><tr><td>2,3</td><td>TX/RX</td><td class="v-33">3.3V</td></tr><tr><td>4,5</td><td>CTS/RTS</td><td class="v-33">3.3V</td></tr></table>` },
            fmu_pwm: { title: 'FMU PWM', subtitle: 'DShot', icon: '<i class="fa-solid fa-fan text-amber-500"></i>', content: `<p class="text-xs text-slate-300">Signal pins direct to STM32 H7 Timer.</p><div class="mt-2 bg-slate-950 p-2 rounded border border-amber-900/50 text-xs text-amber-400">VCC pin is usually unconnected or opto-isolated. Do not power servos here.</div>` },
            io_pwm: { title: 'IO PWM', subtitle: 'Servo', icon: '<i class="fa-solid fa-gears text-slate-400"></i>', content: `<p class="text-xs text-slate-300">Managed by F103 Co-processor.</p><div class="mt-2 bg-slate-950 p-2 rounded border border-rose-900/50 text-xs text-rose-400">Requires external BEC on Servo Rail for power.</div>` },
            can: { title: 'CAN 1/2', subtitle: 'UAVCAN', icon: '<i class="fa-solid fa-network-wired text-indigo-500"></i>', content: `<table class="w-full pin-table"><tr><th>Pin</th><th>Sig</th></tr><tr><td>1</td><td>VCC</td></tr><tr><td>2</td><td>CAN_H</td></tr><tr><td>3</td><td>CAN_L</td></tr><tr><td>4</td><td>GND</td></tr></table>` }
        };

        const bldcSpecs = {
            mcu: { icon: '<i class="fa-solid fa-microchip text-sky-500"></i>', title: 'STM32 G4', desc: 'Math Accelerator', specs: ['CORDIC/FMAC Engine', '3x 12-bit ADC (5Msps)', 'TIM1 Adv. PWM'] },
            driver: { icon: '<i class="fa-solid fa-charging-station text-amber-500"></i>', title: 'Gate Driver', desc: 'Pre-Driver Stage', specs: ['Current: Ig > Qg/tr', 'Dead-time HW Insert', 'Bootstrap Cap Req'] },
            mosfet: { icon: '<i class="fa-solid fa-bolt text-rose-500"></i>', title: 'MOSFETs', desc: 'Inverter Bridge', specs: ['Vds > 1.5x Vbatt', 'Rds(on) < 3mŒ©', 'Pkg: DFN 5x6'] }
        };

        const anatomyData = [
            { id: 'brain', icon: 'üß†', title: 'FC', desc: 'H753', specs: ['Triple IMU'] },
            { id: 'muscle', icon: 'üí™', title: 'ESC', desc: 'FOC', specs: ['DShot600'] },
            { id: 'senses', icon: 'üëÅÔ∏è', title: 'Sensor', desc: 'Array', specs: ['ICM/BMI'] },
            { id: 'heart', icon: 'üîã', title: 'Power', desc: 'PM02D', specs: ['I2C Digital'] }
        ];

        // --- Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            initVehicleChart();
            initAnatomyGrid();
            initDShotBits();
            initPidChart();
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                const s = document.getElementById('sidebar'); s.classList.toggle('hidden'); s.classList.toggle('fixed'); s.classList.toggle('inset-0');
            });
        });

        function navTo(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0,0);
            document.querySelectorAll('.nav-item').forEach(i => {
                i.classList.remove('active', 'bg-orange-900/10', 'text-orange-400', 'border-orange-400', 'bg-emerald-900/10', 'text-emerald-400', 'border-emerald-400', 'bg-sky-900/10', 'text-sky-400', 'border-sky-400');
                i.classList.add('text-slate-400', 'border-transparent');
            });
            const link = Array.from(document.querySelectorAll('.nav-item')).find(l => l.getAttribute('onclick').includes(id));
            if(link) {
                if(id.includes('roadmap')) link.classList.add('active', 'text-orange-400', 'border-l-4', 'border-orange-400');
                else if(id.includes('teardown')) link.classList.add('active', 'text-emerald-400', 'border-l-4', 'border-emerald-400');
                else if(id.includes('bldc') || id.includes('pixhawk')) link.classList.add('active', 'text-sky-400', 'border-l-4', 'border-sky-400');
                else link.classList.add('active', 'text-sky-400', 'border-l-4', 'border-sky-400');
                link.classList.remove('text-slate-400', 'border-transparent');
            }
            if(window.innerWidth < 768) { document.getElementById('sidebar').classList.add('hidden'); document.getElementById('sidebar').classList.remove('fixed', 'inset-0'); }
        }

        function showPortDetail(k) {
            const d = portDB[k];
            document.getElementById('port-icon').innerHTML = d.icon;
            document.getElementById('port-title').innerText = d.title;
            document.getElementById('port-subtitle').innerText = d.subtitle;
            document.getElementById('port-content').innerHTML = d.content;
            const p = document.getElementById('port-detail-panel');
            p.classList.remove('animate-fade-in'); void p.offsetWidth; p.classList.add('animate-fade-in');
        }

        function showBldcDetail(k) {
            const d = bldcSpecs[k];
            const b = document.getElementById('bldc-detail-box');
            document.getElementById('bldc-icon').innerHTML = d.icon;
            document.getElementById('bldc-title').innerText = d.title;
            document.getElementById('bldc-desc').innerText = d.desc;
            const l = document.getElementById('bldc-specs'); l.innerHTML = '';
            d.specs.forEach(s => l.innerHTML += `<li>> ${s}</li>`);
            b.classList.remove('hidden'); b.classList.add('animate-fade-in');
        }

        function initAnatomyGrid() {
            const c = document.getElementById('anatomy-grid');
            anatomyData.forEach(d => {
                const div = document.createElement('div');
                div.className = 'interactive-card bg-slate-900 p-4 rounded-xl border border-slate-800 shadow-lg text-center group';
                div.onclick = () => {
                    const b = document.getElementById('anatomy-detail');
                    document.getElementById('detail-title').innerText = d.title;
                    document.getElementById('detail-desc').innerText = d.desc;
                    const l = document.getElementById('detail-specs'); l.innerHTML = '';
                    d.specs.forEach(s => l.innerHTML += `<li>> ${s}</li>`);
                    b.classList.remove('hidden');
                };
                div.innerHTML = `<div class="text-3xl mb-2 grayscale group-hover:grayscale-0 transition">${d.icon}</div><h3 class="font-bold text-slate-200 text-sm">${d.title}</h3>`;
                c.appendChild(div);
            });
        }

        function initDShotBits() {
            const c = document.getElementById('dshot-bits');
            for(let i=0; i<16; i++) {
                const b = document.createElement('div');
                let color = i < 11 ? 'bg-emerald-500' : (i < 12 ? 'bg-amber-500' : 'bg-rose-500');
                b.className = `bit-box w-5 h-8 md:w-6 md:h-10 ${color} rounded opacity-60 hover:opacity-100 border border-white/10 m-0.5 cursor-help`;
                c.appendChild(b);
            }
        }

        function initVehicleChart() {
            new Chart(document.getElementById('vehicleChart'), {
                type: 'radar',
                data: {
                    labels: ['Hover', 'Cruise', 'Payload', 'Range', 'Wind'],
                    datasets: [
                        { label: 'Multi', data: [10, 3, 5, 3, 6], borderColor: '#38bdf8', backgroundColor: '#38bdf833' },
                        { label: 'Fixed', data: [0, 10, 7, 10, 4], borderColor: '#34d399', backgroundColor: '#34d39933' },
                        { label: 'VTOL', data: [8, 8, 6, 8, 5], borderColor: '#fbbf24', backgroundColor: '#fbbf2433' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { grid: { color: '#334155' }, angleLines: { color: '#334155' } } } }
            });
        }

        let pidChart;
        function initPidChart() {
            pidChart = new Chart(document.getElementById('pidChart'), {
                type: 'line',
                data: {
                    labels: [0,10,20,30,40,50,60,70,80],
                    datasets: [{ label: 'Target', data: Array(9).fill(1), borderColor: '#64748b', borderDash: [5,5] }, { label: 'Response', data: [0, 0.6, 1.2, 0.9, 1.05, 0.98, 1.01, 1, 1], borderColor: '#34d399', backgroundColor: '#34d3991A', fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 1.5, grid: { color: '#1e293b' } }, x: { grid: { display: false } } } }
            });
        }
        function updatePidChart(t) {
            const m = { balanced: {d:[0, 0.6, 1.1, 0.95, 1.02, 0.99, 1, 1, 1], c:'#34d399'}, highP: {d:[0, 0.8, 1.4, 0.6, 1.3, 0.8, 1.1, 0.95, 1], c:'#f43f5e'} };
            const p = m[t];
            pidChart.data.datasets[1].data = p.d;
            pidChart.data.datasets[1].borderColor = p.c;
            pidChart.update();
        }

        function showDiagnosis() {
            const v = document.getElementById('diagnostic-select').value;
            const r = document.getElementById('diagnostic-result');
            const t = document.getElementById('diag-title');
            const d = document.getElementById('diag-desc');
            if(!v) { r.classList.add('hidden'); return; }
            const db = { desync: {t:'Motor Desync', d:'Action: Increase Rampup Power.'}, mag: {t:'Mag Error', d:'Action: Recalibrate.'} };
            const data = db[v];
            t.innerText = data.t; d.innerText = data.d;
            r.classList.remove('hidden');
        }
    </script>
</body>
</html>
